/** @preserve
 * jsPDF - PDF Document creation from JavaScript
 * Version ${versionID}
 *                           CommitID ${commitID}
 *
 * Copyright (c) 2010-2014 James Hall <james@parall.ax>, https://github.com/MrRio/jsPDF
 *               2010 Aaron Spike, https://github.com/acspike
 *               2012 Willow Systems Corporation, willow-systems.com
 *               2012 Pablo Hess, https://github.com/pablohess
 *               2012 Florian Jenett, https://github.com/fjenett
 *               2013 Warren Weckesser, https://github.com/warrenweckesser
 *               2013 Youssef Beddad, https://github.com/lifof
 *               2013 Lee Driscoll, https://github.com/lsdriscoll
 *               2013 Stefan Slonevskiy, https://github.com/stefslon
 *               2013 Jeremy Morel, https://github.com/jmorel
 *               2013 Christoph Hartmann, https://github.com/chris-rock
 *               2014 Juan Pablo Gaviria, https://github.com/juanpgaviria
 *               2014 James Makes, https://github.com/dollaruw
 *               2014 Diego Casorran, https://github.com/diegocr
 *               2014 Steven Spungin, https://github.com/Flamenco
 *               2014 Kenneth Glassey, https://github.com/Gavvers
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 * Contributor(s):
 *    siefkenj, ahwolf, rickygu, Midnith, saintclair, eaparango,
 *    kim3er, mfo, alnorth, Flamenco
 */
var jsPDF=function(global){"use strict";var pdfVersion="1.3",pageFormats={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};function PubSub(context){var topics={};this.subscribe=function(topic,callback,once){if("function"!=typeof callback)return!1;topics.hasOwnProperty(topic)||(topics[topic]={});var id=Math.random().toString(35);return topics[topic][id]=[callback,!!once],id},this.unsubscribe=function(token){for(var topic in topics)if(topics[topic][token])return delete topics[topic][token],!0;return!1},this.publish=function(topic){if(topics.hasOwnProperty(topic)){var args=Array.prototype.slice.call(arguments,1),idr=[];for(var id in topics[topic]){var sub=topics[topic][id];try{sub[0].apply(context,args)}catch(ex){global.console&&console.error("jsPDF PubSub Error",ex.message,ex)}sub[1]&&idr.push(id)}idr.length&&idr.forEach(this.unsubscribe)}}}function jsPDF(orientation,unit,format,compressPdf){var options={};"object"==typeof orientation&&(orientation=(options=orientation).orientation,unit=options.unit||unit,format=options.format||format,compressPdf=options.compress||options.compressPdf||compressPdf),unit=unit||"mm",format=format||"a4",orientation=(""+(orientation||"P")).toLowerCase();var format_as_string=(""+format).toLowerCase(),compress=!!compressPdf&&"function"==typeof Uint8Array,textColor=options.textColor||"0 g",drawColor=options.drawColor||"0 G",activeFontSize=options.fontSize||16,lineHeightProportion=options.lineHeight||1.15,lineWidth=options.lineWidth||.200025,objectNumber=2,outToPages=!1,offsets=[],fonts={},fontmap={},activeFontKey,k,tmp,page=0,currentPage,pages=[],pagesContext=[],pagedim=[],content=[],additionalObjects=[],lineCapID=0,lineJoinID=0,content_length=0,pageWidth,pageHeight,pageMode,zoomMode,layoutMode,documentProperties={title:"",subject:"",author:"",keywords:"",creator:""},API={},events=new PubSub(API),f2=function(number){return number.toFixed(2)},f3=function(number){return number.toFixed(3)},padd2=function(number){return("0"+parseInt(number)).slice(-2)},out=function(string){outToPages?pages[currentPage].push(string):(content_length+=string.length+1,content.push(string))},newObject=function(){return objectNumber++,offsets[objectNumber]=content_length,out(objectNumber+" 0 obj"),objectNumber},newAdditionalObject=function(){var objId=2*pages.length+1,obj={objId:objId+=additionalObjects.length,content:""};return additionalObjects.push(obj),obj},newObjectDeferred=function(){return objectNumber++,offsets[objectNumber]=function(){return content_length},objectNumber},newObjectDeferredBegin=function(oid){offsets[oid]=content_length},putStream=function(str){out("stream"),out(str),out("endstream")},putPages=function(){var n,p,arr,i,deflater,adler32,adler32cs,wPt,hPt,pageObjectNumbers=[];for(adler32cs=global.adler32cs||jsPDF.adler32cs,compress&&void 0===adler32cs&&(compress=!1),n=1;n<=page;n++){if(pageObjectNumbers.push(newObject()),wPt=(pageWidth=pagedim[n].width)*k,hPt=(pageHeight=pagedim[n].height)*k,out("<</Type /Page"),out("/Parent 1 0 R"),out("/Resources 2 0 R"),out("/MediaBox [0 0 "+f2(wPt)+" "+f2(hPt)+"]"),events.publish("putPage",{pageNumber:n,page:pages[n]}),out("/Contents "+(objectNumber+1)+" 0 R"),out(">>"),out("endobj"),p=pages[n].join("\n"),newObject(),compress){for(arr=[],i=p.length;i--;)arr[i]=p.charCodeAt(i);adler32=adler32cs.from(p),(deflater=new Deflater(6)).append(new Uint8Array(arr)),p=deflater.flush(),(arr=new Uint8Array(p.length+6)).set(new Uint8Array([120,156])),arr.set(p,2),arr.set(new Uint8Array([255&adler32,adler32>>8&255,adler32>>16&255,adler32>>24&255]),p.length+2),p=String.fromCharCode.apply(null,arr),out("<</Length "+p.length+" /Filter [/FlateDecode]>>")}else out("<</Length "+p.length+">>");putStream(p),out("endobj")}offsets[1]=content_length,out("1 0 obj"),out("<</Type /Pages");var kids="/Kids [";for(i=0;i<page;i++)kids+=pageObjectNumbers[i]+" 0 R ";out(kids+"]"),out("/Count "+page),out(">>"),out("endobj"),events.publish("postPutPages")},putFont=function(font){font.objectNumber=newObject(),out("<</BaseFont/"+font.PostScriptName+"/Type/Font"),"string"==typeof font.encoding&&out("/Encoding/"+font.encoding),out("/Subtype/Type1>>"),out("endobj")},putFonts=function(){for(var fontKey in fonts)fonts.hasOwnProperty(fontKey)&&putFont(fonts[fontKey])},putXobjectDict=function(){events.publish("putXobjectDict")},putResourceDictionary=function(){for(var fontKey in out("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),out("/Font <<"),fonts)fonts.hasOwnProperty(fontKey)&&out("/"+fontKey+" "+fonts[fontKey].objectNumber+" 0 R");out(">>"),out("/XObject <<"),putXobjectDict(),out(">>")},putResources=function(){putFonts(),events.publish("putResources"),offsets[2]=content_length,out("2 0 obj"),out("<<"),putResourceDictionary(),out(">>"),out("endobj"),events.publish("postPutResources")},putAdditionalObjects=function(){events.publish("putAdditionalObjects");for(var i=0;i<additionalObjects.length;i++){var obj=additionalObjects[i];offsets[obj.objId]=content_length,out(obj.objId+" 0 obj"),out(obj.content),out("endobj")}objectNumber+=additionalObjects.length,events.publish("postPutAdditionalObjects")},addToFontDictionary=function(fontKey,fontName,fontStyle){fontmap.hasOwnProperty(fontName)||(fontmap[fontName]={}),fontmap[fontName][fontStyle]=fontKey},addFont=function(PostScriptName,fontName,fontStyle,encoding){var fontKey="F"+(Object.keys(fonts).length+1).toString(10),font=fonts[fontKey]={id:fontKey,PostScriptName:PostScriptName,fontName:fontName,fontStyle:fontStyle,encoding:encoding,metadata:{}};return addToFontDictionary(fontKey,fontName,fontStyle),events.publish("addFont",font),fontKey},addFonts=function(){for(var HELVETICA="helvetica",TIMES="times",COURIER="courier",NORMAL="normal",BOLD="bold",ITALIC="italic",BOLD_ITALIC="bolditalic",encoding="StandardEncoding",ZAPF,standardFonts=[["Helvetica",HELVETICA,NORMAL],["Helvetica-Bold",HELVETICA,BOLD],["Helvetica-Oblique",HELVETICA,ITALIC],["Helvetica-BoldOblique",HELVETICA,BOLD_ITALIC],["Courier",COURIER,NORMAL],["Courier-Bold",COURIER,BOLD],["Courier-Oblique",COURIER,ITALIC],["Courier-BoldOblique",COURIER,BOLD_ITALIC],["Times-Roman",TIMES,NORMAL],["Times-Bold",TIMES,BOLD],["Times-Italic",TIMES,ITALIC],["Times-BoldItalic",TIMES,BOLD_ITALIC],["ZapfDingbats","zapfdingbats"]],i=0,l=standardFonts.length;i<l;i++){var fontKey=addFont(standardFonts[i][0],standardFonts[i][1],standardFonts[i][2],encoding),parts=standardFonts[i][0].split("-");addToFontDictionary(fontKey,parts[0],parts[1]||"")}events.publish("addFonts",{fonts:fonts,dictionary:fontmap})},SAFE,to8bitStream=function(text,flags){var i,l,sourceEncoding,encodingBlock,outputEncoding,newtext,isUnicode,ch,bch;if(sourceEncoding=(flags=flags||{}).sourceEncoding||"Unicode",outputEncoding=flags.outputEncoding,(flags.autoencode||outputEncoding)&&fonts[activeFontKey].metadata&&fonts[activeFontKey].metadata[sourceEncoding]&&fonts[activeFontKey].metadata[sourceEncoding].encoding&&(encodingBlock=fonts[activeFontKey].metadata[sourceEncoding].encoding,!outputEncoding&&fonts[activeFontKey].encoding&&(outputEncoding=fonts[activeFontKey].encoding),!outputEncoding&&encodingBlock.codePages&&(outputEncoding=encodingBlock.codePages[0]),"string"==typeof outputEncoding&&(outputEncoding=encodingBlock[outputEncoding]),outputEncoding)){for(isUnicode=!1,newtext=[],i=0,l=text.length;i<l;i++)(ch=outputEncoding[text.charCodeAt(i)])?newtext.push(String.fromCharCode(ch)):newtext.push(text[i]),newtext[i].charCodeAt(0)>>8&&(isUnicode=!0);text=newtext.join("")}for(i=text.length;void 0===isUnicode&&0!==i;)text.charCodeAt(i-1)>>8&&(isUnicode=!0),i--;if(!isUnicode)return text;for(newtext=flags.noBOM?[]:[254,255],i=0,l=text.length;i<l;i++){if((bch=(ch=text.charCodeAt(i))>>8)>>8)throw new Error("Character at position "+i+" of string '"+text+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");newtext.push(bch),newtext.push(ch-(bch<<8))}return String.fromCharCode.apply(void 0,newtext)},pdfEscape=function(text,flags){return to8bitStream(text,flags).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},putInfo=function(){for(var key in out("/Producer (jsPDF "+jsPDF.version+")"),documentProperties)documentProperties.hasOwnProperty(key)&&documentProperties[key]&&out("/"+key.substr(0,1).toUpperCase()+key.substr(1)+" ("+pdfEscape(documentProperties[key])+")");var created=new Date,tzoffset=created.getTimezoneOffset(),tzsign=tzoffset<0?"+":"-",tzhour=Math.floor(Math.abs(tzoffset/60)),tzmin=Math.abs(tzoffset%60),tzstr=[tzsign,padd2(tzhour),"'",padd2(tzmin),"'"].join("");out(["/CreationDate (D:",created.getFullYear(),padd2(created.getMonth()+1),padd2(created.getDate()),padd2(created.getHours()),padd2(created.getMinutes()),padd2(created.getSeconds()),tzstr,")"].join(""))},putCatalog=function(){switch(out("/Type /Catalog"),out("/Pages 1 0 R"),zoomMode||(zoomMode="fullwidth"),zoomMode){case"fullwidth":out("/OpenAction [3 0 R /FitH null]");break;case"fullheight":out("/OpenAction [3 0 R /FitV null]");break;case"fullpage":out("/OpenAction [3 0 R /Fit]");break;case"original":out("/OpenAction [3 0 R /XYZ null null 1]");break;default:var pcn=""+zoomMode;"%"===pcn.substr(pcn.length-1)&&(zoomMode=parseInt(zoomMode)/100),"number"==typeof zoomMode&&out("/OpenAction [3 0 R /XYZ null null "+f2(zoomMode)+"]")}switch(layoutMode||(layoutMode="continuous"),layoutMode){case"continuous":out("/PageLayout /OneColumn");break;case"single":out("/PageLayout /SinglePage");break;case"two":case"twoleft":out("/PageLayout /TwoColumnLeft");break;case"tworight":out("/PageLayout /TwoColumnRight")}pageMode&&out("/PageMode /"+pageMode),events.publish("putCatalog")},putTrailer=function(){out("/Size "+(objectNumber+1)),out("/Root "+objectNumber+" 0 R"),out("/Info "+(objectNumber-1)+" 0 R")},beginPage=function(width,height){var orientation="string"==typeof height&&height.toLowerCase();if("string"==typeof width){var format=width.toLowerCase();pageFormats.hasOwnProperty(format)&&(width=pageFormats[format][0]/k,height=pageFormats[format][1]/k)}if(Array.isArray(width)&&(height=width[1],width=width[0]),orientation){switch(orientation.substr(0,1)){case"l":height>width&&(orientation="s");break;case"p":width>height&&(orientation="s")}"s"===orientation&&(tmp=width,width=height,height=tmp)}outToPages=!0,pages[++page]=[],pagedim[page]={width:Number(width)||pageWidth,height:Number(height)||pageHeight},pagesContext[page]={},_setPage(page)},_addPage=function(){beginPage.apply(this,arguments),out(f2(lineWidth*k)+" w"),out(drawColor),0!==lineCapID&&out(lineCapID+" J"),0!==lineJoinID&&out(lineJoinID+" j"),events.publish("addPage",{pageNumber:page})},_deletePage=function(n){n>0&&n<=page&&(pages.splice(n,1),pagedim.splice(n,1),page--,currentPage>page&&(currentPage=page),this.setPage(currentPage))},_setPage=function(n){n>0&&n<=page&&(currentPage=n,pageWidth=pagedim[n].width,pageHeight=pagedim[n].height)},getFont=function(fontName,fontStyle){var key;switch(fontName=void 0!==fontName?fontName:fonts[activeFontKey].fontName,fontStyle=void 0!==fontStyle?fontStyle:fonts[activeFontKey].fontStyle,void 0!==fontName&&(fontName=fontName.toLowerCase()),fontName){case"sans-serif":case"verdana":case"arial":case"helvetica":fontName="helvetica";break;case"fixed":case"monospace":case"terminal":case"courier":fontName="courier";break;case"serif":case"cursive":case"fantasy":default:fontName="times"}try{key=fontmap[fontName][fontStyle]}catch(e){}return key||null==(key=fontmap.times[fontStyle])&&(key=fontmap.times.normal),key},buildDocument=function(){outToPages=!1,objectNumber=2,content_length=0,content=[],offsets=[],additionalObjects=[],events.publish("buildDocument"),out("%PDF-1.3"),putPages(),putAdditionalObjects(),putResources(),newObject(),out("<<"),putInfo(),out(">>"),out("endobj"),newObject(),out("<<"),putCatalog(),out(">>"),out("endobj");var o=content_length,i,p="0000000000";for(out("xref"),out("0 "+(objectNumber+1)),out(p+" 65535 f "),i=1;i<=objectNumber;i++){var offset=offsets[i];out("function"==typeof offset?(p+offsets[i]()).slice(-10)+" 00000 n ":(p+offsets[i]).slice(-10)+" 00000 n ")}return out("trailer"),out("<<"),putTrailer(),out(">>"),out("startxref"),out(""+o),out("%%EOF"),outToPages=!0,content.join("\n")},getStyle=function(style){var op="S";return"F"===style?op="f":"FD"===style||"DF"===style?op="B":"f"!==style&&"f*"!==style&&"B"!==style&&"B*"!==style||(op=style),op},getArrayBuffer=function(){for(var data=buildDocument(),len=data.length,ab=new ArrayBuffer(len),u8=new Uint8Array(ab);len--;)u8[len]=data.charCodeAt(len);return ab},getBlob=function(){return new Blob([getArrayBuffer()],{type:"application/pdf"})},output=function __safeCall(fn){return fn.foo=function __safeCallWrapper(){try{return fn.apply(this,arguments)}catch(e){var stack=e.stack||"";~stack.indexOf(" at ")&&(stack=stack.split(" at ")[1]);var m="Error in function "+stack.split("\n")[0].split("<")[0]+": "+e.message;if(!global.console)throw new Error(m);global.console.error(m,e),global.alert&&alert(m)}},fn.foo.bar=fn,fn.foo}((function(type,options){var datauri="dataur"===(""+type).substr(0,6)?"data:application/pdf;base64,"+btoa(buildDocument()):0;switch(type){case void 0:return buildDocument();case"save":if(navigator.getUserMedia&&(void 0===global.URL||void 0===global.URL.createObjectURL))return API.output("dataurlnewwindow");saveAs(getBlob(),options),"function"==typeof saveAs.unload&&global.setTimeout&&setTimeout(saveAs.unload,911);break;case"arraybuffer":return getArrayBuffer();case"blob":return getBlob();case"bloburi":case"bloburl":return global.URL&&global.URL.createObjectURL(getBlob())||void 0;case"datauristring":case"dataurlstring":return datauri;case"dataurlnewwindow":var nW=global.open(datauri);if(nW||"undefined"==typeof safari)return nW;case"datauri":case"dataurl":return global.document.location.href=datauri;default:throw new Error('Output type "'+type+'" is not supported.')}}));switch(unit){case"pt":k=1;break;case"mm":k=72/25.4000508;break;case"cm":k=72/2.54000508;break;case"in":k=72;break;case"px":k=96/72;break;case"pc":case"em":k=12;break;case"ex":k=6;break;default:throw"Invalid unit: "+unit}for(var plugin in API.internal={pdfEscape:pdfEscape,getStyle:getStyle,getFont:function(){return fonts[getFont.apply(API,arguments)]},getFontSize:function(){return activeFontSize},getLineHeight:function(){return activeFontSize*lineHeightProportion},write:function(string1){out(1===arguments.length?string1:Array.prototype.join.call(arguments," "))},getCoordinateString:function(value){return f2(value*k)},getVerticalCoordinateString:function(value){return f2((pageHeight-value)*k)},collections:{},newObject:newObject,newAdditionalObject:newAdditionalObject,newObjectDeferred:newObjectDeferred,newObjectDeferredBegin:newObjectDeferredBegin,putStream:putStream,events:events,scaleFactor:k,pageSize:{get width(){return pageWidth},get height(){return pageHeight}},output:function(type,options){return output(type,options)},getNumberOfPages:function(){return pages.length-1},pages:pages,out:out,f2:f2,getPageInfo:function(pageNumberOneBased){var objId;return{objId:2*(pageNumberOneBased-1)+3,pageNumber:pageNumberOneBased,pageContext:pagesContext[pageNumberOneBased]}},getCurrentPageInfo:function(){var objId;return{objId:2*(currentPage-1)+3,pageNumber:currentPage,pageContext:pagesContext[currentPage]}},getPDFVersion:function(){return"1.3"}},API.addPage=function(){return _addPage.apply(this,arguments),this},API.setPage=function(){return _setPage.apply(this,arguments),this},API.insertPage=function(beforePage){return this.addPage(),this.movePage(currentPage,beforePage),this},API.movePage=function(targetPage,beforePage){if(targetPage>beforePage){for(var tmpPages=pages[targetPage],tmpPagedim=pagedim[targetPage],tmpPagesContext=pagesContext[targetPage],i=targetPage;i>beforePage;i--)pages[i]=pages[i-1],pagedim[i]=pagedim[i-1],pagesContext[i]=pagesContext[i-1];pages[beforePage]=tmpPages,pagedim[beforePage]=tmpPagedim,pagesContext[beforePage]=tmpPagesContext,this.setPage(beforePage)}else if(targetPage<beforePage){for(var tmpPages=pages[targetPage],tmpPagedim=pagedim[targetPage],tmpPagesContext=pagesContext[targetPage],i=targetPage;i<beforePage;i++)pages[i]=pages[i+1],pagedim[i]=pagedim[i+1],pagesContext[i]=pagesContext[i+1];pages[beforePage]=tmpPages,pagedim[beforePage]=tmpPagedim,pagesContext[beforePage]=tmpPagesContext,this.setPage(beforePage)}return this},API.deletePage=function(){return _deletePage.apply(this,arguments),this},API.setDisplayMode=function(zoom,layout,pmode){return zoomMode=zoom,layoutMode=layout,pageMode=pmode,this},API.text=function(text,x,y,flags,angle,align){function ESC(s){return s=s.split("\t").join(Array(options.TabLen||9).join(" ")),pdfEscape(s,flags)}"number"==typeof text&&(tmp=y,y=x,x=text,text=tmp),"string"==typeof text&&(text=text.match(/[\n\r]/)?text.split(/\r\n|\r|\n/g):[text]),"string"==typeof angle&&(align=angle,angle=null),"string"==typeof flags&&(align=flags,flags=null),"number"==typeof flags&&(angle=flags,flags=null);var xtra="",mode="Td",todo;if(angle){angle*=Math.PI/180;var c=Math.cos(angle),s=Math.sin(angle);xtra=[f2(c),f2(s),f2(-1*s),f2(c),""].join(" "),mode="Tm"}"noBOM"in(flags=flags||{})||(flags.noBOM=!0),"autoencode"in flags||(flags.autoencode=!0);var strokeOption="",pageContext=this.internal.getCurrentPageInfo().pageContext,curY;if(!0===flags.stroke?!0!==pageContext.lastTextWasStroke&&(strokeOption="1 Tr\n",pageContext.lastTextWasStroke=!0):(pageContext.lastTextWasStroke&&(strokeOption="0 Tr\n"),pageContext.lastTextWasStroke=!1),void 0===this._runningPageHeight&&(this._runningPageHeight=0),"string"==typeof text)text=ESC(text);else{if("[object Array]"!==Object.prototype.toString.call(text))throw new Error('Type of text must be string or Array. "'+text+'" is not recognized.');for(var sa=text.concat(),da=[],len=sa.length;len--;)da.push(ESC(sa.shift()));var linesLeft=Math.ceil((pageHeight-y-this._runningPageHeight)*k/(activeFontSize*lineHeightProportion));if(0<=linesLeft&&da.length,align){var left,prevX,maxLineLength,leading=activeFontSize*lineHeightProportion,lineWidths=text.map((function(v){return this.getStringUnitWidth(v)*activeFontSize/k}),this);if(maxLineLength=Math.max.apply(Math,lineWidths),"center"===align)left=x-maxLineLength/2,x-=lineWidths[0]/2;else{if("right"!==align)throw new Error('Unrecognized alignment option, use "center" or "right".');left=x-maxLineLength,x-=lineWidths[0]}prevX=x,text=da[0];for(var i=1,len=da.length;i<len;i++){var delta=maxLineLength-lineWidths[i];"center"===align&&(delta/=2),text+=") Tj\n"+(left-prevX+delta)+" -"+leading+" Td ("+da[i],prevX=left+delta}}else text=da.join(") Tj\nT* (")}return curY=f2((pageHeight-y)*k),out("BT\n/"+activeFontKey+" "+activeFontSize+" Tf\n"+activeFontSize*lineHeightProportion+" TL\n"+strokeOption+textColor+"\n"+xtra+f2(x*k)+" "+curY+" "+mode+"\n("+text+") Tj\nET"),this},API.lstext=function(text,x,y,spacing){for(var i=0,len=text.length;i<len;i++,x+=spacing)this.text(text[i],x,y)},API.line=function(x1,y1,x2,y2){return this.lines([[x2-x1,y2-y1]],x1,y1)},API.clip=function(){out("W"),out("S")},API.clip_fixed=function(fillRule){out("evenodd"===fillRule?"W*":"W"),out("n")},API.lines=function(lines,x,y,scale,style,closed){var scalex,scaley,i,l,leg,x2,y2,x3,y3,x4,y4;for("number"==typeof lines&&(tmp=y,y=x,x=lines,lines=tmp),scale=scale||[1,1],out(f3(x*k)+" "+f3((pageHeight-y)*k)+" m "),scalex=scale[0],scaley=scale[1],l=lines.length,x4=x,y4=y,i=0;i<l;i++)2===(leg=lines[i]).length?(x4=leg[0]*scalex+x4,y4=leg[1]*scaley+y4,out(f3(x4*k)+" "+f3((pageHeight-y4)*k)+" l")):(x2=leg[0]*scalex+x4,y2=leg[1]*scaley+y4,x3=leg[2]*scalex+x4,y3=leg[3]*scaley+y4,x4=leg[4]*scalex+x4,y4=leg[5]*scaley+y4,out(f3(x2*k)+" "+f3((pageHeight-y2)*k)+" "+f3(x3*k)+" "+f3((pageHeight-y3)*k)+" "+f3(x4*k)+" "+f3((pageHeight-y4)*k)+" c"));return closed&&out(" h"),null!==style&&out(getStyle(style)),this},API.rect=function(x,y,w,h,style){var op=getStyle(style);return out([f2(x*k),f2((pageHeight-y)*k),f2(w*k),f2(-h*k),"re"].join(" ")),null!==style&&out(getStyle(style)),this},API.triangle=function(x1,y1,x2,y2,x3,y3,style){return this.lines([[x2-x1,y2-y1],[x3-x2,y3-y2],[x1-x3,y1-y3]],x1,y1,[1,1],style,!0),this},API.roundedRect=function(x,y,w,h,rx,ry,style){var MyArc=4/3*(Math.SQRT2-1);return this.lines([[w-2*rx,0],[rx*MyArc,0,rx,ry-ry*MyArc,rx,ry],[0,h-2*ry],[0,ry*MyArc,-rx*MyArc,ry,-rx,ry],[2*rx-w,0],[-rx*MyArc,0,-rx,-ry*MyArc,-rx,-ry],[0,2*ry-h],[0,-ry*MyArc,rx*MyArc,-ry,rx,-ry]],x+rx,y,[1,1],style),this},API.ellipse=function(x,y,rx,ry,style){var lx=4/3*(Math.SQRT2-1)*rx,ly=4/3*(Math.SQRT2-1)*ry;return out([f2((x+rx)*k),f2((pageHeight-y)*k),"m",f2((x+rx)*k),f2((pageHeight-(y-ly))*k),f2((x+lx)*k),f2((pageHeight-(y-ry))*k),f2(x*k),f2((pageHeight-(y-ry))*k),"c"].join(" ")),out([f2((x-lx)*k),f2((pageHeight-(y-ry))*k),f2((x-rx)*k),f2((pageHeight-(y-ly))*k),f2((x-rx)*k),f2((pageHeight-y)*k),"c"].join(" ")),out([f2((x-rx)*k),f2((pageHeight-(y+ly))*k),f2((x-lx)*k),f2((pageHeight-(y+ry))*k),f2(x*k),f2((pageHeight-(y+ry))*k),"c"].join(" ")),out([f2((x+lx)*k),f2((pageHeight-(y+ry))*k),f2((x+rx)*k),f2((pageHeight-(y+ly))*k),f2((x+rx)*k),f2((pageHeight-y)*k),"c"].join(" ")),null!==style&&out(getStyle(style)),this},API.circle=function(x,y,r,style){return this.ellipse(x,y,r,r,style)},API.setProperties=function(properties){for(var property in documentProperties)documentProperties.hasOwnProperty(property)&&properties[property]&&(documentProperties[property]=properties[property]);return this},API.setFontSize=function(size){return activeFontSize=size,this},API.setFont=function(fontName,fontStyle){return activeFontKey=getFont(fontName,fontStyle),this},API.setFontStyle=API.setFontType=function(style){return activeFontKey=getFont(void 0,style),this},API.getFontList=function(){var list={},fontName,fontStyle,tmp;for(fontName in fontmap)if(fontmap.hasOwnProperty(fontName))for(fontStyle in list[fontName]=tmp=[],fontmap[fontName])fontmap[fontName].hasOwnProperty(fontStyle)&&tmp.push(fontStyle);return list},API.addFont=function(postScriptName,fontName,fontStyle){addFont(postScriptName,fontName,fontStyle,"StandardEncoding")},API.setLineWidth=function(width){return out((width*k).toFixed(2)+" w"),this},API.setDrawColor=function(ch1,ch2,ch3,ch4){var color;return color=void 0===ch2||void 0===ch4&&ch1===ch2===ch3?"string"==typeof ch1?ch1+" G":f2(ch1/255)+" G":void 0===ch4?"string"==typeof ch1?[ch1,ch2,ch3,"RG"].join(" "):[f2(ch1/255),f2(ch2/255),f2(ch3/255),"RG"].join(" "):"string"==typeof ch1?[ch1,ch2,ch3,ch4,"K"].join(" "):[f2(ch1),f2(ch2),f2(ch3),f2(ch4),"K"].join(" "),out(color),this},API.setFillColor=function(ch1,ch2,ch3,ch4){var color;return void 0===ch2||void 0===ch4&&ch1===ch2===ch3?color="string"==typeof ch1?ch1+" g":f2(ch1/255)+" g":void 0===ch4||"object"==typeof ch4?(color="string"==typeof ch1?[ch1,ch2,ch3,"rg"].join(" "):[f2(ch1/255),f2(ch2/255),f2(ch3/255),"rg"].join(" "),ch4&&0===ch4.a&&(color=["255","255","255","rg"].join(" "))):color="string"==typeof ch1?[ch1,ch2,ch3,ch4,"k"].join(" "):[f2(ch1),f2(ch2),f2(ch3),f2(ch4),"k"].join(" "),out(color),this},API.setTextColor=function(r,g,b){if("string"==typeof r&&/^#[0-9A-Fa-f]{6}$/.test(r)){var hex=parseInt(r.substr(1),16);r=hex>>16&255,g=hex>>8&255,b=255&hex}return textColor=0===r&&0===g&&0===b||void 0===g?f3(r/255)+" g":[f3(r/255),f3(g/255),f3(b/255),"rg"].join(" "),this},API.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},API.setLineCap=function(style){var id=this.CapJoinStyles[style];if(void 0===id)throw new Error("Line cap style of '"+style+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return lineCapID=id,out(id+" J"),this},API.setLineJoin=function(style){var id=this.CapJoinStyles[style];if(void 0===id)throw new Error("Line join style of '"+style+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return lineJoinID=id,out(id+" j"),this},API.output=output,API.save=function(filename){API.output("save",filename)},jsPDF.API)jsPDF.API.hasOwnProperty(plugin)&&("events"===plugin&&jsPDF.API.events.length?function(events,newEvents){var eventname,handler_and_args,i;for(i=newEvents.length-1;-1!==i;i--)eventname=newEvents[i][0],handler_and_args=newEvents[i][1],events.subscribe.apply(events,[eventname].concat("function"==typeof handler_and_args?[handler_and_args]:handler_and_args))}(events,jsPDF.API.events):API[plugin]=jsPDF.API[plugin]);return addFonts(),activeFontKey="F1",_addPage(format,orientation),events.publish("initialized"),API}return jsPDF.API={events:[]},jsPDF.version="1.0.0-trunk","function"==typeof define&&define.amd?define("jsPDF",(function(){return jsPDF})):"undefined"!=typeof module&&module.exports?module.exports=jsPDF:global.jsPDF=jsPDF,jsPDF}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this);