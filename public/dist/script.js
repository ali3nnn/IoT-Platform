/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./public/js/webpack-scripts.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./node_modules/path-browserify/index.js":
/*!***********************************************!*\
  !*** ./node_modules/path-browserify/index.js ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("/* WEBPACK VAR INJECTION */(function(process) {// .dirname, .basename, and .extname methods are extracted from Node.js v8.11.1,\n// backported and transplited with Babel, with backwards-compat fixes\n\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// resolves . and .. elements in a path array with directory names there\n// must be no slashes, empty elements, or device names (c:\\) in the array\n// (so also no leading and trailing slashes - it does not distinguish\n// relative and absolute paths)\nfunction normalizeArray(parts, allowAboveRoot) {\n  // if the path tries to go above the root, `up` ends up > 0\n  var up = 0;\n  for (var i = parts.length - 1; i >= 0; i--) {\n    var last = parts[i];\n    if (last === '.') {\n      parts.splice(i, 1);\n    } else if (last === '..') {\n      parts.splice(i, 1);\n      up++;\n    } else if (up) {\n      parts.splice(i, 1);\n      up--;\n    }\n  }\n\n  // if the path is allowed to go above the root, restore leading ..s\n  if (allowAboveRoot) {\n    for (; up--; up) {\n      parts.unshift('..');\n    }\n  }\n\n  return parts;\n}\n\n// path.resolve([from ...], to)\n// posix version\nexports.resolve = function() {\n  var resolvedPath = '',\n      resolvedAbsolute = false;\n\n  for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {\n    var path = (i >= 0) ? arguments[i] : process.cwd();\n\n    // Skip empty and invalid entries\n    if (typeof path !== 'string') {\n      throw new TypeError('Arguments to path.resolve must be strings');\n    } else if (!path) {\n      continue;\n    }\n\n    resolvedPath = path + '/' + resolvedPath;\n    resolvedAbsolute = path.charAt(0) === '/';\n  }\n\n  // At this point the path should be resolved to a full absolute path, but\n  // handle relative paths to be safe (might happen when process.cwd() fails)\n\n  // Normalize the path\n  resolvedPath = normalizeArray(filter(resolvedPath.split('/'), function(p) {\n    return !!p;\n  }), !resolvedAbsolute).join('/');\n\n  return ((resolvedAbsolute ? '/' : '') + resolvedPath) || '.';\n};\n\n// path.normalize(path)\n// posix version\nexports.normalize = function(path) {\n  var isAbsolute = exports.isAbsolute(path),\n      trailingSlash = substr(path, -1) === '/';\n\n  // Normalize the path\n  path = normalizeArray(filter(path.split('/'), function(p) {\n    return !!p;\n  }), !isAbsolute).join('/');\n\n  if (!path && !isAbsolute) {\n    path = '.';\n  }\n  if (path && trailingSlash) {\n    path += '/';\n  }\n\n  return (isAbsolute ? '/' : '') + path;\n};\n\n// posix version\nexports.isAbsolute = function(path) {\n  return path.charAt(0) === '/';\n};\n\n// posix version\nexports.join = function() {\n  var paths = Array.prototype.slice.call(arguments, 0);\n  return exports.normalize(filter(paths, function(p, index) {\n    if (typeof p !== 'string') {\n      throw new TypeError('Arguments to path.join must be strings');\n    }\n    return p;\n  }).join('/'));\n};\n\n\n// path.relative(from, to)\n// posix version\nexports.relative = function(from, to) {\n  from = exports.resolve(from).substr(1);\n  to = exports.resolve(to).substr(1);\n\n  function trim(arr) {\n    var start = 0;\n    for (; start < arr.length; start++) {\n      if (arr[start] !== '') break;\n    }\n\n    var end = arr.length - 1;\n    for (; end >= 0; end--) {\n      if (arr[end] !== '') break;\n    }\n\n    if (start > end) return [];\n    return arr.slice(start, end - start + 1);\n  }\n\n  var fromParts = trim(from.split('/'));\n  var toParts = trim(to.split('/'));\n\n  var length = Math.min(fromParts.length, toParts.length);\n  var samePartsLength = length;\n  for (var i = 0; i < length; i++) {\n    if (fromParts[i] !== toParts[i]) {\n      samePartsLength = i;\n      break;\n    }\n  }\n\n  var outputParts = [];\n  for (var i = samePartsLength; i < fromParts.length; i++) {\n    outputParts.push('..');\n  }\n\n  outputParts = outputParts.concat(toParts.slice(samePartsLength));\n\n  return outputParts.join('/');\n};\n\nexports.sep = '/';\nexports.delimiter = ':';\n\nexports.dirname = function (path) {\n  if (typeof path !== 'string') path = path + '';\n  if (path.length === 0) return '.';\n  var code = path.charCodeAt(0);\n  var hasRoot = code === 47 /*/*/;\n  var end = -1;\n  var matchedSlash = true;\n  for (var i = path.length - 1; i >= 1; --i) {\n    code = path.charCodeAt(i);\n    if (code === 47 /*/*/) {\n        if (!matchedSlash) {\n          end = i;\n          break;\n        }\n      } else {\n      // We saw the first non-path separator\n      matchedSlash = false;\n    }\n  }\n\n  if (end === -1) return hasRoot ? '/' : '.';\n  if (hasRoot && end === 1) {\n    // return '//';\n    // Backwards-compat fix:\n    return '/';\n  }\n  return path.slice(0, end);\n};\n\nfunction basename(path) {\n  if (typeof path !== 'string') path = path + '';\n\n  var start = 0;\n  var end = -1;\n  var matchedSlash = true;\n  var i;\n\n  for (i = path.length - 1; i >= 0; --i) {\n    if (path.charCodeAt(i) === 47 /*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          start = i + 1;\n          break;\n        }\n      } else if (end === -1) {\n      // We saw the first non-path separator, mark this as the end of our\n      // path component\n      matchedSlash = false;\n      end = i + 1;\n    }\n  }\n\n  if (end === -1) return '';\n  return path.slice(start, end);\n}\n\n// Uses a mixed approach for backwards-compatibility, as ext behavior changed\n// in new Node.js versions, so only basename() above is backported here\nexports.basename = function (path, ext) {\n  var f = basename(path);\n  if (ext && f.substr(-1 * ext.length) === ext) {\n    f = f.substr(0, f.length - ext.length);\n  }\n  return f;\n};\n\nexports.extname = function (path) {\n  if (typeof path !== 'string') path = path + '';\n  var startDot = -1;\n  var startPart = 0;\n  var end = -1;\n  var matchedSlash = true;\n  // Track the state of characters (if any) we see before our first dot and\n  // after any path separator we find\n  var preDotState = 0;\n  for (var i = path.length - 1; i >= 0; --i) {\n    var code = path.charCodeAt(i);\n    if (code === 47 /*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n    if (end === -1) {\n      // We saw the first non-path separator, mark this as the end of our\n      // extension\n      matchedSlash = false;\n      end = i + 1;\n    }\n    if (code === 46 /*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n    } else if (startDot !== -1) {\n      // We saw a non-dot and non-path separator before our dot, so we should\n      // have a good chance at having a non-empty extension\n      preDotState = -1;\n    }\n  }\n\n  if (startDot === -1 || end === -1 ||\n      // We saw a non-dot character immediately before the dot\n      preDotState === 0 ||\n      // The (right-most) trimmed path component is exactly '..'\n      preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {\n    return '';\n  }\n  return path.slice(startDot, end);\n};\n\nfunction filter (xs, f) {\n    if (xs.filter) return xs.filter(f);\n    var res = [];\n    for (var i = 0; i < xs.length; i++) {\n        if (f(xs[i], i, xs)) res.push(xs[i]);\n    }\n    return res;\n}\n\n// String.prototype.substr - negative index don't work in IE8\nvar substr = 'ab'.substr(-1) === 'b'\n    ? function (str, start, len) { return str.substr(start, len) }\n    : function (str, start, len) {\n        if (start < 0) start = str.length + start;\n        return str.substr(start, len);\n    }\n;\n\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../process/browser.js */ \"./node_modules/process/browser.js\")))\n\n//# sourceURL=webpack:///./node_modules/path-browserify/index.js?");

/***/ }),

/***/ "./node_modules/process/browser.js":
/*!*****************************************!*\
  !*** ./node_modules/process/browser.js ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n\n//# sourceURL=webpack:///./node_modules/process/browser.js?");

/***/ }),

/***/ "./public/js/conveyor.js":
/*!*******************************!*\
  !*** ./public/js/conveyor.js ***!
  \*******************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _utils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils.js */ \"./public/js/utils.js\");\n// Imports\n\n// End imports\n\n// if ($(\".conveyor-page\").length) {\n// Switch Conveyor Event\n// =================================\n$(\"#switch-conveyor\").click(function () {\n    switchConveyor()\n})\n\n// SOCKET.IO\n// =================================\n\n// Check gate state each second\nvar gateChecker\n\nObject(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"sendMessage\"])(\"socketChannel\", {\n    topic: 'gate/' + username,\n    message: \"status\"\n})\n\ngateChecker = setInterval(function () {\n    Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"sendMessage\"])(\"socketChannel\", {\n        topic: 'gate/' + username,\n        message: \"status\"\n    })\n}, 2000)\n\nwindow.gateChecker = gateChecker\n\n\n// The client listens on Socket.IO \nsocket.on('socketChannel', (data) => {\n\n    // Live Weight - client receives scale data from backend\n    if (data.topic.includes(username + \"/scale\")) {\n        if ($(\".scale-info\").length)\n            Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"liveWeight\"])(data.message)\n    }\n\n    // Live Gate Status\n    if (data.topic.includes(\"gate/\" + username)) {\n        Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"liveGate\"])(data.message)\n    }\n\n})\n\n\n// =================================\n// END SOCKET.IO\n\n// block input toggle for a 3s after pressed\nfunction blockSwitchButton(timeout) {\n\n    var time = new Date()\n    $(\".small-box #switch-conveyor\").prop('disabled', true)\n    $(\".small-box #switch-conveyor\").parent().append(\"<div class='switch-disable-time'>\" + timeout / 1000 + \" sec</div>\")\n    Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"displayTimeoutAndVanish\"])('.switch-disable-time', timeout)\n\n    Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"timeoutAsync\"])(timeout, function () {\n        // console.log(\"input toggle release \",new Date()-time)\n        $(\".small-box #switch-conveyor\").prop('disabled', false)\n    })\n}\n\n(async () => {\n    let status = await Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"getConveyorStatus\"])()\n\n    if (parseInt(status[0].status)) {\n        $(\".small-box #switch-conveyor\").prop('checked', true)\n    } else {\n        $(\".small-box #switch-conveyor\").prop('checked', false)\n    }\n\n    switchConveyor();\n\n})()\n\nvar firstTimeHere = true // this initialize with true when page loads\n\nasync function switchConveyor() {\n    // console.log(\"switchConveyor() \", firstTimeHere)\n    if ($(\".small-box #switch-conveyor\").is(':checked')) {\n        // green\n        $(\"#conveyor-img\").attr('src', 'images/conveyor_' + username + '_start.png')\n\n        // first time is when page is reloaded pass this part\n        if (!firstTimeHere) {\n\n            // Tasks\n            Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"insertStatus\"])(\"on\");\n            blockSwitchButton(10000)\n            $(\".send-command-button\").removeClass(\"send-stop\").addClass(\"send-start\")\n            Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"showNotification\"])(\"Conveyor started\", 1)\n\n            // Check gate status\n            gateChecker = setInterval(function () {\n                Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"sendMessage\"])(\"socketChannel\", {\n                    topic: 'gate/' + username,\n                    message: \"status\"\n                })\n            }, 2000)\n            \n            window.gateChecker = gateChecker\n\n            // Send to MQTT\n            Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"sendMessage\"])(\"socketChannel\", {\n                topic: \"start/stop\",\n                message: \"start\"\n            })\n\n            var timeTest = new Date()\n\n            Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"timeoutAsync\"])(5000, function () {\n                // console.log(\"start 2\", new Date - timeTest)\n                Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"sendMessage\"])(\"socketChannel\", {\n                    topic: \"start/stop\",\n                    message: \"start\"\n                })\n            })\n\n            Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"timeoutAsync\"])(7000, function () {\n                // console.log(\"start 2\", new Date - timeTest)\n                Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"sendMessage\"])(\"socketChannel\", {\n                    topic: \"start/stop\",\n                    message: \"start\"\n                })\n            })\n\n            Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"timeoutAsync\"])(10000, function () {\n                // console.log(\"start 2\", new Date - timeTest)\n                Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"sendMessage\"])(\"socketChannel\", {\n                    topic: \"start/stop\",\n                    message: \"start\"\n                })\n            })\n\n        }\n\n        firstTimeHere = false;\n\n    } else {\n        // red\n        $(\"#conveyor-img\").attr('src', 'images/conveyor_' + username + '_stop.png')\n        if (!firstTimeHere) {\n            // Tasks\n            Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"insertStatus\"])(\"off\"); // insert status into DB\n            blockSwitchButton(5000) // block switch button 5 sec\n            $(\".send-command-button\").removeClass(\"send-start\").addClass(\"send-stop\") // change text\n            clearInterval(gateChecker) // stop checking gate status \n            Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"showNotification\"])(\"Conveyor stopped\", 4)\n\n            // Send to MQTT\n            var timeTest = new Date()\n\n            Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"sendMessage\"])(\"socketChannel\", {\n                topic: \"start/stop\",\n                message: \"stop\"\n            })\n\n            Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"timeoutAsync\"])(2000, function () {\n                // console.log(\"stop 2\", new Date - timeTest)\n                Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"sendMessage\"])(\"socketChannel\", {\n                    topic: \"start/stop\",\n                    message: \"stop\"\n                })\n            })\n\n            Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"timeoutAsync\"])(4000, function () {\n                // console.log(\"stop 2\", new Date - timeTest)\n                Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"sendMessage\"])(\"socketChannel\", {\n                    topic: \"start/stop\",\n                    message: \"stop\"\n                })\n            })\n\n        }\n\n        firstTimeHere = false;\n    }\n}\n\n// get list of power sources\nlet getPowerSource = async () => {\n    let response = await fetch(\"https://anysensor.dasstec.ro/api/get-voltage?source1&source2\")\n    return response.json()\n}\n\nfunction updateVoltage() {\n    (async () => {\n\n        // console.log(await chartList)\n\n        let json = await getPowerSource();\n\n        json.forEach(source => {\n            if (source.sensorQueried.includes(\"source1\")) {\n                var voltage1 = source.value\n                $(\".supply-1 h3\").html(voltage1 + \"V\")\n            } else if (source.sensorQueried.includes(\"source2\")) {\n                var voltage2 = source.value\n                $(\".supply-2 h3\").html(voltage2 + \"V\")\n            }\n\n            // console.log(source.sensorQueried, source.value, source.responseTime)\n\n        })\n\n\n    })()\n}\n\nfunction checkGate() {\n    Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"sendMessage\"])(client, 'gate/noriel', 'status')\n}\n\n// async function delay(ms) {\n//     // return await for better async stack trace support in case of errors.\n//     return await new Promise(resolve => setTimeout(resolve, ms));\n// }\n\nlet run = async () => {\n\n    while (1) {\n        updateVoltage();\n        await Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"delay\"])(5 * 1000);\n    }\n}\n\nrun()\n\n// setInterval(function(){\n//     sendMessage(client, \"start/stop\", \"start2\")\n// },1000)\n\n// Custom function for sending the same command as toggle\nif ($('.send-command-button').length) {\n\n    // Send command\n    Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"timeoutAsync\"])(1000, function () {\n        // console.log($(\".small-box #switch-conveyor\").is(':checked'))\n        if ($(\".small-box #switch-conveyor\").is(':checked')) {\n            $(\".send-command-button\").addClass(\"send-start\")\n        } else {\n            $(\".send-command-button\").addClass(\"send-stop\")\n        }\n    })\n\n\n    // Click\n    $('.send-command-button').click(function () {\n        // function sendCommand() {\n        // console.log(\"Send hard command\")\n\n        // check toggle\n        if ($(\".small-box #switch-conveyor\").is(':checked')) {\n            // console.log(\"Send start hard command\")\n            Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"sendMessage\"])(\"socketChannel\", {\n                topic: \"start/stop\",\n                message: \"start\"\n            })\n            Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"timeoutAsync\"])(2000, function () {\n                // sendMessage(client, \"start/stop\", \"start\")\n            })\n        } else {\n            // console.log(\"Send stop hard command\")\n            Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"sendMessage\"])(\"socketChannel\", {\n                topic: \"start/stop\",\n                message: \"stop\"\n            })\n            Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"timeoutAsync\"])(2000, function () {\n                // sendMessage(client, \"start/stop\", \"stop\")\n            })\n        }\n        // }\n    })\n}\n// }\n\n//# sourceURL=webpack:///./public/js/conveyor.js?");

/***/ }),

/***/ "./public/js/dashboard.js":
/*!********************************!*\
  !*** ./public/js/dashboard.js ***!
  \********************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("var time = new Date()\nvar days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\nvar month = new Array();\nmonth[0] = \"January\";\nmonth[1] = \"February\";\nmonth[2] = \"March\";\nmonth[3] = \"April\";\nmonth[4] = \"May\";\nmonth[5] = \"June\";\nmonth[6] = \"July\";\nmonth[7] = \"August\";\nmonth[8] = \"September\";\nmonth[9] = \"October\";\nmonth[10] = \"November\";\nmonth[11] = \"December\";\nvar monthName = month[time.getMonth()];\nvar dayName = days[time.getDay()];\n\n// Global Variables\n// var username = $(\".navbar-brand b\")[0].innerText.slice(0, $(\".navbar-brand b\")[0].innerText.length - 1)\nlet countyName = $(\".county-detail h3\").html()\ndocument.title = countyName.toUpperCase() + \" | Anysensor\"\nlet json = ''\nvar oldUpdatedTime = ''\nvar counterOld = ['', '']\n\n// console.log(\"vars\", new Date() - time)\n\n// Set the minimum height of the sidebar\n// let timeout = (ms,f) => {\n//     let sleep =  new Promise(resolve => setTimeout(function(){\n//         f()\n//         // return resolve\n//     }, ms))\n// }\n\n// Make Socket.io connection\n// var socket = io.connect(\"https://anysensor.dasstec.ro/\")\n\n// socket.on('message', function (data) {\n\n// console.log(data)\n\n// $(\".messages.hideMe\").remove()\n\n// $(\"#main notification\").append(`<div class=\"messages hideMe\">\n//     <div class=\"alert alert-success mt-3 mb-0\" role=\"alert\">\n//         <background></background>\n//         `+data.send+`\n//     </div>\n// </div>`)\n\n// })\n// end WebSocket.io\n\nfunction addSmallBox(label, value, fontAwesome = false) {\n    var component = `<div class=\"small-box bg-info county-detail box-shadow-5\">\n        <div class=\"inner\">\n            <h3>` + value + `</h3>\n            <p>` + label + `</p>\n        </div>`\n\n    if (fontAwesome) {\n        component += `<div class=\"icon\"><i class=\"` + fontAwesome + `\"></i></div>`\n    }\n\n    component += `</div>`\n\n    $(\".small-box-container\").append(component)\n\n\n}\n\nfunction addCssForSmallBox() {\n    var countSmallBoxes = $(\".small-box-container .small-box\").length\n    $(\".small-box-container\").addClass(\"small-box-length-\" + countSmallBoxes + \"\")\n    // console.log(\"countSmallBoxes:\", countSmallBoxes)\n}\n\nDate.prototype.addHours = function (h) {\n    this.setTime(this.getTime() + (h * 60 * 60 * 1000));\n    return this;\n}\n\nfunction playSound(url) {\n    const audio = new Audio(url);\n    audio.play();\n}\n\n// used to create the gauges\nfunction currentValueSvgGauge(element, currentValue = NaN, updatedAt = false, min = -20, max = 70) {\n\n    // If there are no alerts min and max == NaN\n    // console.log(\"Alerts:\",min,max)\n\n    var isCounter = false\n    // element.split('-')[1] == 'c' ? isCounter = true : isCounter = false\n    // console.log(element, isCounter)\n\n    // Remove loader\n    if (isCounter) {\n        $('.' + element + '-newItem-spinner').remove()\n    } else {\n        $('.' + element + '-currentValue-spinner').remove()\n    }\n\n\n    // console.log(\"currentValueSvgGauge\", currentValue)\n\n    if (isNaN(currentValue)) {\n        if (isCounter) {\n            $(\".\" + element + \"-newItem\").prepend(\"No value recorded today\")\n            $(\".\" + element + \"-newItem\").attr(\"no-value\")\n            $(\".live-card-\" + element + \" .card-settings-button\").addClass(\"hidden-element\")\n            return [NaN, NaN]\n        } else {\n            // here can be improved by showing the latest read value\n            // and showing the time when last value was read\n            // and maybe a small info that the info is not very recent\n            // $(\".live-card-\" + element + \" .card-settings-button\").addClass(\"hidden-element\")\n\n            // new way\n            var gauge = $('#' + element + '-gauge .currentValue')\n            // $('#' + element + '-gauge .currentValue').remove()\n            // $('#' + element + '-gauge').append(gauge)\n            // gauge.html(\"No value recorded today\")\n\n            timeoutAsync(500, function () {\n                $(\"#\" + element + \"-gauge .currentValue\").html(\"<span class='no-value'>No value recorded today</span>\")\n            })\n\n            $(\"#\" + element + \"-gauge .currentValue\").attr(\"no-value\", 'true')\n\n            // old way\n            // $(\"#\" + element + \"-gauge\").parent().prepend(\"No value recorded today\")\n            // $(\"#\" + element + \"-gauge\").parent().attr(\"no-value\", 'true')\n\n            return gauge\n        }\n\n    } else {\n\n        // console.log(element + '-gauge')\n\n        if (isCounter) {\n            // pulse effect already appended\n        } else {\n            // console.log(\"else gauge\")\n\n            // experimental way - show the numbers\n            // $('#' + element + '-gauge').append(`<span class=\"currentValue\" value=\"` + currentValue + `\">` + currentValue + `</span>`)\n            var gauge = $('#' + element + '-gauge .currentValue')\n            gauge.html(currentValue)\n\n            // old way - transform element in gauge\n            // var gauge = Gauge(\n            //     document.getElementById(element + '-gauge'), {\n            //         min: min,\n            //         max: max,\n            //         dialStartAngle: 180,\n            //         dialEndAngle: 0,\n            //         value: currentValue,\n            //         label: function (value) {\n            //             return (Math.round(value * 10) / 10);\n            //         },\n            //         viewBox: \"0 0 100 57\",\n            //         // valueDialClass: \"valueDial\",\n            //         // valueClass: \"valueText\",\n            //         // dialClass: \"dial\",\n            //         // gaugeClass: \"gauge\",\n            //         showValue: true,\n            //         color: function (value) {\n            //             if (value < 20) {\n            //                 return \"#5ee432\";\n            //             } else if (value < 40) {\n            //                 return \"#fffa50\";\n            //             } else if (value < 60) {\n            //                 return \"#f7aa38\";\n            //             } else if (value == 0) {\n            //                 return \"gray\";\n            //             } else {\n            //                 return \"#ef4655\";\n            //             }\n            //         }\n            //     }\n            // );\n        }\n\n        // console.log(updatedAt)\n\n        if (updatedAt) {\n\n            var updatedTime = Date.parse(updatedAt)\n            updatedTime = new Date(updatedTime)\n            updatedTime = updatedTime.addHours(-2)\n            updatedTime = updatedTime.toLocaleString('en-US', {\n                timeZone: 'Europe/Bucharest',\n                timeStyle: \"medium\",\n                dateStyle: \"long\"\n            })\n            // console.log(\">> \",updatedTime)\n\n            // current date\n            // var date = new Date()\n\n            // updatedAt is at best 1 hour behind current date \n            // var hour = date.getHours()\n\n            // dateLatestValue add two hours to updatedAt\n            // var dateLatestValue = updatedAt.split(\"T\")[0].split(\"-\")\n            // var hourLatestValue = updatedAt.split(\"T\")[1].split(\":\").slice(0, 2)\n\n            // -1 to match with hour from graph\n            // var hourLatestValue = dateLatestValue.getHours() - 1\n\n            // console.log(element)\n            // console.log(\"date\",date)\n            // console.log(\"dateLatestValue\",dateLatestValue,hourLatestValue)\n\n            // var influxTime = new Date(dateLatestValue[0], dateLatestValue[1] - 1, dateLatestValue[2], hourLatestValue[0], hourLatestValue[1])\n            // console.log(influxTime)\n            // influxTime = influxTime.addHours(1)\n            // influxTime = String(influxTime).split(\" \").slice(1, 5)\n            // updatedTime = influxTime[0] + \" \" + influxTime[1] + \" \" + influxTime[2] + \" \" + influxTime[3]\n\n            // console.log(influxTime)\n            // var dif = date - dateLatestValue\n            // var difMin = dif/1000/60\n            // var preciseTime = (parseInt(String(difMin).split('.')[0]) > 4) ? parseInt(String(difMin).split('.')[0])+\" min ago\" : parseInt(String(difMin*60).split('.')[0])+\" sec ago\"\n            // var difH = hour - hourLatestValue\n            // var text = difH > 1 ? 'hours' : 'hour'\n\n            if (isCounter) {\n                $('#' + element + '-floatinBall').removeClass(\"hidden-element\")\n                $(\".\" + element + \"-newItem\").append(\"<p class='update-time-gauge'>Updated at \" + updatedTime + \"</p>\")\n                // $('#' + element + '-floatinBall').addClass(\"pulse-effect\")\n                // timeout(1700, function () {\n                //     $('#' + element + '-floatinBall').removeClass(\"pulse-effect\")\n                // console.log(\"3 seconds async timeout\")\n                // })\n            } else {\n                $('#' + element + '-gauge').removeClass(\"hidden-element\")\n                $(\"#\" + element + \"-gauge\").parent().append(\"<p class='update-time-gauge'>Updated at \" + updatedTime + \"</p>\")\n            }\n\n\n            // if(parseInt(String(difMin).split('.')[0] > 60)) {\n            //     // try { $(\".update-time-gauge\").remove() } catch {}\n            //     $(\"#\"+element+\"-gauge\").parent().append(\"<p class='update-time-gauge'>Updated \"+difH+\" \"+text+\" ago</p>\")\n            // } else {\n            //     // try { $(\".update-time-gauge\").remove() } catch {}\n            //     $(\"#\"+element+\"-gauge\").parent().append(\"<p class='update-time-gauge'>Updated \"+preciseTime+\" </p>\")\n            // }\n\n        }\n\n        // Append unit measure\n        if (Number.isInteger(currentValue)) {\n            if (element.includes(\"source\")) {\n                $('#' + element + '-gauge g.text-container text').append(\".0 V\")\n            } else {\n                $('#' + element + '-gauge g.text-container text').append(\".0 &#8451;\")\n            }\n        } else {\n            if (element.includes(\"source\")) {\n                $('#' + element + '-gauge g.text-container text').append(\" V\")\n            } else {\n                $('#' + element + '-gauge g.text-container text').append(\" &#8451;\")\n            }\n        }\n\n\n        return gauge\n    }\n\n\n\n}\n\n// not used\nfunction currentValueAdd(element, liveData) {\n    // Live Data\n    if (liveData != 'NaN') {\n        // Remove Loading Item\n        $('.' + element + '-currentValue-spinner').remove()\n        // Add Live Data\n        // $(\".\" + element + \"-currentValue\").append(liveData)\n        // debug\n        // console.log(\"Real value update \"+element+\":\",liveData)\n    } else {\n        // Remove Loading Item\n        $('.' + element + '-currentValue-spinner').remove()\n        // Add Live Data\n        // $(\".\" + element + \"-currentValue\").append(`<p class='no-data-from-sensor' >No data from sensor with id <b>` + element + `</b></p>`)\n    }\n}\n\n// used for updating the gauges\nfunction updateValueSvgGauge(element, gauge, value, updatedAt = false) {\n\n    // Reset no-value attribute\n    $(\"#\" + element + \"-gauge .currentValue\").removeAttr(\"no-value\")\n\n    var isCounter = false\n    element.split('-')[1] == 'c' ? isCounter = true : isCounter = false\n\n    // Update the value\n    if (!isNaN(value) && !isCounter) {\n        try {\n            gauge.setValue(value);\n        } catch {\n            gauge.html(value)\n        }\n    }\n\n    // Append unit measure\n    if (value == parseInt(value, 10)) {\n        if (element.includes(\"source\")) {\n            $('#' + element + '-gauge g.text-container text').append(\".0 V\")\n        } else {\n            $('#' + element + '-gauge g.text-container text').append(\".0 &#8451;\")\n        }\n    } else {\n        if (element.includes(\"source\")) {\n            $('#' + element + '-gauge g.text-container text').append(\" V\")\n        } else {\n            $('#' + element + '-gauge g.text-container text').append(\" &#8451;\")\n        }\n    }\n\n    // console.log(updatedAt)\n\n    if (updatedAt) {\n\n        // console.log(\"updatedAt received\",updatedAt)\n\n        // current date\n        var date = new Date()\n\n        // updatedAt is at best 1 hour behind current date \n        // var hour = date.getHours()\n\n        // dateLatestValue add two hours to updatedAt\n        // var dateLatestValue = updatedAt.split(\"T\")[0].split(\"-\")\n        // var hourLatestValue = updatedAt.split(\"T\")[1].split(\":\").slice(0, 3)\n        // console.log(updatedAt.split(\"T\")[1].split(\":\"))\n        updatedTime = updatedAt\n\n        // -1 to match with hour from graph\n        // var hourLatestValue = dateLatestValue.getHours() - 1\n\n        // console.log(element)\n        // console.log(\"date\",date)\n        // console.log(\"dateLatestValue\",dateLatestValue,hourLatestValue)\n\n        // var influxTime = new Date(dateLatestValue[0], dateLatestValue[1] - 1, dateLatestValue[2], hourLatestValue[0], hourLatestValue[1], hourLatestValue[2].split(\".\")[0])\n        // console.log(influxTime)\n        // influxTime = influxTime.addHours(1)\n        // influxTime = String(influxTime).split(\" \").slice(1, 6)\n        // updatedTime = influxTime[0] + \" \" + influxTime[1] + \" \" + influxTime[2] + \" \" + influxTime[3]\n\n        // console.log(influxTime)\n        // var dif = date - dateLatestValue\n        // var difMin = dif/1000/60\n        // var preciseTime = (parseInt(String(difMin).split('.')[0]) > 4) ? parseInt(String(difMin).split('.')[0])+\" min ago\" : parseInt(String(difMin*60).split('.')[0])+\" sec ago\"\n        // var difH = hour - hourLatestValue\n        // var text = difH > 1 ? 'hours' : 'hour'\n\n        // console.log(\".\" + element + \"-currentValue .update-time-gauge\")\n        if (isCounter) {\n\n            var oldUpdatedTime = $(\".\" + element + \"-newItem .update-time-gauge\").html().split(\"Updated at \")[1]\n\n            if (oldUpdatedTime != updatedTime) {\n\n                $(\".\" + element + \"-newItem .update-time-gauge\").html(\"Updated at \" + updatedTime)\n                $('#' + element + '-floatinBall').addClass(\"pulse-effect\")\n\n                timeout(4500, function () {\n                    $('#' + element + '-floatinBall').removeClass(\"pulse-effect\")\n                    // console.log(\"3 seconds async timeout\")\n                })\n            }\n\n        } else {\n            $(\".\" + element + \"-currentValue .update-time-gauge\").html(\"Updated at \" + updatedTime)\n        }\n\n        // if(parseInt(String(difMin).split('.')[0] > 60)) {\n        //     // try { $(\".update-time-gauge\").remove() } catch {}\n        //     $(\"#\"+element+\"-gauge\").parent().append(\"<p class='update-time-gauge'>Updated \"+difH+\" \"+text+\" ago</p>\")\n        // } else {\n        //     // try { $(\".update-time-gauge\").remove() } catch {}\n        //     $(\"#\"+element+\"-gauge\").parent().append(\"<p class='update-time-gauge'>Updated \"+preciseTime+\" </p>\")\n        // }\n\n    }\n}\n\nfunction removeElement(array, index) {\n    array.splice(index, 1)\n}\n\nfunction addHistoryButton(sensor, x, y) {\n\n    $(\".graph-\" + sensor + \" ul.pagination\").append(`<li class=\"page-item\">\n        <div id=\"predictor-switch\" xlabels=\"` + x + `\" ylabels=\"` + y + `\" clicked=\"false\" class=\"tooltip_test graph-button\" style=\"background: #fff;cursor: pointer;padding: 5px 10px;border: 1px solid #ccc;width: 100%;height: 32px;width: 36px;\">\n            <i class=\"fas fa-history\" aria-hidden=\"true\"></i> \n            <span class=\"tooltiptext\">Show data for last ` + dayName.toLowerCase() + `</span>\n        </div>\n    </li>`)\n\n}\n\nfunction addExpandButton(nan = null, sensor, ylabels, xlabels, label = null, graphConfig = null) {\n\n    console.log(sensor)\n\n    // $(\".graph-\" + sensor + \" ul.pagination\").style.display = \"none\"\n\n    $(\".graph-\" + sensor + \" ul.pagination\").prepend(`<li class=\"page-item\">\n        <div id=\"expand-switch\" clicked=\"0\" ylabels=\"` + ylabels + `\" xlabels=\"` + xlabels + `\"\n        class=\"tooltip_test graph-button\"\n        style=\"background: #fff;cursor: pointer;padding: 5px 10px;border: 1px solid #ccc;width: 100%;height: 32px;width: 36px;\" >\n        <i class=\"fas fa-search-plus\"> </i> \n        <span class=\"tooltiptext\" > Fit the chart view </span> \n        </div>\n        </li>`)\n\n    $(\".graph-\" + sensor + \" #expand-switch\").css(\"display\", \"none\")\n\n    // if(nan==0) {\n    //     $(\".graph-\" + sensor + \" #expand-switch\").attr(\"enable\",\"false\")\n    //     $(\".graph-\" + sensor + \" #expand-switch\").attr(\"clicked\",\"disabled\")\n    // }\n\n    $(\"#expand-switch\").click(function () {\n        //     // console.log($(\".calendar-active\").length)\n        if ($(\".calendar-active\").length) {\n            //         addExpandButtonFlag = false\n            //         // console.log(\"zoom out\", attrInt, attrInt % 2 == 0)\n            //         sliceFlag = false\n            var ylabels_attr = $(this).attr('ylabels').split(\",\")\n            var xlabels_attr = $(this).attr('xlabels').split(\",\")\n            var xlabels_attr_clone = []\n            xlabels_attr.forEach(item => {\n                var aux = new Date(parseInt(item))\n                // console.log(item, aux, aux.getTime())\n                xlabels_attr_clone.push(aux.getTime())\n            })\n            //         // console.log(ylabels_attr)\n            //         // console.log(xlabels_attr_clone)\n\n            // plotData(sensor, ylabels_attr, xlabels_attr_clone, '', null)\n            // $(\".graph-\" + sensor + \" #expand-switch\").css(\"display\", \"none\")\n\n            // var oldHtml = $(\"#predictor-switch .tooltiptext\").attr(\"oldhtml\")\n            // switchButtonSecondGraph(sensor, attr = 'false')\n            // $(\"#predictor-switch .tooltiptext\").html(oldHtml)\n\n            //         // Remove calendar-active class\n            //         $(\"body\").removeClass(\"calendar-active\")\n\n            //         // Check history button\n            //         var isDisabled = $(\".graph-\" + sensorId + \" #predictor-switch\").attr(\"clicked\") == 'disabled'\n            //         var isOldHtml = $(\".graph-\" + sensorId + \" #predictor-switch .tooltiptext\").attr(\"oldhtml\")\n            //         if (isDisabled && isOldHtml) {\n            //             switchButtonSecondGraph(sensor, attr = 'false')\n            //             $(\".graph-\" + sensorId + \" #predictor-switch .tooltiptext\").html(isOldHtml)\n            //         }\n\n        } else {\n            //         var clickedAttr = $(this).attr('clicked')\n            //         var attrInt = parseInt(clickedAttr) + 1\n            //         $(this).attr('clicked', attrInt)\n            //         addExpandButtonFlag = false\n            //         if (attrInt % 2 == 1) {\n            //             // console.log(\"zoom in \", attrInt, attrInt % 2 == 0)\n            //             sliceFlag = true\n            //             plotData(sensor, ylabels, xlabels, label, graphConfig)\n            //         } else {\n            //             // console.log(\"zoom out\", attrInt, attrInt % 2 == 0)\n            //             sliceFlag = false\n            //             var ylabels_attr = $(this).attr('ylabels').split(\",\")\n            //             var xlabels_attr = $(this).attr('xlabels').split(\",\")\n            //             var xlabels_attr_clone = []\n            //             xlabels_attr.forEach(item => {\n            //                 var aux = new Date(parseInt(item))\n            //                 // console.log(item, aux, aux.getTime())\n            //                 xlabels_attr_clone.push(aux.getTime())\n            //             })\n            //             // console.log(ylabels_attr)\n            //             // console.log(xlabels_attr_clone)\n            //             plotData(sensor, ylabels_attr, xlabels_attr_clone, label, graphConfig)\n            //         }\n        }\n        //     // console.log(xlabels)\n        //     // console.log(ylabels)\n\n    })\n}\n\nvar sliceFlag = false\nvar addExpandButtonFlag = true\nvar chartList2 = []\n\nvar plotData = async (element, ylabels, xlabels, label, graphConfig = false) => {\n\n    // Check if there is data\n    // console.log(element, ylabels, ylabels.length)\n    // console.log(\"NEW chart for:\", element, \"ylabels.length\", ylabels.length, ylabels)\n\n    // console.log(\"y\", ylabels)\n    // console.log(\"x\", xlabels)\n\n    // console.log(ylabels[0], ylabels[0] == \"NaN\")\n\n    var original_ylabels = ylabels.slice()\n    var original_xlabels = xlabels.slice()\n\n    // Slice NaN Data\n    // If there is no data from 00:00 to 07:00 for example - all data between will be deleted\n    // ===============================================\n    if (ylabels[0] == \"NaN\" && sliceFlag == true) {\n\n        removeElement(ylabels, 0)\n        removeElement(xlabels, 0)\n\n        var counterTemperature = 0;\n        var counterTimestamp = 0;\n        var nanFlag = false\n\n        while (nanFlag == false) {\n            // console.log(\"nanFlag\", nanFlag, ylabels[0])\n            if (ylabels[0] == \"NaN\") {\n                // console.log(\"y,x:\", ylabels[0], xlabels[0])\n                // console.log(ylabels.length)\n                removeElement(ylabels, 0)\n                removeElement(xlabels, 0)\n                // console.log(ylabels.length)\n            } else {\n                nanFlag = true\n            }\n        }\n\n        // console.log(\"RESULT\")\n        // console.log(\"y\", ylabels)\n        // console.log(\"x\", xlabels)\n    } else if (sliceFlag == false) {\n\n        var counterNaN = 0\n        var nanFlag = false\n\n        while (nanFlag == false) {\n            if (ylabels[counterNaN] == \"NaN\") {\n                counterNaN++\n            } else {\n                nanFlag = true\n            }\n        }\n\n        var threshold = counterNaN / ylabels.length\n\n        if (addExpandButtonFlag) {\n            // add button to expand\n            // addExpandButton(nan = counterNaN, element, original_ylabels, original_xlabels, label, graphConfig)\n        }\n    }\n\n    // console.log(original_ylabels)\n    // console.log(original_xlabels)\n\n    // ===============================================\n    // END Slice NaN Data\n\n\n    // AI Prediction\n    // ===============================================\n    // console.log(\"PLOT DATA:\")\n\n    // for (i = 0; i < ylabels.length; i++) {\n    //     prediction[i] = null;\n    //     if (i == ylabels.length - 1) {\n    //         prediction[i] = ylabels[i];\n    //     }\n    // }\n\n    // Check last datestamp\n    // if (!$(\"body\").hasClass(\"calendar-active\")) {\n    //     // var xLastHour = xlabels[xlabels.length - 1]\n    //     // var lastDatestamp = xlabels[xlabels.length - 1]\n    //     // var convertLastDatestamp = new Date(lastDatestamp)\n    //     // var xLastHour = convertLastDatestamp.getHours()\n    //     // console.log(xLastHour, xlabels.length, xlabels.length/xLastHour)\n    // }\n\n\n    // for (var i = parseInt(xLastHour) + 1; i < 24; i++) {\n    //     xlabels.push(i.toString())\n    //     ylabels.push(null)\n    // prediction.push(Math.floor(Math.random() * (29 - 27 + 1)) + 27)\n    // }\n    // ===============================================\n    // END AI Prediction\n\n    // Get last week of this day\n    // ===============================================\n    var prediction_y = []\n    var prediction_x = []\n    let experiment = await getSensorDataExperiment(element);\n    // console.log(experiment[0])\n    if (!experiment[0].error)\n        experiment[0].sensorAverage.forEach(item => {\n            if (item.sensorValue) {\n                prediction_y.push(item.sensorValue.toFixed(1))\n            } else {\n                prediction_y.push(null)\n            }\n            prediction_x.push(item.sensorTime)\n        })\n    prediction_y = prediction_y.reverse()\n    prediction_x = prediction_x.reverse()\n    if (!$(\"#predictor-switch\").length) {\n        // addHistoryButton(element, prediction_x, prediction_y)\n    }\n    // console.log(\"prediction_y:\",prediction_y)\n    // console.log(\"prediction_x:\",prediction_x)\n    // ===============================================\n    // END Get last week of this day\n\n    // console.log(\"y:\", ylabels)\n    // console.log(\"x:\", xlabels)\n\n    // Get sensorType attribute\n    var sensorType = $('article.' + element + '-card').attr('sensorType')\n    label = sensorType\n\n    // console.log(label)\n\n    // Remove No data message\n    $('article.' + element + '-card .no-data-from-sensor').remove()\n\n    // Remove Loading Item\n    $('.' + element + '-graph-spinner').remove()\n\n    // Remove Old Canvas if exist\n    $('#' + element + '-graph').remove()\n\n    // add canvas\n    $('.' + element + '-card .card-body').append(`<canvas id=\"` + element + `-graph\"></canvas>`)\n\n    if (ylabels.length) {\n\n        /* CHART JS */\n        var chart_canvas = document.getElementById(element + '-graph').getContext(\"2d\");\n\n        if (graphConfig != false) {\n            var options = {\n                animation: false,\n                responsive: true,\n                maintainAspectRatio: false,\n                drawBorder: false,\n                // onResize: console.log(\"chart resize\"),\n                legend: {\n                    labels: {\n                        fontColor: 'white'\n                    }\n                },\n                scales: {\n                    xAxes: [{\n                        type: \"time\",\n                        time: {\n                            unit: graphConfig\n                        },\n                        // distribution: 'series',\n                        gridLines: {\n                            color: \"rgba(0, 0, 0, 0)\",\n                        },\n                        ticks: {\n                            fontColor: 'white'\n                        }\n                    }],\n                    yAxes: [{\n                        ticks: {\n                            beginAtZero: false,\n                            fontColor: 'white'\n                        },\n                        gridLines: {\n                            color: \"#415f7d\",\n                            zeroLineColor: '#415f7d'\n                        }\n                    }]\n                }\n            }\n        } else {\n            var options = {\n                animation: false,\n                responsive: true,\n                maintainAspectRatio: false,\n                drawBorder: false,\n                // onResize: console.log(\"chart resize\"),\n                legend: {\n                    labels: {\n                        fontColor: 'white'\n                    }\n                },\n                scales: {\n                    xAxes: [{\n                        type: \"time\",\n                        time: {\n                            unit: 'minute'\n                        },\n                        distribution: 'series',\n                        gridLines: {\n                            color: \"rgba(0, 0, 0, 0)\",\n                        },\n                        ticks: {\n                            fontColor: 'white'\n                        }\n                    }],\n                    yAxes: [{\n                        ticks: {\n                            beginAtZero: false,\n                            fontColor: 'white'\n                        },\n                        gridLines: {\n                            color: \"#415f7d\",\n                            zeroLineColor: '#415f7d'\n                        }\n                    }]\n                }\n            }\n        }\n\n        // var options = {\n        //     animation: false,\n        //     responsive: true,\n        //     maintainAspectRatio: false,\n        //     drawBorder: false,\n        //     // onResize: console.log(\"chart resize\"),\n        //     legend: {\n        //         labels: {\n        //             fontColor: 'white'\n        //         }\n        //     },\n        //     scales: {\n        //         xAxes: [{\n        //             type: \"time\",\n        //             time: {\n        //                 unit: 'day'\n        //             },\n        //             // distribution: 'series',\n        //             gridLines: {\n        //                 color: \"rgba(0, 0, 0, 0)\",\n        //             },\n        //             ticks: {\n        //                 fontColor: 'white'\n        //             }\n        //         }],\n        //         yAxes: [{\n        //             ticks: {\n        //                 beginAtZero: false,\n        //                 fontColor: 'white'\n        //             },\n        //             gridLines: {\n        //                 color: \"#415f7d\",\n        //                 zeroLineColor: '#415f7d'\n        //             }\n        //         }]\n        //     }\n        // }\n\n        var chart = new Chart(chart_canvas, {\n            type: 'line',\n            data: {\n                labels: xlabels,\n                datasets: [{\n                    label: label[0].toUpperCase() + label.slice(1, label.length),\n                    data: ylabels,\n\n                    // old design\n                    // backgroundColor: 'rgba(51, 153, 255, 0.2)',\n                    // borderColor: 'rgba(51, 153, 255, 1)',\n                    // pointBorderColor: '#343a40',\n                    // pointBackgroundColor: \"rgba(51, 153, 255, 1)\",\n                    // pointHoverBackgroundColor: \"white\",\n                    // pointRadius: 7,\n                    // pointHoverRadius: 7,\n                    // pointBorderWidth: 4,\n                    // borderWidth: 1,\n                    // lineTension: 0.2\n\n                    // new design\n                    backgroundColor: 'rgba(51, 153, 255, 0.2)',\n                    borderColor: 'rgba(51, 153, 255, 1)',\n                    pointBorderColor: '#343a40',\n                    pointBackgroundColor: \"rgba(51, 153, 255, 1)\",\n                    pointHoverBackgroundColor: \"#ffc107\",\n                    pointRadius: 1.5,\n                    pointHoverRadius: 7,\n                    pointBorderWidth: 1,\n                    borderWidth: 1,\n                    lineTension: 0.2\n\n                }]\n            },\n            options\n        });\n\n        // if (!experiment[0].error)\n        // switchSecondGraph(chart, element, prediction_y, prediction_x)\n        // else\n        // switchButtonSecondGraph(element, attr = 'disabled')\n\n        // return chart\n\n    } else {\n\n        // add no data message\n        // console.log(`<canvas id=\"` + element + `-graph\"></canvas> in`, '.' + element + '-card')\n        $('.' + element + '-card .card-body').append(`<p class='no-data-from-sensor' >No data from sensor with id <b>` + element + `</b> for today</p>`)\n\n        // add canvas\n        // console.log(`<canvas id=\"` + element + `-graph\"></canvas> in`, '.' + element + '-card')\n        // $('.' + element + '-card .card-body').append(`<canvas id=\"` + element + `-graph class='hidden-graph' \"></canvas>`)\n\n        // Remove Loading Item\n        // console.log('.' + element + '-graph-spinner', 'removed')\n        // $('.' + element + '-graph-spinner').remove()\n\n        /* CHART JS */\n        // console.log(element + '-graph', xlabels, ylabels, label)\n        $('#' + element + '-graph').addClass('hidden-graph')\n        var chart_canvas = document.getElementById(element + '-graph').getContext(\"2d\");\n\n        // if (chart) {\n        //     chart.destroy();\n        // }\n\n        var chart = new Chart(chart_canvas, {\n            type: 'line',\n            data: {\n                labels: xlabels,\n                datasets: [{\n                    label: label,\n                    data: ylabels,\n                    backgroundColor: '#bac8db',\n                    borderColor: 'rgba(255, 99, 132, 1)',\n                    borderWidth: 1\n                }]\n            },\n            options: {\n                animation: false,\n                responsive: true,\n                maintainAspectRatio: false,\n                scales: {\n                    yAxes: [{\n                        ticks: {\n                            beginAtZero: true\n                        }\n                    }]\n                }\n            }\n        });\n\n\n\n    }\n\n    $('article.' + element + '-card').attr(\"xlabels\", xlabels)\n    $('article.' + element + '-card').attr(\"ylabels\", ylabels)\n\n    // filename = filename.split(\" \")\n    // console.log(filename)\n\n    // document.getElementById(\"report\").addEventListener(\"click\", function (e) {\n    // $(\"#report\").click(function (e) {\n    //     e.preventDefault();\n    //     downloadCSV({\n    //         filename,\n    //         chart\n    //     })\n    // })\n    // });\n\n    chartList2.push(chart)\n    return chart\n\n}\n\nfunction convertChartDataToCSV(args) {\n    // console.log(args.data)\n    // var result, ctr, keys, columnDelimiter, lineDelimiter, data;\n\n    // data = args.data || null;\n    // if (data == null || !data.length) {\n    //     return null;\n    // }\n\n    // columnDelimiter = args.columnDelimiter || ',';\n    // lineDelimiter = args.lineDelimiter || '\\n';\n\n    // keys = Object.keys(data[0]);\n\n    // result = '';\n    // result += keys.join(columnDelimiter);\n    // result += lineDelimiter;\n\n    // data.forEach(function (item) {\n    //     ctr = 0;\n    //     keys.forEach(function (key) {\n    //         if (ctr > 0) result += columnDelimiter;\n    //         result += item[key];\n    //         ctr++;\n    //     });\n    //     result += lineDelimiter;\n    // });\n    // return result;\n}\n\nfunction addDataAttributeToGraph(sensorId, x, y) {\n    document.querySelector(\".graph-\" + sensorId + \" #reportrange\").setAttribute('xlabels', x)\n    document.querySelector(\".graph-\" + sensorId + \" #reportrange\").setAttribute('ylabels', y)\n}\n\n// select mean(value) as value, first(type) as type from sensors where username='alexbarbu2' and county='constanta' and sensorId='sensor22' and time>='2020-06-29T09:00:00.000000000Z' and time<'2020-07-01T17:00:00.000000000Z' GROUP BY time(1h) ORDER BY time DESC\n\nfunction defaultSensorView(sensorId, sensorType, sensorZone) {\n\n    // console.log(\"append\")\n\n    sensorId = String(sensorId)\n\n    // current value gauge component\n    var currentValueView = `\n    <article class=\"card height-control live-card-` + sensorId + `\" sensorId=\"` + sensorId + `\">\n\n    <div class=\"card-header\">\n        <h3 class=\"card-title\">\n            <i class='update-icon'></i>\n            Current Value\n        </h3>\n        <span class='card-settings-button hidden-button'>\n            <i class=\"far fa-sliders-h\"></i>\n        </span>\n    </div>\n\n    <div class=\"card-body\">\n        <div class=\"` + sensorId + `-currentValue\">\n            <a href=\"#\" class='spinner ` + sensorId + `-currentValue-spinner'>\n                <span>Loading...</span>\n            </a>\n            <div id=\"` + sensorId + `-gauge\" class=\"gauge-container two hidden-element\">\n                <span class=\"currentValue\"></span>\n            </div>\n        </div>\n    </div>\n\n    <div class='card-alerts-settings alert-` + sensorId + `'>\n        <span class='card-settings-button-alert tooltip_test'>\n            <i class=\"fas fa-bell\"></i>\n            <span class=\"tooltiptext\">New feature is coming!</span>\n        </span>\n        <span class='card-settings-button-update tooltip_test'>\n            <i class=\"fas fa-save\"></i>\n            <span class=\"tooltiptext\">By clicking you will update alerts and location!</span>\n        </span>\n        <span class='card-settings-button-inner'>\n            <i class=\"far fa-sliders-h\"></i>\n        </span>\n        <div class='settings-wrapper'>\n            <div class=\"slidecontainer\">\n                <p class='label-input'>Minimum</p>\n                <input type=\"number\" placeholder=\"Type lower alert...\" class=\"input input-min\">\n                <p class='label-input'>Maximum</p>\n                <input type=\"number\" placeholder=\"Type upper alert...\" class=\"input input-max\">\n                <p class='label-input'>Lat</p>\n                <input type=\"number\" placeholder=\"Type lat value...\" class=\"input input-lat\">\n                <p class='label-input'>Long</p>\n                <input type=\"number\" placeholder=\"Type long value...\" class=\"input input-long\">\n            </div>\n        </div>\n    </div>\n    `\n\n    // counter noriel ui\n    var newItemLive = `\n    <article class=\"card height-control live-card-` + sensorId + `\">\n\n    <div class=\"card-header\">\n        <h3 class=\"card-title\">\n            <i class='update-icon'></i>\n            Live Update\n        </h3>\n    </div>\n\n    <div class=\"card-body\">\n        <div class=\"` + sensorId + `-newItem\">\n\n            <a href=\"#\" class='spinner ` + sensorId + `-newItem-spinner'>\n                <span>Loading...</span>\n            </a>\n\n            <div id=\"` + sensorId + `-floatinBall\" class=\"hidden-element\"></div>\n\n        </div>\n    </div>`\n\n    // graph view component\n    var graphView = `</article>\n\n    <article class=\"card height-control ` + sensorId + `-card graph-` + sensorId + `\" sensorType=\"` + sensorType + `\" sensorId=\"` + sensorId + `\">\n    \n        <div class=\"card-header\">\n\n            <h3 class=\"card-title\">\n                <i class='update-icon'></i>\n                <span>` + sensorZone + `</span> |\n                <b>` + sensorId + `</b>\n            </h3>\n    \n            <div class=\"card-tools\">\n                <ul class=\"pagination pagination-sm\">\n\n                    <li class=\"page-item\">\n                        <div id=\"reportrange\" style=\"background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc; width: 100%\">\n                            <i class=\"fa fa-calendar\"></i>&nbsp;\n                            <span></span> <i class=\"fa fa-caret-down\"></i>\n                        </div>\n                    </li>\n\n                    <li class=\"page-item\">\n                        <div id=\"report\" class=\"tooltip_test\" style=\"background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc; width: 100%\">\n                            <i class=\"fas fa-file-csv\"></i>\n                            <span class=\"tooltiptext\">Download CSV</span>\n                        </div>\n                    </li>\n\n                </ul>\n            </div>\n    \n        </div>\n        \n    \n        <div class=\"card-body\">\n            <a href=\"#\" class='spinner ` + sensorId + `-graph-spinner'>\n                <span>Loading...</span>\n            </a> \n            <div class=\"` + sensorId + `-graph-calendar graph-calendar\">\n                Time interval for ` + sensorId + ` \n                <input name=\"dates\" value=\"Button Change\"> \n            </div> \n        </div>\n        \n    </article>`\n\n    // stack the components\n    if (sensorType == 'counter') {\n        return newItemLive + graphView\n    } else {\n        return currentValueView + graphView\n    }\n\n}\n\nvar alertsLoadFlag = true\n\n\nlet readAlerts = async () => {\n    let alerts = await fetch(\"https://anysensor.dasstec.ro/api/read-alerts\")\n    return alerts.json()\n}\n\n// let readLocation = async () => {\n//     let alerts = await fetch(\"https://anysensor.dasstec.ro/api/read-location\")\n//     return alerts.json()\n// }\n\nfunction alertsAndLocationLoad() {\n    // console.log(\"alertsAndLocationLoad()\")\n    if (alertsLoadFlag) {\n        (async () => {\n            // alertsLoadFlag = false\n            let alerts = await readAlerts() //this returns all the alerts in mysql - it should return only the alerts of this user\n            // console.log(alerts)\n            for (var i = 0; i < alerts.result.length; i++) {\n                var sensorId = alerts.result[i].sensorId\n\n                // load alert' values\n                $(`.live-card-` + sensorId + ` .input-min`).attr(\"value\", alerts.result[i].min)\n                $(`.live-card-` + sensorId + ` .input-max`).attr(\"value\", alerts.result[i].max)\n\n            }\n\n            // load locations into inputs value\n            // console.log(getLocationObj())\n            var locationObj = getLocationObj()\n            for (var item in locationObj) {\n                // console.log(item, locationObj[item])\n                $(\"article[class*='live'][sensorid='\" + item + \"'] .input-lat\").attr(\"value\", locationObj[item][0])\n                $(\"article[class*='live'][sensorid='\" + item + \"'] .input-long\").attr(\"value\", locationObj[item][1])\n            }\n            // try {\n            //     var locationObj = getLocationObj()\n            //     console.log(locationObj,sensorId)\n            //     if (locationObj[sensorId] != undefined) {\n            //         // console.log(locationObj, locationObj[sensorId])\n            //         // console.log($(\"article[class*='live'][sensorid='\" + sensorId + \"'] .input-lat\").length)\n            //         // $(\"article[class*='live'][sensorid='\" + sensorId + \"'] .input-lat\").val(locationObj[sensorId][0])\n            //         // $(\"article[class*='live'][sensorid='\" + sensorId + \"'] .input-long\").val(locationObj[sensorId][1])\n            //         // console.log(sensorId, $(\"article[class*='live'][sensorid='\" + sensorId + \"'] .input-lat\").val())\n            //         $(\"article[class*='live'][sensorid='\" + sensorId + \"'] .input-lat\").attr(\"value\", locationObj[sensorId][0])\n            //         $(\"article[class*='live'][sensorid='\" + sensorId + \"'] .input-long\").attr(\"value\", locationObj[sensorId][1])\n            //     }\n            // } catch {\n            //     $(\"article[class*='live'][sensorid='\" + sensorId + \"'] .input-lat\").attr(\"value\", \"not set\")\n            //     $(\"article[class*='live'][sensorid='\" + sensorId + \"'] .input-long\").attr(\"value\", \"not set\")\n            // }\n\n        })()\n    }\n\n}\n\nfunction sensorSettingsToggle(sensorId) {\n\n    $(\".live-card-\" + sensorId + \" .card-settings-button\").removeClass(\"hidden-button\")\n\n    $(\".live-card-\" + sensorId + \"  .card-settings-button\").click(function () {\n        $(this).parent().parent().children('.card-alerts-settings').toggleClass('alerts-settings-up')\n        $(this).parent().parent().children('.card-body').toggleClass('blur8')\n        $(this).parent().parent().children('.card-header').toggleClass('blur8')\n\n        alertsAndLocationLoad()\n\n    })\n    $(\".live-card-\" + sensorId + \"  .card-settings-button-inner\").click(function () {\n        $(this).parent().parent().children('.card-alerts-settings').toggleClass('alerts-settings-up')\n        $(this).parent().parent().children('.card-body').toggleClass('blur8')\n        $(this).parent().parent().children('.card-header').toggleClass('blur8')\n    })\n\n    $(\".live-card-\" + sensorId + \" .card-settings-button-update\").click(function () {\n        // these two should use promises and call one after another\n        updateSensorSettings(sensorId)\n        // appendAlertsToHTML(sensorId)\n    })\n}\n\nlet saveSensorSettings = async (sensorId, minVal, maxVal, lat, long, sensorType = null) => {\n    // let response = await fetch(\"https://anysensor.dasstec.ro/api/set-alerts/?sensorId='\" + sensorId + \"'&min=\" + minVal + \"&max=\" + maxVal + \"&lat=\" + lat + \"&long=\" + long)\n    // console.log(await response)\n    // return response.json()\n\n    // need to replace with ajax request for notification\n    $.ajax({\n        url: \"https://anysensor.dasstec.ro/api/set-alerts/?sensorId='\" + sensorId + \"'&sensorType='\" + sensorType + \"'&min=\" + minVal + \"&max=\" + maxVal + \"&lat=\" + lat + \"&long=\" + long,\n        type: 'GET',\n        success: function (msg) {\n            alert(\"Alerts and location updated!\")\n            console.log({\n                msg,\n                url: \"https://anysensor.dasstec.ro/api/set-alerts/?sensorId='\" + sensorId + \"'&sensorType='\" + sensorType + \"'&min=\" + minVal + \"&max=\" + maxVal + \"&lat=\" + lat + \"&long=\" + long\n            })\n        }\n    });\n}\n\nasync function updateSensorSettings(sensorId) {\n\n    const minVal = $(\".live-card-\" + sensorId + \" .settings-wrapper .input-min\").val()\n    const maxVal = $(\".live-card-\" + sensorId + \" .settings-wrapper .input-max\").val()\n    const lat = $(\".live-card-\" + sensorId + \" .settings-wrapper .input-lat\").val()\n    const long = $(\".live-card-\" + sensorId + \" .settings-wrapper .input-long\").val()\n    const sensorType = $(\"article[class*='graph-'][sensorid='\" + sensorId + \"']\").attr(\"sensortype\")\n\n    $(\"article[class*='live'][sensorid='\" + sensorId + \"'] .gauge-container .minAlertGauge\").html(\"min: \" + minVal)\n    $(\"article[class*='live'][sensorid='\" + sensorId + \"'] .gauge-container .maxAlertGauge\").html(\"max: \" + maxVal)\n\n    await saveSensorSettings(sensorId, minVal, maxVal, lat, long, sensorType)\n\n}\n\nfunction sliderAlerts(element) {\n\n    $(document).on('input', element, function () {\n        var stringList = String(element).split('-')\n        var pClass = stringList[stringList.length - 1]\n        $(this).siblings('.text-slider-' + pClass).children('span').html($(this).val())\n        // console.log($(this).val(), pClass);\n        //vals\n        var optimVal = $(\"#slider-optim\").val()\n        var midVal = $(\"#slider-mid\").val()\n        var warningVal = $(\"#slider-warning\").val()\n        // sliders\n        var optimSlider = $(\"#slider-optim\")\n        var midSlider = $(\"#slider-mid\")\n        var warningSlider = $(\"#slider-warning\")\n        // if\n        if (optimVal) {\n            midSlider.attr(\"min\", optimVal)\n            warningSlider.attr(\"min\", midVal)\n        }\n\n    });\n\n}\n\n// Time Interval Change\nfunction timeIntervalChanger(sensorId, chartList) {\n\n    const overlay = $(\".main-overlay\")\n    const cancelBtn = $(\".daterangepicker .cancelBtn\")\n    const applyBtn = $(\".daterangepicker .applyBtn\")\n    const range = $(\".ranges ul li:not(:last-child)\")\n    const main = $(\"#main\")\n\n    // open the overlay\n    $('.' + sensorId + '-card #reportrange').click(function () {\n        // overlay.addClass(\"force-show-overlay\")\n        // main.addClass(\"no-scroll\")\n    })\n\n    // close the overlay\n    // overlay.click(function () {\n    //     console.log(\"------------>click overlay\")\n    //     overlay.removeClass(\"force-show-overlay\")\n    //     main.removeClass(\"no-scroll\")\n    // });\n\n    // cancelBtn.click(function () {\n    //     overlay.removeClass(\"force-show-overlay\")\n    //     main.removeClass(\"no-scroll\")\n    // });\n\n    // applyBtn.click(function () {\n    //     console.log(\"------------>click apply\")\n    //     overlay.removeClass(\"force-show-overlay\")\n    //     main.removeClass(\"no-scroll\")\n    // });\n\n    // range.click(function () {\n    //     overlay.removeClass(\"force-show-overlay\")\n    //     main.removeClass(\"no-scroll\")\n    // });\n\n    var currentHourPm = moment().format(\"HH\")\n    var currentMin = moment().format(\"mm\")\n    var start = moment().subtract(currentHourPm, 'hours').subtract(currentMin, 'minutes');\n    var end = moment();\n\n    $('.' + sensorId + '-card #reportrange').daterangepicker({\n        // startDate: start,\n        // endDate: end,\n        timePicker: true,\n        \"timePicker24Hour\": true,\n        startDate: moment().startOf('hour').subtract(currentHourPm, 'hour'),\n        endDate: moment().startOf('hour').add(24 - currentHourPm, 'hour'),\n        // ranges: {\n        //     'Today': [moment(), moment()],\n        //     'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],\n        //     'Last 7 Days': [moment().subtract(6, 'days'), moment()],\n        //     'Last 30 Days': [moment().subtract(29, 'days'), moment()],\n        //     'This Month': [moment().startOf('month'), moment().endOf('month')],\n        //     'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]\n        // }\n    }, callback);\n\n    function callback(start, end, chartList) {\n        // $('.' + sensorId + '-card #reportrange span').html(start.format('MMM D, YYYY, HH:mm') + ' - ' + end.format('MMM D, YYYY, HH:mm'));\n        // plot data from influx with a new time interval\n        // reloadDataCustomCalendar(start, end, countyName, sensorId);\n\n        // console.log()\n\n        start = start.format('YYYY-MM-DD' + 'T' + 'HH:mm').split(\"+\")[0] + ':00.000000000Z'\n        end = end.format('YYYY-MM-DD' + 'T' + 'HH:mm').split(\"+\")[0] + ':00.000000000Z'\n\n        // subtract 3 hours because of timezone\n        // subtract 1 more hour because influx is 1 hour behind\n\n        // console.log(start, end)\n\n        startAux = new Date(start) - (4 * 60 * 60 * 1000)\n        endAux = new Date(end) - (4 * 60 * 60 * 1000)\n\n        // console.log(startAux, endAux)\n\n        start = moment(new Date(startAux)).format('YYYY-MM-DD' + 'T' + 'HH:mm').split(\"+\")[0] + ':00.000000000Z'\n        end = moment(new Date(endAux)).format('YYYY-MM-DD' + 'T' + 'HH:mm').split(\"+\")[0] + ':00.000000000Z'\n\n        // console.log(start, end)\n\n        reloadDataCustomCalendar(start, end, countyName, sensorId, chartList)\n    }\n\n    callback(start, end, chartList);\n}\n\n// not used\nfunction currentValueGauge(element) {\n    console.log(element)\n    // JS \n    var chart = JSC.chart(element, {\n        debug: true,\n        type: 'gauge ',\n        legend_visible: false,\n        chartArea_boxVisible: false,\n        xAxis: {\n            /*Used to position marker on top of axis line.*/\n            scale: {\n                range: [0, 1],\n                invert: true\n            }\n        },\n        palette: {\n            pointValue: '%yValue',\n            ranges: [{\n                    value: 350,\n                    color: '#FF5353'\n                },\n                {\n                    value: 400,\n                    color: '#FFD221'\n                },\n                {\n                    value: 700,\n                    color: '#77E6B4'\n                },\n                {\n                    value: [800, 850],\n                    color: '#21D683'\n                }\n            ]\n        },\n        yAxis: {\n            defaultTick: {\n                padding: 13,\n                enabled: false\n            },\n            customTicks: [400, 700, 800],\n            line: {\n                width: 15,\n                breaks_gap: 0.03,\n                color: 'smartPalette'\n            },\n            scale: {\n                range: [350, 850]\n            }\n        },\n        defaultSeries: {\n            opacity: 1,\n            shape: {\n                label: {\n                    align: 'center',\n                    verticalAlign: 'middle'\n                }\n            }\n        },\n        series: [{\n            type: 'marker',\n            name: 'Score',\n            shape_label: {\n                text: \"720<br/> <span style='fontSize: 35'>Great!</span>\",\n                style: {\n                    fontSize: 48\n                }\n            },\n            defaultPoint: {\n                tooltip: '%yValue',\n                marker: {\n                    outline: {\n                        width: 10,\n                        color: 'currentColor'\n                    },\n                    fill: 'white',\n                    type: 'circle',\n                    visible: true,\n                    size: 30\n                }\n            },\n            points: [\n                [1, 620]\n            ]\n        }]\n    });\n}\n\nfunction fontAwesomeClassGenerator(type) {\n\n    switch (type) {\n        case 'temperatura':\n            var faClass = `fas fa-temperature-high mr-1`\n            break;\n        case 'temperature':\n            var faClass = `fas fa-temperature-high mr-1`\n            break;\n        case 'counter':\n            var faClass = `far fa-chart-line`\n            break;\n        case 'scale':\n            var faClass = `fas fa-balance-scale`\n            break;\n        case 'voltage':\n            var faClass = `fas fa-car-battery`\n            break;\n        default:\n            var faClass = `fas fa-spinner`\n    }\n\n    return faClass\n\n    // select an icon\n    // if (type == 'type1' || type == 'temperatura' || type == 'temperature') {\n    //     var faClass = `fas fa-temperature-high mr-1`\n    // } else if (type == 'type2') {\n    //     var faClass = `far fa-lightbulb`\n    // } else if (type == 'type3') {\n    //     var faClass = `fas fa-bolt`\n    // } else if (type == 'type4') {\n    //     var faClass = `fas fa-adjust`\n    // } else if (type == 'counter') {\n    //     var faClass = `far fa-chart-line`\n    // } else {\n    //     var faClass = type + `_icon`\n    // }\n\n    // return faClass\n}\n\n// append min and max after the alerts are modified (not always)\nfunction appendAlertsToHTML(sensorId_) {\n\n    (async () => {\n\n        // console.log(\"called for\", sensorId_)\n\n        let alerts = await readAlerts()\n\n        var alertsDict = []\n\n        var alertCounter = 0\n\n        for (var i = 0; i < alerts.result.length; i++) {\n\n            var bodyEl = $(\"body\")\n            if (sensorId_.includes(alerts.result[i].sensorId)) {\n                alertsDict[alertCounter] = [alerts.result[i].sensorId, alerts.result[i].min, alerts.result[i].max, alerts.result[i].sensorType]\n                alertCounter++\n            }\n\n        }\n\n        alertsDict.forEach(alert => {\n            // console.log(alert, sensorId_)\n\n            if (sensorId_ == alert[0]) {\n\n                $(\"article[class*='live'][sensorid='\" + sensorId_ + \"'] .gauge-container .minAlertGauge\").html(alert[1])\n                $(\"article[class*='live'][sensorid='\" + sensorId_ + \"'] .gauge-container .axAlertGauge\").html(alert[2])\n\n            }\n\n        })\n\n    })()\n}\n\n// append alerts initially\nasync function appendAlertsToHTMLAsync(sensorId_) {\n\n    // console.log(\"called for\", sensorId_)\n\n    let alerts = await readAlerts()\n\n    var alertsDict = []\n\n    var alertCounter = 0\n\n    for (var i = 0; i < alerts.result.length; i++) {\n\n        var bodyEl = $(\"body\")\n        if (sensorId_.includes(alerts.result[i].sensorId)) {\n            alertsDict[alertCounter] = [alerts.result[i].sensorId, alerts.result[i].min, alerts.result[i].max, alerts.result[i].sensorType]\n            alertCounter++\n        }\n\n    }\n\n    // bodyEl.prepend(`<alerts style=\"display:none\">` + JSON.stringify(alertsDict) + `</alerts>`)\n\n    var min_ = NaN;\n    var max_ = NaN;\n\n    alertsDict.forEach(alert => {\n        // console.log(alert, sensorId_)\n\n        if (sensorId_ == alert[0]) {\n\n            min_ = alert[1]\n            max_ = alert[2]\n\n            $(\"article[class*='live'][sensorid='\" + sensorId_ + \"'] .gauge-container .minAlertGauge\").remove()\n            $(\"article[class*='live'][sensorid='\" + sensorId_ + \"'] .gauge-container .maxAlertGauge\").remove()\n            $(\"article[class*='live'][sensorid='\" + sensorId_ + \"'] .gauge-container\").prepend(`<span class='minAlertGauge' value='` + alert[1] + `' sensortype='` + alert[3] + `'>min: ` + alert[1] + `</span><span class='maxAlertGauge' value='` + alert[2] + `' sensortype='` + alert[3] + `'>max: ` + alert[2] + `</span>`)\n            // if sensortype = voltage add .alert-type-voltage class\n            if (alert[3] == \"voltage\") {\n                $(\"article[class*='live'][sensorid='\" + sensorId_ + \"'] .gauge-container .currentValue\").addClass(\"alert-type-voltage\")\n                $(\"article[class*='live'][sensorid='\" + sensorId_ + \"'] .gauge-container .minAlertGauge\").addClass(\"alert-type-voltage\")\n                $(\"article[class*='live'][sensorid='\" + sensorId_ + \"'] .gauge-container .maxAlertGauge\").addClass(\"alert-type-voltage\")\n            }\n            // if sensortype = temperature add .alert-type-temperature\n            if (alert[3] == \"temperature\") {\n                $(\"article[class*='live'][sensorid='\" + sensorId_ + \"'] .gauge-container .currentValue\").addClass(\"alert-type-temperature\")\n                $(\"article[class*='live'][sensorid='\" + sensorId_ + \"'] .gauge-container .minAlertGauge\").addClass(\"alert-type-temperature\")\n                $(\"article[class*='live'][sensorid='\" + sensorId_ + \"'] .gauge-container .maxAlertGauge\").addClass(\"alert-type-temperature\")\n\n                // console.log($(\"#\" + sensorId_ + \"-gauge span\").length)\n            }\n        }\n\n    })\n\n    // console.log(min_, max_)\n\n    return [min_, max_]\n}\n\n// get list of sensors from a county\nlet getData = async () => {\n    // console.log(\"getData\")\n    let response = await fetch(\"https://anysensor.dasstec.ro/api/v2/get-data/sensorId/\" + countyName)\n    // console.log(\"getData\",new Date()-time)\n    return response.json()\n}\n\n// get all values of a sensor\nlet getSensorData = async (sensor) => {\n    // console.log(\"getSensorData\")\n    let response = await fetch(\"https://anysensor.dasstec.ro/api/v2/get-data/\" + countyName + \"/\" + sensor)\n    // console.log(\"getSensorData\",new Date()-time)\n    return response.json()\n}\n\n// experiment\nlet getSensorDataExperiment = async (sensor) => {\n    // console.log(\"getSensorData\")\n    let response = await fetch(\"https://anysensor.dasstec.ro/api/experiment/get-data/\" + countyName + \"/\" + sensor)\n    // console.log(\"getSensorData\",new Date()-time)\n    return response.json()\n}\n\n// get last recorded value of a sensor\nlet getLatestValueRecorded = async (sensor) => {\n    // console.log(\"getLatestValueRecorded\")\n    let response = await fetch(\"https://anysensor.dasstec.ro/api/get-data/last/\" + countyName + \"/\" + sensor)\n    // console.log(\"getLatestValueRecorded\",new Date()-time)\n    return response.json()\n}\n\n// get and plot data by a specific interval\nlet getSensorDataCustomInterval = async (countyName, sensor, start, end, chartList) => {\n\n    // addExpandButton(sensor)\n\n    if (!$(\"body\").hasClass(\"calendar-active\")) {\n        $(\"body\").addClass(\"calendar-active\")\n\n        // var oldHtml = $(\"#predictor-switch .tooltiptext\").html()\n        // $(\"#predictor-switch .tooltiptext\").attr(\"oldhtml\", oldHtml)\n\n        // switchButtonSecondGraph(sensor, attr = 'disabled')\n        // $(\"#predictor-switch .tooltiptext\").html(\"The functionality is disabled when calendar view is active - refresh the page\")\n\n        // $(\".graph-\" + sensor + \" #expand-switch\").css(\"display\", \"block\")\n    }\n\n    const date1 = new Date(start);\n    const date2 = new Date(end);\n    const diffTime = Math.abs(date2 - date1);\n    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n    const diffHours = diffTime / 1000 / 60 / 60\n    // console.log(diffHours + \" hours\");\n\n    if (diffDays <= 1) {\n        if (diffHours <= 1) {\n            var step = '1mins'\n        } else if (diffHours <= 3) {\n            var step = '10mins'\n        } else if (diffHours <= 6) {\n            var step = '10mins'\n            // var step = '10mins'\n        } else {\n            // var step = 'hourly'\n            var step = '10mins'\n        }\n    } else if (diffDays <= 6)\n        // var step = 'hourlyS'\n        var step = '30mins'\n    else if (diffDays <= 45)\n        // var step = 'daily'\n        var step = 'daily'\n    else\n        var step = 'dailyS'\n\n    const query = \"https://anysensor.dasstec.ro/api/get-interval/\" + step + \"?\" + \"county=\" + countyName + \"&sensorQuery=\" + sensor + \"&start=\" + start + \"&end=\" + end\n    // console.log(query)\n\n    // remove graph and add loading\n    $(\"#\" + sensor + \"-graph\").parent().parent().attr(\"calendar\", \"on\")\n    $(\"#\" + sensor + \"-graph\").parent().append(`<a href=\"#\" class='spinner ` + sensor + `-graph-spinner'><span>Loading...</span></a> `)\n    $(\"#\" + sensor + \"-graph\").remove() //remove existing graph\n\n    fetch(query).then((response) => {\n        // console.log(\"fetch\")\n        return response.json()\n    }).then((data) => {\n        // console.log(data[0]);\n        // console.log(data[0].error)\n        const sensorId = data[0].sensorQueried\n        const graphId = sensorId + '-graph'\n\n        // console.log(data[0])\n\n        if (data[0].error == false) {\n\n            var label = ''\n            var labelIdx = 0\n\n            try {\n                while (label.length == 0) {\n                    // console.log(data[0].sensorAverage[labelIdx])\n                    if (data[0].sensorAverage[labelIdx].sensorType != null) {\n                        label = data[0].sensorAverage[labelIdx].sensorType\n                    }\n                    labelIdx++;\n                }\n            } catch {\n                // console.warn(\"There is no sensorType for\",sensorId)\n            }\n\n            const ylabels = []\n            const xlabels = []\n\n            for (var i = 0; i < data[0].sensorReadings; i++) {\n\n                // ylabel preprocess\n                ylabels.push(parseFloat(data[0].sensorAverage[i].sensorValue).toFixed(2))\n\n                // xlabel preprocess\n                var influxTime = data[0].sensorAverage[i].sensorTime\n                // console.log(influxTime)\n                var newDate = new Date(influxTime)\n                // console.log(newDate)\n                var adjustedDate = newDate.setHours(newDate.getHours() - 2)\n                // console.log(adjustedDate)\n                xlabels.push(adjustedDate)\n\n                // var influxH = influxTime.split(\"T\")[1].split(\":\")[0]\n                // var influxMins = influxTime.split(\"T\")[1].split(\":\")[1]\n                // console.log(\"STEP: \", step, diffDays, diffHours)\n                if (step == '1mins') {\n                    graphConfig = 'second'\n                    //     influxH = parseInt(influxH) + 1\n                    //     xlabels.push(influxH < 10 ? \"0\" + String(influxH) + \":\" + String(influxMins) : (influxH == 24 ? \"00\" + \":\" + String(influxMins) : String(influxH) + \":\" + String(influxMins)))\n                } else if (step == '10mins' || step == '30mins') {\n                    graphConfig = 'minute'\n                } else if (step == 'hourly') {\n                    graphConfig = 'hour'\n                    //     // var influxDay = influxTime.split(\"T\")[0].split(\"-\")[2]\n\n                    //     // var influxMonth = influxTime.split(\"T\")[0].split(\"-\")[1]\n                    //     // influxMonth = parseInt(influxMonth)\n                    //     // influxMonth = monthChanger(influxMonth).slice(0, 3)\n\n                    //     influxH = parseInt(influxH) + 1\n                    //     // influxH = influxDay + \" \" + influxMonth + \" \" + influxH + ':00'\n\n                    //     // example: influxH = '29 Jun 17:00'\n\n                    //     xlabels.push(influxH < 10 ? \"0\" + String(influxH) : (influxH == 24 ? \"00\" : String(influxH)))\n\n                } else if (step == 'hourlyS') {\n                    graphConfig = 'hour'\n                    //     var influxDay = influxTime.split(\"T\")[0].split(\"-\")[2]\n\n                    //     var influxMonth = influxTime.split(\"T\")[0].split(\"-\")[1]\n                    //     influxMonth = parseInt(influxMonth)\n                    //     influxMonth = monthChanger(influxMonth).slice(0, 3)\n\n                    //     influxH = parseInt(influxH) + 1\n                    //     influxH = influxDay + \" \" + influxMonth + \" \" + influxH + ':00'\n\n                    //     // example: influxH = '29 Jun 17:00'\n\n                    //     xlabels.push(influxH)\n\n                } else if (step == 'daily') {\n                    graphConfig = 'day'\n                    //     var influxDay = influxTime.split(\"T\")[0].split(\"-\")[2]\n\n                    //     var influxMonth = influxTime.split(\"T\")[0].split(\"-\")[1]\n                    //     influxMonth = parseInt(influxMonth)\n                    //     influxMonth = monthChanger(influxMonth).slice(0, 3)\n\n                    //     // influxH = parseInt(influxH) + 1\n                    //     // influxH = influxDay + \" \" + influxMonth + \" \" +influxH +':00'\n                    //     // example: influxH = '29 Jun 17:00'\n\n\n                    //     xlabels.push(influxDay + \" \" + influxMonth)\n\n                } else {\n                    graphConfig = 'day'\n                    //     var influxDay = influxTime.split(\"T\")[0].split(\"-\")[2]\n\n                    //     var influxMonth = influxTime.split(\"T\")[0].split(\"-\")[1]\n                    //     influxMonth = parseInt(influxMonth)\n                    //     influxMonth = monthChanger(influxMonth).slice(0, 3)\n\n                    //     // influxH = parseInt(influxH) + 1\n                    //     // influxH = influxDay + \" \" + influxMonth + \" \" +influxH +':00'\n                    //     // example: influxH = '29 Jun 17:00'\n\n\n                    //     xlabels.push(influxDay + \" \" + influxMonth)\n                }\n\n                // console.log(step, influxH)\n\n\n                // influx time is 1 hour behind romanian timezone\n                // increment influx with 2 because:\n                // if time of influx is 8:20, it means that romanian hour is 9:20\n                // and all the values between 9 to 10 (ro timezone) and (8 to 9 - influx timezone) is displayed as average at 10h (ro rimezone)\n                // that's why is incremented with 2\n\n\n                // xlabels.push(parseInt(influxH)+1)\n            }\n\n            // console.log(\"aici\")\n\n            // xlabels.push(hour+1 < 10 ? \"0\" + String(hour+1) : String(hour+1))\n\n            const xlabels_reversed = xlabels.reverse()\n            const ylabels_reversed = ylabels.reverse()\n\n\n            $(\"#\" + graphId).removeClass('hidden-graph');\n            $('#' + graphId).parent().children('.no-data-from-sensor').remove();\n\n            /* CHART JS RE-APPEND */\n\n            // remove loading spinner and append graph\n            addExpandButtonFlag = false\n            plotData(sensorId, ylabels_reversed, xlabels_reversed, label, graphConfig)\n\n            $(\"#\" + graphId).css(\"min-height\", \"250px\")\n\n        } else {\n            // Remove Loading Item\n            $('.' + sensorId + '-graph-spinner').remove()\n            // add no data message\n            $('.' + sensorId + '-card .card-body').append(`<p class='no-data-from-sensor' >No data for specified time range</p>`)\n        }\n\n        // console.log(typeof chartList)\n        // chartList.forEach((chart) => {\n        //     // console.log(data[0].error)\n        //     if (chart != undefined && data[0].error == false) {\n        //         // chart[0] == sensorIdToLookFor ? console.log(chart[0],chart[1],ylabels_reversed) : 0\n        //         // console.log(chart[0] == sensor, chart[1] != undefined)\n\n        //         if (chart[0] == sensor && chart[1] != undefined) {\n        //             //     // console.log(\"chart:\",chart[1])\n        //             //     // console.log(\"sent data:\",ylabels_reversed)\n        //             console.log(\"chart:\", chart)\n        //             // $(\"#\"+sensor+\"-graph\").removeClass(\"hidden-graph\")\n        //             // addData(chart[1], xlabels_reversed, ylabels_reversed)\n        //         } else if (chart[0] == sensor && !isNaN(ylabels_reversed[ylabels_reversed.length - 1])) {\n        //             //     // plotData(String(sensorIdToLookFor), ylabels_reversed, xlabels_reversed, label)\n        //             //     // addData(chart[1], xlabels_reversed, ylabels_reversed)\n        //             //     // reloadThePage++; //page is reloaded \n        //         } \n        //     } else if (chart[0] == sensor) {\n        //         console.log(\"no data for this chart:\", chart)\n        //     }\n        // })\n        // return data[0]\n\n    }).catch(function (err) {\n        console.log(err);\n        err = 'this is an error';\n        console.log(err);\n    })\n\n}\n\n\nlet reloadDataCustomCalendar = async (start, end, countyName, sensorId, chartList) => {\n\n    // console.log(typeof chartList, '\\r\\n')\n    if (typeof chartList != 'object')\n        getSensorDataCustomInterval(countyName, sensorId, start, end, chartList)\n\n}\n\n// no longer used - instead I use getSensorData()\nlet getSensorType = async (sensorId) => {\n\n    let response = await fetch(\"https://anysensor.dasstec.ro/api/get-data/type/\" + sensorId)\n    return response.json()\n}\n\n// console.log(\"async\",new Date()-time)\n\nvar gaugeList = []\nvar chartList = []\nvar sensorList = []\n\n// This is the main loader that loads all the data on the dashboard\n// It is called by itself\n// ======================================================\n// ======================================================\nlet mainLoader = (async () => {\n    json = await getData();\n})().then(() => {\n    // If error was returned, put 0 value for reading\n    if (json[0].error) {\n\n        // // $(\".card-container .card-body\").html(json[0].message)\n\n        // // County name append\n        // // addSmallBox('county',api_data[0].county,fontAwesome='fas fa-map-marker-alt')\n\n        // let ylabels = []\n        // let xlabels = []\n        // var xValue\n\n        // var cur_date = new Date()\n\n        // // console.log(cur_date.getHours())\n\n        // // Sensors data append 0\n        // for (var i = 1; i <= cur_date.getHours(); i++) {\n\n        //     xlabels.push(0)\n        //     ylabels.push(i)\n\n        // }\n\n        // // const xlabels_reversed = xlabels.reverse()\n        // // const ylabels_reversed = ylabels.reverse()\n\n        // plotData('temperature_2', ylabels, xlabels, \"Temperature\")\n\n\n    } else {\n\n        const api_data = json[0]\n        const sensorCounter = api_data.sensorIdListLength\n        sensorList = api_data.sensorIdList\n\n        for (var i = 0; i < sensorCounter; i++) {\n\n            (async () => {\n\n                var sensorIdToLookFor = api_data.sensorIdList[i]\n                var sensorZone = api_data.sensorZoneList[i]\n                var sensorType = api_data.sensorTypeList[i]\n                let sensorData = await getSensorData(sensorIdToLookFor);\n\n                // get sensor TYPE and ZONE of sensorIdToLookFor if there is no data\n                // console.log(sensorIdToLookFor, sensorData[0].error, sensorZone, sensorType)\n                if (sensorData[0].error) {\n                    sensorData[0].sensorType = sensorType\n                    sensorData[0].sensorZone = sensorZone\n                }\n\n                // Append the default sensor view (current value + graph) for each sensor\n                $(\".card-container\").append(defaultSensorView(sensorData[0].sensorQueried, sensorData[0].sensorType, sensorData[0].sensorZone));\n\n                // Turn On alert sliders\n                // sliderAlerts(\".live-card-\" + sensorData[0].sensorQueried + \" #slider-optim\")\n                // sliderAlerts(\".live-card-\" + sensorData[0].sensorQueried + \" #slider-mid\")\n                // sliderAlerts(\".live-card-\" + sensorData[0].sensorQueried + \" #slider-warning\")\n\n                // Turn on toggle menu from current value for each sensor\n                sensorSettingsToggle(sensorData[0].sensorQueried)\n\n                // Append alerts\n                // timeout(500, appendAlertsToHTML(sensorData[0].sensorQueried))\n\n                // Add Icons based on sensor type\n                $(\".live-card-\" + sensorData[0].sensorQueried + \" .update-icon\").addClass(fontAwesomeClassGenerator(sensorData[0].sensorType))\n                $(\".graph-\" + sensorData[0].sensorQueried + \" .update-icon\").addClass(fontAwesomeClassGenerator(sensorData[0].sensorType))\n\n                // check readings of each sensor and plot\n                // let sensorIdToLookFor = await api_data.sensorIdList[i]\n                // let sensorData = await getSensorData(sensorIdToLookFor);\n\n                // console.log(sensorIdToLookFor, api_data.sensorIdList, sensorData[0])\n\n                var ylabels = []\n                var xlabels = []\n                var label = sensorData[0].sensorType\n\n                // Parse all readings of queried sensor\n                // console.log(\"readings\",sensorData[0].sensorReadings)\n                for (var index = 0; index < sensorData[0].sensorReadings; index++) {\n\n                    // Values preprocessed\n                    ylabels.push(parseFloat(sensorData[0].sensorAverage[index].sensorValue).toFixed(1))\n\n                    // Timestamp preprocessed\n                    var influxTime = sensorData[0].sensorAverage[index].sensorTime\n                    // console.log(influxTime)\n                    // var influxTimeDate = new Date(influxTime)\n                    // influxTimeDate = influxTimeDate.toLocaleString('ro-RO', {\n                    //     timeZone: 'Europe/Bucharest',\n                    //     timeStyle: \"medium\",\n                    //     dateStyle: \"short\"\n                    // })\n                    // console.log(influxTimeDate)\n                    // var influxH = influxTime.split(\"T\")[1].split(\":\")[0]\n\n                    // // influx time is 1 hour behind of romanian time\n                    // // increment influx with 2 because:\n                    // // if time of influx is 8:20, it means that romanian hour is 9:20\n\n                    // var hour = parseInt(influxH) + 1\n                    // xlabels.push(hour < 10 ? \"0\" + String(hour) : (hour == 24 ? \"00\" : String(hour)))\n                    // // xlabels.push(parseInt(influxH)+1)\n                    // console.log(influxTime)\n                    var newDate = new Date(influxTime)\n                    // console.log(influxTime)\n                    var adjustedDate = newDate.setHours(newDate.getHours() - 2)\n                    // console.log(adjustedDate)\n                    xlabels.push(adjustedDate)\n                }\n\n                // xlabels.push(hour+1 < 10 ? \"0\" + String(hour+1) : String(hour+1))\n\n                const xlabels_reversed = xlabels.reverse()\n                const ylabels_reversed = ylabels.reverse()\n\n                // addDataAttributeToGraph(sensorData[0].sensorQueried, xlabels_reversed, ylabels_reversed)\n\n                // addExpandButton(null, sensorData[0].sensorQueried, ylabels_reversed, xlabels_reversed)\n\n                // var liveData = parseFloat(sensorData[0].sensorLive).toFixed(2)\n\n                // if (sensorIdToLookFor.split('-')[1] == 'c') {\n                //     // if sensor is a counter\n                //     let lastValue = await getLatestValueRecorded(sensorIdToLookFor).then((resLast) => {\n                //         gaugeList.push([sensorIdToLookFor, currentValueSvgGauge(sensorIdToLookFor, resLast[0].lastValue.value, resLast[0].lastValue.time)])\n                //     })\n                // } else {\n\n                let promise = new Promise(function (resolve, reject) {\n                    // executor (the producing code, \"singer\")\n                });\n\n                let lastValue = await getLatestValueRecorded(sensorIdToLookFor).then((resLast) => {\n                    // console.log(sensorIdToLookFor, resLast[0].lastValue.value, resLast[0].lastValue.time)\n\n                    // appendAlertsToHTML(sensorData[0].sensorQueried)\n\n                    appendAlertsToHTMLAsync(sensorData[0].sensorQueried).then(res => {\n                        gaugeList.push([sensorIdToLookFor, currentValueSvgGauge(sensorIdToLookFor, resLast[0].lastValue.value, resLast[0].lastValue.time, min = res[0], max = res[1])])\n                    })\n\n                    // gaugeList.push([sensorIdToLookFor, currentValueSvgGauge(sensorIdToLookFor, resLast[0].lastValue.value, resLast[0].lastValue.time, min = 0, max = 30)])\n                })\n\n                // plot data and add current value for each sensor\n                chartList.push([sensorIdToLookFor, plotData(String(sensorIdToLookFor), ylabels_reversed, xlabels_reversed, label)])\n\n                timeIntervalChanger(sensorIdToLookFor, chartList);\n\n                // Download CSV\n                // var startDateCSV = chart.data.labels[0]\n                // startDateCSV = new Date(startDateCSV)\n                // var startDateCSV_day = startDateCSV.getDate()\n                // var startDateCSV_month = month[startDateCSV.getMonth()]\n                // var startDateCSV_h = startDateCSV.getHours()\n                // var startDateCSV_m = startDateCSV.getMinutes()\n                // startDateCSV = startDateCSV_day + \"_\" + startDateCSV_month + \"_h:\" + startDateCSV_h + \"_m:\" + startDateCSV_m\n\n                // var endDateCSV = chart.data.labels[chart.data.labels.length - 1]\n                // endDateCSV = new Date(endDateCSV)\n                // var endDateCSV_day = endDateCSV.getDate()\n                // var endDateCSV_month = month[endDateCSV.getMonth()]\n                // var endDateCSV_h = endDateCSV.getHours()\n                // var endDateCSV_m = endDateCSV.getMinutes()\n                // endDateCSV = endDateCSV_day + \"_\" + endDateCSV_month + \"_h:\" + endDateCSV_h + \"_m:\" + endDateCSV_m\n\n                // var filename = \"Report_from_\" + startDateCSV + '_to_' + endDateCSV + '.csv'\n\n                var filename = \"Report.csv\"\n\n                $(\"article.graph-\" + sensorData[0].sensorQueried + \" #report\").click(function (e) {\n\n                    var parent = $(this).parent().parent().parent().parent().parent()\n                    // console.log(, )\n\n                    downloadCSV({\n                        filename,\n                        xlabels: parent.attr(\"xlabels\"),\n                        ylabels: parent.attr(\"ylabels\")\n                    })\n\n                })\n\n            })()\n\n        }\n\n        // Small box append\n        addSmallBox('Sensors', api_data.sensorIdListLength, fontAwesome = 'fa fa-check')\n\n\n    }\n\n    addCssForSmallBox()\n\n    return chartList\n\n})\n// ======================================================\n// ======================================================\n// End of main loader\n\nfunction downloadCSV(args) {\n    var data, filename, link;\n    var csv = \"\";\n\n    var ylabels = args.ylabels.split(\",\")\n    var xlabels = args.xlabels.split(\",\")\n\n    for (var i = 0; i < ylabels.length; i++) {\n        var label = new Date(parseInt(xlabels[i]))\n        label = label.toLocaleString('en-US', {\n            timeZone: 'Europe/Bucharest',\n            timeStyle: \"medium\",\n            dateStyle: \"long\"\n        }).split(\" \").join(\"_\").split(\",\").join(\"\")\n        console.log(label)\n        csv += label + \",\" + ylabels[i].toString() + \"\\n\"\n    }\n    if (csv == null) return;\n\n    filename = args.filename || 'chart-data.csv';\n\n    if (!csv.match(/^data:text\\/csv/i)) {\n        csv = 'data:text/csv;charset=utf-8,' + csv;\n    }\n\n    data = encodeURI(csv);\n    link = document.createElement('a');\n    link.setAttribute('href', data);\n    link.setAttribute('download', filename);\n    document.body.appendChild(link); // Required for FF\n    link.click();\n    document.body.removeChild(link);\n}\n\nfunction arraysEqual(a1, a2) {\n    /* WARNING: arrays must not contain {objects} or behavior may be undefined */\n    return JSON.stringify(a1) == JSON.stringify(a2);\n}\n\nfunction addData(chart, label, data) {\n    // console.log(chart)\n    // console.log(\"oldLabel:\",chart.data.labels)\n    // console.log(\"newLabel:\",label)\n\n    var oldDataset = chart.data.datasets[0].data.slice(0, chart.data.datasets[0].data.length)\n    // var oldLabel = chart.data.datasets[0].data.slice(0, chart.data.datasets[0].data.length)\n\n    if (oldDataset.length > 0 && data.length > 0) {\n        // console.log(\"new dataset:\",data)\n        // console.log(\"old dataset:\",oldDataset)\n        // console.log(arraysEqual(data,oldDataset))\n        if (arraysEqual(data, oldDataset) == false) {\n            // if new and old datasets are not equal, chart should be updated\n            chart.data.datasets[0].data = data;\n            chart.data.labels = label;\n            chart.update();\n            // console.log(chart)\n            // console.log(\"chart updated with:\", oldDataset)\n            // console.log(\"chart label update:\", chart.data.labels)\n        }\n    } else if (oldDataset.length == 0) {\n        if (arraysEqual(data, oldDataset) == false) {\n            // if new and old datasets are not equal, chart should be updated\n            chart.data.datasets[0].data = data;\n            chart.data.labels = label;\n            chart.update();\n            // console.log(chart)\n            // console.log(\"chart updated with:\", oldDataset)\n            // console.log(\"chart label update:\", chart.data.labels)\n        }\n    }\n\n}\n\nfunction updateData(chartList) {\n\n    (async () => {\n\n        // console.log(await chartList)\n\n        let json = await getData();\n\n        if (json[0].error) {\n            // if error happens at update\n        } else {\n            const api_data = json[0]\n            // console.log(api_data)\n            const sensorCounter = api_data.sensorIdListLength\n            for (var index = 0; index < sensorCounter; index++) {\n                (async () => {\n                    var sensorIdToLookFor = api_data.sensorIdList[index]\n\n                    let sensorData = await getSensorData(sensorIdToLookFor);\n\n                    var ylabels = []\n                    var xlabels = []\n                    // var label = sensorData[0].sensorType\n\n                    // console.log(sensorIdToLookFor, sensorData)\n\n                    for (var i = 0; i < sensorData[0].sensorReadings; i++) {\n\n                        ylabels.push(parseFloat(sensorData[0].sensorAverage[i].sensorValue).toFixed(2))\n\n                        var influxTime = sensorData[0].sensorAverage[i].sensorTime\n\n                        var newDate = new Date(influxTime)\n                        // console.log(influxTime)\n                        var adjustedDate = newDate.setHours(newDate.getHours() - 2)\n\n\n                        // var influxH = influxTime.split(\"T\")[1].split(\":\")[0]\n\n                        // influx time is 1 hour ahead of romanian time\n                        // increment influx with 2 because:\n                        // if time of influx is 8:20, it means that romanian hour is 9:20\n                        // and all the values between 9 to 10 (ro timezone) and (8 to 9 - influx timezone) is displayed as mean at 10h (ro rimezone)\n                        // that's why is incremented with 2\n\n                        // var hour = parseInt(influxH) + 1\n                        // xlabels.push(hour < 10 ? \"0\" + String(hour) : (hour == 24 ? \"00\" : String(hour)))\n\n                        xlabels.push(adjustedDate)\n                    }\n\n                    const xlabels_reversed = xlabels.reverse()\n                    const ylabels_reversed = ylabels.reverse()\n\n                    // console.log(\"chartList:\",chartList)\n                    // console.log(\"sent data:\",sensorIdToLookFor, ylabels_reversed)\n\n                    // var liveData = parseFloat(sensorData[0].sensorLive).toFixed(2)\n                    // var nanFlag = 0\n                    // if(isNaN(liveData)) {\n                    // let lastValue = await getLatestValueRecorded(sensorIdToLookFor).then((resLast) => {\n                    //     liveData = resLast[0].lastValue.value\n                    //     liveDataTime = resLast[0].lastValue.time\n                    //     nanFlag = 1\n                    // })\n                    // }\n\n                    // currentValueAdd(sensorIdToLookFor, liveData)\n\n                    // Loop through gauge list and when a gauge id match the sensorIdToLookFor\n                    // Do the update\n                    // gaugeList.forEach((element) => {\n                    //     if (sensorIdToLookFor == element[0]) {\n                    //         // console.log(\"Update\", element[0], \"with\", liveData, \"at\", liveDataTime)\n                    //         updateValueSvgGauge(element[0], element[1], liveData, liveDataTime)\n                    //     }\n                    // })\n\n\n                    // currentValueSvgGauge(sensorIdToLookFor + '-gauge', liveData)\n\n                    // let chartIndex = 0\n                    let reloadThePage = 0\n                    chartList.forEach((chart) => {\n                        if (chart != undefined) {\n\n                            var canvasId = chart.canvas.id.split(\"-graph\")[0]\n\n                            if ($(\"#\" + canvasId + \"-graph\").parent().parent().attr(\"calendar\") == \"on\") {\n                                // Do not make update\n                                \n                            } else {\n                                // chart[0] == sensorIdToLookFor ? console.log(chart[0],chart[1],ylabels_reversed) : 0\n                                if (canvasId == sensorIdToLookFor) {\n                                    // console.log(\"chart:\",chart[1])\n                                    // console.log(\"updated:\",xlabels_reversed,ylabels_reversed)\n                                    addData(chart, xlabels_reversed, ylabels_reversed)\n                                } else if (canvasId == sensorIdToLookFor && !isNaN(ylabels_reversed[ylabels_reversed.length - 1])) {\n                                    // plotData(String(sensorIdToLookFor), ylabels_reversed, xlabels_reversed, label)\n                                    // addData(chart[1], xlabels_reversed, ylabels_reversed)\n                                    reloadThePage++; //page is reloaded \n                                }\n                            }\n\n\n                        }\n                        // chartIndex++\n                    })\n                    // console.log(reloadThePage)\n                    if (reloadThePage) {\n                        location.reload();\n                    }\n\n                    // console.log(\"Real time data:\", sensorIdToLookFor, liveData)\n\n                })()\n            }\n            // console.log(\"\")\n\n        }\n\n    })()\n}\n\nfunction monthChanger(number) {\n    var b = ''\n    switch (number) {\n        case 1:\n            b = \"January\";\n            break;\n        case 2:\n            b = \"February\";\n            break;\n        case 3:\n            b = \"March\";\n            break;\n        case 4:\n            b = \"April\";\n            break;\n        case 5:\n            b = \"May\";\n            break;\n        case 6:\n            b = \"June\";\n            break;\n        case 7:\n            b = \"July\";\n            break;\n        case 8:\n            b = \"August\";\n            break;\n        case 9:\n            b = \"September\";\n            break;\n        case 10:\n            b = \"October\";\n            break;\n        case 11:\n            b = \"November\";\n            break;\n        case 12:\n            b = \"December\";\n            break;\n    }\n    return b\n}\n\nasync function delay(ms) {\n    // return await for better async stack trace support in case of errors.\n    return await new Promise(resolve => setTimeout(resolve, ms));\n}\n\nfunction switchSecondGraph(chart, sensorId, y = null, x = null) {\n    var old_x_labels = []\n\n    // var x = $(\".graph-\" + sensorId + \" #predictor-switch\").attr('xlabels')\n    // var y = $(\".graph-\" + sensorId + \" #predictor-switch\").attr('ylabels')\n\n    // console.log(\"x:\",x)\n    // x = x.split(\",\")\n    // x.forEach((value, key) => {\n    //     x[key] = new Date(value)\n    // })\n    // console.log(x)\n\n    $(\"body:not(.calendar-active) .graph-\" + sensorId + \" #predictor-switch\").click(function (e) {\n        e.preventDefault;\n        if ($(\".graph-\" + sensorId + \" #predictor-switch\").attr('clicked') == 'false') {\n            document.querySelector(\".graph-\" + sensorId + \" #predictor-switch\").setAttribute('clicked', 'true')\n            if (x) {\n                old_x_labels = chart.config.data.labels\n                chart.config.data.labels = x\n            }\n            chart.config.data.datasets.push({\n                label: 'Last ' + dayName,\n                data: y,\n                // backgroundColor: 'rgba(225, 193, 7, 0.2)',\n                borderColor: 'rgba(225, 193, 7, 1)',\n                pointBorderColor: '#343a40',\n                pointBackgroundColor: \"rgba(225, 193, 7, 1)\",\n                pointHoverBackgroundColor: \"white\",\n                pointRadius: 0,\n                pointHoverRadius: 0,\n                pointBorderWidth: 0,\n                borderWidth: 1,\n                lineTension: 0.2\n            })\n            chart.update();\n        } else if ($(\".graph-\" + sensorId + \" #predictor-switch\").attr('clicked') == 'true') {\n            document.querySelector(\".graph-\" + sensorId + \" #predictor-switch\").setAttribute('clicked', 'false')\n            chart.config.data.datasets.pop()\n            chart.config.data.labels = old_x_labels\n            chart.update()\n        }\n    })\n}\n\nfunction switchButtonSecondGraph(sensorId, attr) {\n    try {\n        document.querySelector(\".graph-\" + sensorId + \" #predictor-switch\").setAttribute('clicked', attr)\n        if (attr = 'disabled')\n            $(\".graph-\" + sensorId + \" #predictor-switch .tooltiptext\").html(\"There is not enough data to enable this functionality\")\n        else\n            $(\".graph-\" + sensorId + \" #predictor-switch .tooltiptext\").html($(\".graph-\" + sensorId + \" #predictor-switch .tooltiptext\").attr(\"oldhtml\"))\n    } catch {\n        console.error(\"Predictor button failed!\")\n    }\n}\n\nlet run = async () => {\n\n    while (1) {\n        updateData(chartList2);\n        // test\n        // notification()\n        await delay(5 * 1000);\n    }\n}\n\nlet notification = async () => {\n    fetch('/api/notification-test?message=Updating the sensor gauge')\n}\n\nrun();\n\n// Experiment get live sensor value from socket.io-mqqt bridge\n\n// Get list of sensors to watch\n\n//MQTT Broker --mqtt--> NodeJS --socket.io--> Client\nvar socketChannel = 'socketChannel'\nsocket.on(socketChannel, async (data) => {\n\n    var liveDate = new Date()\n\n    gaugeList.forEach(gauge => {\n        if (data.topic.includes(gauge[0])) {\n            // console.log(gauge[0], parseFloat(data.message).toFixed(1))\n            liveDate = liveDate.toLocaleString('en-US', {\n                timeZone: 'Europe/Bucharest',\n                timeStyle: \"medium\",\n                dateStyle: \"long\"\n            })\n\n            // Update Current Value when message is received by the broker\n            updateValueSvgGauge(gauge[0], gauge[1], parseFloat(data.message).toFixed(1), updatedAt = liveDate)\n            var sensorId = gauge[1][0].parentElement.id.split(\"-\")[0]\n            $(\"article[sensorId='\" + sensorId + \"']\").attr(\"topic\", data.topic)\n        }\n    })\n\n})\n\n//# sourceURL=webpack:///./public/js/dashboard.js?");

/***/ }),

/***/ "./public/js/fetch3.1.0.js":
/*!*********************************!*\
  !*** ./public/js/fetch3.1.0.js ***!
  \*********************************/
/*! exports provided: Headers, Request, Response, DOMException, fetch */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Headers\", function() { return Headers; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Request\", function() { return Request; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Response\", function() { return Response; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DOMException\", function() { return DOMException; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"fetch\", function() { return fetch; });\nvar support = {\n    searchParams: 'URLSearchParams' in self,\n    iterable: 'Symbol' in self && 'iterator' in Symbol,\n    blob:\n      'FileReader' in self &&\n      'Blob' in self &&\n      (function() {\n        try {\n          new Blob()\n          return true\n        } catch (e) {\n          return false\n        }\n      })(),\n    formData: 'FormData' in self,\n    arrayBuffer: 'ArrayBuffer' in self\n  }\n  \n  function isDataView(obj) {\n    return obj && DataView.prototype.isPrototypeOf(obj)\n  }\n  \n  if (support.arrayBuffer) {\n    var viewClasses = [\n      '[object Int8Array]',\n      '[object Uint8Array]',\n      '[object Uint8ClampedArray]',\n      '[object Int16Array]',\n      '[object Uint16Array]',\n      '[object Int32Array]',\n      '[object Uint32Array]',\n      '[object Float32Array]',\n      '[object Float64Array]'\n    ]\n  \n    var isArrayBufferView =\n      ArrayBuffer.isView ||\n      function(obj) {\n        return obj && viewClasses.indexOf(Object.prototype.toString.call(obj)) > -1\n      }\n  }\n  \n  function normalizeName(name) {\n    if (typeof name !== 'string') {\n      name = String(name)\n    }\n    if (/[^a-z0-9\\-#$%&'*+.^_`|~!]/i.test(name) || name === '') {\n      throw new TypeError('Invalid character in header field name')\n    }\n    return name.toLowerCase()\n  }\n  \n  function normalizeValue(value) {\n    if (typeof value !== 'string') {\n      value = String(value)\n    }\n    return value\n  }\n  \n  // Build a destructive iterator for the value list\n  function iteratorFor(items) {\n    var iterator = {\n      next: function() {\n        var value = items.shift()\n        return {done: value === undefined, value: value}\n      }\n    }\n  \n    if (support.iterable) {\n      iterator[Symbol.iterator] = function() {\n        return iterator\n      }\n    }\n  \n    return iterator\n  }\n  \n  function Headers(headers) {\n    this.map = {}\n  \n    if (headers instanceof Headers) {\n      headers.forEach(function(value, name) {\n        this.append(name, value)\n      }, this)\n    } else if (Array.isArray(headers)) {\n      headers.forEach(function(header) {\n        this.append(header[0], header[1])\n      }, this)\n    } else if (headers) {\n      Object.getOwnPropertyNames(headers).forEach(function(name) {\n        this.append(name, headers[name])\n      }, this)\n    }\n  }\n  \n  Headers.prototype.append = function(name, value) {\n    name = normalizeName(name)\n    value = normalizeValue(value)\n    var oldValue = this.map[name]\n    this.map[name] = oldValue ? oldValue + ', ' + value : value\n  }\n  \n  Headers.prototype['delete'] = function(name) {\n    delete this.map[normalizeName(name)]\n  }\n  \n  Headers.prototype.get = function(name) {\n    name = normalizeName(name)\n    return this.has(name) ? this.map[name] : null\n  }\n  \n  Headers.prototype.has = function(name) {\n    return this.map.hasOwnProperty(normalizeName(name))\n  }\n  \n  Headers.prototype.set = function(name, value) {\n    this.map[normalizeName(name)] = normalizeValue(value)\n  }\n  \n  Headers.prototype.forEach = function(callback, thisArg) {\n    for (var name in this.map) {\n      if (this.map.hasOwnProperty(name)) {\n        callback.call(thisArg, this.map[name], name, this)\n      }\n    }\n  }\n  \n  Headers.prototype.keys = function() {\n    var items = []\n    this.forEach(function(value, name) {\n      items.push(name)\n    })\n    return iteratorFor(items)\n  }\n  \n  Headers.prototype.values = function() {\n    var items = []\n    this.forEach(function(value) {\n      items.push(value)\n    })\n    return iteratorFor(items)\n  }\n  \n  Headers.prototype.entries = function() {\n    var items = []\n    this.forEach(function(value, name) {\n      items.push([name, value])\n    })\n    return iteratorFor(items)\n  }\n  \n  if (support.iterable) {\n    Headers.prototype[Symbol.iterator] = Headers.prototype.entries\n  }\n  \n  function consumed(body) {\n    if (body.bodyUsed) {\n      return Promise.reject(new TypeError('Already read'))\n    }\n    body.bodyUsed = true\n  }\n  \n  function fileReaderReady(reader) {\n    return new Promise(function(resolve, reject) {\n      reader.onload = function() {\n        resolve(reader.result)\n      }\n      reader.onerror = function() {\n        reject(reader.error)\n      }\n    })\n  }\n  \n  function readBlobAsArrayBuffer(blob) {\n    var reader = new FileReader()\n    var promise = fileReaderReady(reader)\n    reader.readAsArrayBuffer(blob)\n    return promise\n  }\n  \n  function readBlobAsText(blob) {\n    var reader = new FileReader()\n    var promise = fileReaderReady(reader)\n    reader.readAsText(blob)\n    return promise\n  }\n  \n  function readArrayBufferAsText(buf) {\n    var view = new Uint8Array(buf)\n    var chars = new Array(view.length)\n  \n    for (var i = 0; i < view.length; i++) {\n      chars[i] = String.fromCharCode(view[i])\n    }\n    return chars.join('')\n  }\n  \n  function bufferClone(buf) {\n    if (buf.slice) {\n      return buf.slice(0)\n    } else {\n      var view = new Uint8Array(buf.byteLength)\n      view.set(new Uint8Array(buf))\n      return view.buffer\n    }\n  }\n  \n  function Body() {\n    this.bodyUsed = false\n  \n    this._initBody = function(body) {\n      /*\n        fetch-mock wraps the Response object in an ES6 Proxy to\n        provide useful test harness features such as flush. However, on\n        ES5 browsers without fetch or Proxy support pollyfills must be used;\n        the proxy-pollyfill is unable to proxy an attribute unless it exists\n        on the object before the Proxy is created. This change ensures\n        Response.bodyUsed exists on the instance, while maintaining the\n        semantic of setting Request.bodyUsed in the constructor before\n        _initBody is called.\n      */\n      this.bodyUsed = this.bodyUsed\n      this._bodyInit = body\n      if (!body) {\n        this._bodyText = ''\n      } else if (typeof body === 'string') {\n        this._bodyText = body\n      } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n        this._bodyBlob = body\n      } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n        this._bodyFormData = body\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this._bodyText = body.toString()\n      } else if (support.arrayBuffer && support.blob && isDataView(body)) {\n        this._bodyArrayBuffer = bufferClone(body.buffer)\n        // IE 10-11 can't handle a DataView body.\n        this._bodyInit = new Blob([this._bodyArrayBuffer])\n      } else if (support.arrayBuffer && (ArrayBuffer.prototype.isPrototypeOf(body) || isArrayBufferView(body))) {\n        this._bodyArrayBuffer = bufferClone(body)\n      } else {\n        this._bodyText = body = Object.prototype.toString.call(body)\n      }\n  \n      if (!this.headers.get('content-type')) {\n        if (typeof body === 'string') {\n          this.headers.set('content-type', 'text/plain;charset=UTF-8')\n        } else if (this._bodyBlob && this._bodyBlob.type) {\n          this.headers.set('content-type', this._bodyBlob.type)\n        } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n          this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8')\n        }\n      }\n    }\n  \n    if (support.blob) {\n      this.blob = function() {\n        var rejected = consumed(this)\n        if (rejected) {\n          return rejected\n        }\n  \n        if (this._bodyBlob) {\n          return Promise.resolve(this._bodyBlob)\n        } else if (this._bodyArrayBuffer) {\n          return Promise.resolve(new Blob([this._bodyArrayBuffer]))\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as blob')\n        } else {\n          return Promise.resolve(new Blob([this._bodyText]))\n        }\n      }\n  \n      this.arrayBuffer = function() {\n        if (this._bodyArrayBuffer) {\n          return consumed(this) || Promise.resolve(this._bodyArrayBuffer)\n        } else {\n          return this.blob().then(readBlobAsArrayBuffer)\n        }\n      }\n    }\n  \n    this.text = function() {\n      var rejected = consumed(this)\n      if (rejected) {\n        return rejected\n      }\n  \n      if (this._bodyBlob) {\n        return readBlobAsText(this._bodyBlob)\n      } else if (this._bodyArrayBuffer) {\n        return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))\n      } else if (this._bodyFormData) {\n        throw new Error('could not read FormData body as text')\n      } else {\n        return Promise.resolve(this._bodyText)\n      }\n    }\n  \n    if (support.formData) {\n      this.formData = function() {\n        return this.text().then(decode)\n      }\n    }\n  \n    this.json = function() {\n      return this.text().then(JSON.parse)\n    }\n  \n    return this\n  }\n  \n  // HTTP methods whose capitalization should be normalized\n  var methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT']\n  \n  function normalizeMethod(method) {\n    var upcased = method.toUpperCase()\n    return methods.indexOf(upcased) > -1 ? upcased : method\n  }\n  \n  function Request(input, options) {\n    options = options || {}\n    var body = options.body\n  \n    if (input instanceof Request) {\n      if (input.bodyUsed) {\n        throw new TypeError('Already read')\n      }\n      this.url = input.url\n      this.credentials = input.credentials\n      if (!options.headers) {\n        this.headers = new Headers(input.headers)\n      }\n      this.method = input.method\n      this.mode = input.mode\n      this.signal = input.signal\n      if (!body && input._bodyInit != null) {\n        body = input._bodyInit\n        input.bodyUsed = true\n      }\n    } else {\n      this.url = String(input)\n    }\n  \n    this.credentials = options.credentials || this.credentials || 'same-origin'\n    if (options.headers || !this.headers) {\n      this.headers = new Headers(options.headers)\n    }\n    this.method = normalizeMethod(options.method || this.method || 'GET')\n    this.mode = options.mode || this.mode || null\n    this.signal = options.signal || this.signal\n    this.referrer = null\n  \n    if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n      throw new TypeError('Body not allowed for GET or HEAD requests')\n    }\n    this._initBody(body)\n  }\n  \n  Request.prototype.clone = function() {\n    return new Request(this, {body: this._bodyInit})\n  }\n  \n  function decode(body) {\n    var form = new FormData()\n    body\n      .trim()\n      .split('&')\n      .forEach(function(bytes) {\n        if (bytes) {\n          var split = bytes.split('=')\n          var name = split.shift().replace(/\\+/g, ' ')\n          var value = split.join('=').replace(/\\+/g, ' ')\n          form.append(decodeURIComponent(name), decodeURIComponent(value))\n        }\n      })\n    return form\n  }\n  \n  function parseHeaders(rawHeaders) {\n    var headers = new Headers()\n    // Replace instances of \\r\\n and \\n followed by at least one space or horizontal tab with a space\n    // https://tools.ietf.org/html/rfc7230#section-3.2\n    var preProcessedHeaders = rawHeaders.replace(/\\r?\\n[\\t ]+/g, ' ')\n    preProcessedHeaders.split(/\\r?\\n/).forEach(function(line) {\n      var parts = line.split(':')\n      var key = parts.shift().trim()\n      if (key) {\n        var value = parts.join(':').trim()\n        headers.append(key, value)\n      }\n    })\n    return headers\n  }\n  \n  Body.call(Request.prototype)\n  \n  function Response(bodyInit, options) {\n    if (!options) {\n      options = {}\n    }\n  \n    this.type = 'default'\n    this.status = options.status === undefined ? 200 : options.status\n    this.ok = this.status >= 200 && this.status < 300\n    this.statusText = 'statusText' in options ? options.statusText : ''\n    this.headers = new Headers(options.headers)\n    this.url = options.url || ''\n    this._initBody(bodyInit)\n  }\n  \n  Body.call(Response.prototype)\n  \n  Response.prototype.clone = function() {\n    return new Response(this._bodyInit, {\n      status: this.status,\n      statusText: this.statusText,\n      headers: new Headers(this.headers),\n      url: this.url\n    })\n  }\n  \n  Response.error = function() {\n    var response = new Response(null, {status: 0, statusText: ''})\n    response.type = 'error'\n    return response\n  }\n  \n  var redirectStatuses = [301, 302, 303, 307, 308]\n  \n  Response.redirect = function(url, status) {\n    if (redirectStatuses.indexOf(status) === -1) {\n      throw new RangeError('Invalid status code')\n    }\n  \n    return new Response(null, {status: status, headers: {location: url}})\n  }\n  \n  var DOMException = self.DOMException\n  try {\n    new DOMException()\n  } catch (err) {\n    DOMException = function(message, name) {\n      this.message = message\n      this.name = name\n      var error = Error(message)\n      this.stack = error.stack\n    }\n    DOMException.prototype = Object.create(Error.prototype)\n    DOMException.prototype.constructor = DOMException\n  }\n  \n  function fetch(input, init) {\n    return new Promise(function(resolve, reject) {\n      var request = new Request(input, init)\n  \n      if (request.signal && request.signal.aborted) {\n        return reject(new DOMException('Aborted', 'AbortError'))\n      }\n  \n      var xhr = new XMLHttpRequest()\n  \n      function abortXhr() {\n        xhr.abort()\n      }\n  \n      xhr.onload = function() {\n        var options = {\n          status: xhr.status,\n          statusText: xhr.statusText,\n          headers: parseHeaders(xhr.getAllResponseHeaders() || '')\n        }\n        options.url = 'responseURL' in xhr ? xhr.responseURL : options.headers.get('X-Request-URL')\n        var body = 'response' in xhr ? xhr.response : xhr.responseText\n        setTimeout(function() {\n          resolve(new Response(body, options))\n        }, 0)\n      }\n  \n      xhr.onerror = function() {\n        setTimeout(function() {\n          reject(new TypeError('Network request failed'))\n        }, 0)\n      }\n  \n      xhr.ontimeout = function() {\n        setTimeout(function() {\n          reject(new TypeError('Network request failed'))\n        }, 0)\n      }\n  \n      xhr.onabort = function() {\n        setTimeout(function() {\n          reject(new DOMException('Aborted', 'AbortError'))\n        }, 0)\n      }\n  \n      function fixUrl(url) {\n        try {\n          return url === '' && self.location.href ? self.location.href : url\n        } catch (e) {\n          return url\n        }\n      }\n  \n      xhr.open(request.method, fixUrl(request.url), true)\n  \n      if (request.credentials === 'include') {\n        xhr.withCredentials = true\n      } else if (request.credentials === 'omit') {\n        xhr.withCredentials = false\n      }\n  \n      if ('responseType' in xhr) {\n        if (support.blob) {\n          xhr.responseType = 'blob'\n        } else if (\n          support.arrayBuffer &&\n          request.headers.get('Content-Type').indexOf('application/octet-stream') !== -1\n        ) {\n          xhr.responseType = 'arraybuffer'\n        }\n      }\n  \n      request.headers.forEach(function(value, name) {\n        xhr.setRequestHeader(name, value)\n      })\n  \n      if (request.signal) {\n        request.signal.addEventListener('abort', abortXhr)\n  \n        xhr.onreadystatechange = function() {\n          // DONE (success or failure)\n          if (xhr.readyState === 4) {\n            request.signal.removeEventListener('abort', abortXhr)\n          }\n        }\n      }\n  \n      xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit)\n    })\n  }\n  \n  fetch.polyfill = true\n  \n  if (!self.fetch) {\n    self.fetch = fetch\n    self.Headers = Headers\n    self.Request = Request\n    self.Response = Response\n  }\n\n//# sourceURL=webpack:///./public/js/fetch3.1.0.js?");

/***/ }),

/***/ "./public/js/map.js":
/*!**************************!*\
  !*** ./public/js/map.js ***!
  \**************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("// MAP PAGE\n// ========================================\n\n// const { map } = require(\"jscharting\")\n\n// const {\n//   response\n// } = require(\"express\")\n\n// const {\n//   set\n// } = require(\"ol/transform\");\n\n/*var iconFeature = new ol.Feature({\n      geometry: new ol.geom.Point([2898477.708941509, 5530897.323059931]),\n      name: 'Null Island',\n      population: 4000,\n      rainfall: 500\n    });\n\n    var iconStyle = new ol.style.Style({\n      image: new ol.style.Icon({\n        anchor: [0, 0],\n        anchorXUnits: 'fraction',\n        anchorYUnits: 'fraction',\n        src: 'https://openlayers.org/en/v3.20.1/examples/data/icon.png',\n        scale: 20\n      })\n    });\n\n    iconFeature.setStyle(iconStyle);\n\n    var vectorSource = new ol.source.Vector({\n      features: [iconFeature]\n    });\n\n    var vectorLayer = new ol.layer.Vector({\n      source: vectorSource\n    });\n\n    var map = new ol.Map({\n      target: 'map',\n      layers: [\n        new ol.layer.Tile({\n          source: new ol.source.OSM()\n        })\n      ],\n      view: new ol.View({\n        center: ol.proj.fromLonLat([26.08, 44.45]),\n        zoom: 7\n      })\n    });*/\n\n/*var feature = new ol.Feature({\n  // geometry: new ol.geom.Point(ol.proj.fromLonLat([26.08, 44.45]))\n  geometry: new ol.geom.Point([2898477.708941509, 5530897.323059931]),\n})*/\n\n/* const fillStyle = new ol.style.Fill({\n       color: [255, 0, 0, 1]\n     })\n \n     const strokeStyle = new ol.style.Stroke({\n       color: [0, 255, 0, 1],\n       width: 1.2\n     })\n \n     const circleStyle = new ol.style.Circle({\n       fill: new ol.style.Fill({\n         color: [0, 0, 255, 1]\n       }),\n       radius: 7,\n       stroke: strokeStyle\n     })\n \n     var iconStyle = new Style({\n       image: new Icon({\n         anchor: [0.5, 46],\n         anchorXUnits: 'fraction',\n         anchorYUnits: 'pixels',\n         src: 'https://openlayers.org/en/v3.20.1/examples/data/icon.png'\n       })\n     });\n \n     var layer = new ol.layer.Vector({\n       source: new ol.source.Vector({\n         features: [feature]\n       }),\n       style: new ol.style.Style({\n         fill: fillStyle,\n         stroke: strokeStyle,\n         image: circleStyle\n       })\n     });\n \n     map.addLayer(layer);*/\n\n// if (ol.Map.prototype.getLayer === undefined) {\n//   ol.Map.prototype.getLayer = function (id) {\n//     var layer;\n//     this.getLayers().forEach(function (lyr) {\n//       if (id == lyr.get('id')) {\n//         layer = lyr;\n//       }\n//     });\n//     return layer;\n//   }\n// }\n\n// detect map container\n// let getLocation = async (sensorId) => {\n//   let response = await fetch(\"/api/read-location/?sensorId=\" + sensorId)\n//   return response.json()\n// }\n\nfunction showNotification(message, error = 0) {\n\n  if (error == 0)\n    $(\"notification\").append(`<div class=\"messages hideMe\">\n                                  <div class=\"alert alert-info mt-3 mb-0\" role=\"alert\">\n                                  <i class=\"fas fa-barcode\"></i>\n                                      <background></background>\n                                      ` + message + `\n                                  </div>\n                              </div>`).show('slow');\n  else if (error == 1)\n    $(\"notification\").append(`<div class=\"messages hideMe\">\n                                  <div class=\"alert alert-danger mt-3 mb-0\" role=\"alert\">\n                                      <i class=\"fas fa-exclamation-triangle\"></i>\n                                      <background></background>\n                                      ` + message + `\n                                  </div>\n                              </div>`).show('slow');\n\n  else if (error == 2)\n    $(\"notification\").append(`<div class=\"messages hideMe\">\n                                      <div class=\"alert alert-success mt-3 mb-0\" role=\"alert\">\n                                          <i class=\"fas fa-print\"></i>\n                                          <background></background>\n                                          ` + message + `\n                                      </div>\n                              </div>`).show('slow');\n\n  else if (error == 3)\n    $(\"notification\").append(`<div class=\"messages hideMe\">\n                                      <div class=\"alert alert-info mt-3 mb-0\" role=\"alert\">\n                                          <i class=\"fas fa-times-circle\"></i>\n                                          <background></background>\n                                          ` + message + `\n                                      </div>\n                              </div>`).show('slow');\n\n  else if (error == 4)\n    $(\"notification\").append(`<div class=\"messages hideMe\">\n                              <div class=\"alert alert-info mt-3 mb-0\" role=\"alert\">\n                                  <background></background>\n                                  ` + message + `\n                              </div>\n                          </div>`).show('slow');\n\n}\n\n// cluster\n\n// get coordinates\nlet getSensorLocation = async () => {\n  let response = await fetch(\"/api/read-location\")\n  return response.json()\n}\n\nlet lastValueOf = async (sensorId) => {\n  let response = await fetch(\"/api/get-last-value/?sensorIdList=\" + sensorId)\n  return response.json()\n}\n\nvar sensorDictionary\nlet lastValue = []\n// var time = new Date()\n// sensorId = sess.sensors passed from backend\nif (typeof sensorId !== 'undefined') {\n  var sensorsCoord = []\n  let sensorLocation = (async () => {\n      json = await getSensorLocation();\n    })().then(() => {\n      // console.log(\"then1\")\n      // console.log(json)\n      json.result.forEach(sensor => {\n        // console.log(sensorId, sensor)\n        if (sensorId.includes(sensor.sensorId)) {\n          // console.log(sensor.coord.split(','))\n          numbers = sensor.coord.split(',').map(Number);\n          numbers.push(sensor.sensorId)\n          // console.log(numbers)\n          sensorsCoord.push(numbers)\n        }\n      })\n      return sensorsCoord\n    })\n    .then(async response => {\n      var sensorList = ''\n      var sensorCounter = 0\n      // console.log(response)\n      response.forEach(async sensor => {\n        sensorCounter++\n        if (sensorCounter != response.length)\n          sensorList += sensor[2] + ','\n        else\n          sensorList += sensor[2]\n      })\n\n      // console.log(sensorList, sensorList.length)\n      if (sensorList.length) {\n        let sensorLatestValueJson = await lastValueOf(sensorList);\n\n        sensorLatestValueJson.forEach(sensor => {\n          lastValue.push([sensor.sensorQueried, sensor.value])\n        })\n\n        return await [response, lastValue]\n      } else {\n        return await [response, [NaN, NaN]]\n      }\n\n\n\n    })\n    .then(response => {\n\n      // console.log(response[1], response[1].length)\n\n      if (response[0]) {\n        var coordinates = response[0]\n      } else {\n        var coordinates = []\n      }\n\n      // console.log(\"coordinates\", coordinates)\n      // create the map with pins for each sensor location in coordinates variable\n      var map, clusters\n      createMap(coordinates, response[1])\n\n      sensorDictionary = coordinates\n\n      // append html markers for temperatures of each sensor location\n      if ($(\"#map\")) {\n        var sensorPos = {}\n        var sensorCounter = 0\n\n        sensorDictionary.forEach(sensor => {\n          var pos = [sensor[1], sensor[0]]\n          var posG = new ol.geom.Point(ol.proj.fromLonLat(pos))\n          // console.log(pos, posG.flatCoordinates)\n          sensorDictionary[sensorCounter] = [posG.flatCoordinates, sensor[2]]\n          sensorCounter++\n        })\n\n        // console.log(sensorPos)\n      }\n\n\n\n\n    })\n}\n\n\n// function appendCoordToHTML(sensorId, coord) {\n//   var bodyEl = $(\"body\")\n//   bodyEl.attr(sensorId, coord)\n// }\n\n$(\"body\").attr(\"location\", \"\")\nvar attributeLocationBody = {}\n\nfunction appendCoordToHTML(sensorId, coord) {\n  var bodyEl = $(\"body\")\n  // bodyEl.attr(sensorId, coord)\n  attributeLocationBody[sensorId] = coord\n  var value = JSON.stringify(attributeLocationBody)\n  bodyEl.attr(\"location\", value)\n}\n\n// Aux Functions for getZoomOfMap()\nfunction getDistanceFromLatLon(lat1,lon1,lat2,lon2) {\n  var R = 6371; // Radius of the earth in km\n  var dLat = deg2rad(lat2-lat1);  // deg2rad below\n  var dLon = deg2rad(lon2-lon1); \n  var a = \n    Math.sin(dLat/2) * Math.sin(dLat/2) +\n    Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * \n    Math.sin(dLon/2) * Math.sin(dLon/2)\n    ; \n  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); \n  var d = R * c; // Distance in km\n  return d*1000;\n}\n\nfunction deg2rad(deg) {\n  return deg * (Math.PI/180)\n}\n// End Aux Functions for getZoomOfMap()\n\nfunction getZoomOfMap() {\n  var locationObj = getLocationObj()\n  // console.log()\n  var coordToCalc = []\n  for(item in locationObj) {\n    coordToCalc.push(locationObj[item])\n  }\n  \n  if(coordToCalc.length == 2)\n    var dist = getDistanceFromLatLon(coordToCalc[0][1],coordToCalc[0][0],coordToCalc[1][1],coordToCalc[1][0])\n  else if(coordToCalc.length == 1)\n    var dist = 2000\n  else if (coordToCalc.length >= 3) \n    var dist = 2000\n\n  \n  console.log(\"getZoomOfMap:\", coordToCalc.length, dist)\n\n  if(dist < 1500)\n    return 17\n  else \n    return 6\n}\n\nfunction getCenterOfMap() {\n  // var bodyEl = $(\"body\")\n  // var location = []\n  // location.push(bodyEl.attr(\"location\"))\n  var locationObj = getLocationObj()\n\n  var latAvg = 0\n  var longAvg = 0\n  var contor = 0\n\n  for (var loc in locationObj) {\n    latAvg += locationObj[loc][0]\n    longAvg += locationObj[loc][1]\n    contor++\n  }\n\n  latAvg = latAvg / contor\n  longAvg = longAvg / contor\n\n  // getPerfectZoomForMap(longAvg, latAvg)\n  console.log(\"center of map\", longAvg, latAvg)\n  return [longAvg, latAvg]\n}\n\n// function getPerfectZoomForMap(lon, lat) {\n//   // Assume that Earth is a perfect sphere with radius R = 6373 km:\n//   R = 6373\n//   x = R * Math.cos(lat) * Math.cos(lon)\n//   y = R * Math.cos(lat) * Math.sin(lon)\n//   z = R * Math.sin(lat)\n//   dist = Math.sqrt((x1-x2)^2 + (y1-y2)^2 + (z1-z2)^2)\n//   console.log(\"Radius:\",r)\n// }\n\nfunction getLocationObj() {\n  var bodyEl = $(\"body\")\n  var location = []\n  if (bodyEl.attr(\"location\")) {\n    location.push(bodyEl.attr(\"location\"))\n    var locationObj = JSON.parse(location)\n\n    // if($(\"body\").hasClass(\"map-page\")) {\n    //   showNotification(\"You have <b>\"+location.length+\" \"+ (location.length>1 ? `sensors` : `sensor`) +\"</b> on map!\", error = 4)\n    // }\n      \n    return locationObj\n  } else {\n    // return coordinates of bucharest (lon,lat)\n    // showNotification(\"You have no sensor assigned!\", error = 4)\n    return {\n      \"bucharest\": [44.439663, 26.096306]\n    }\n  }\n\n}\n\n// function createDictionary(sensorId = null, pos = null) {\n//   // console.log(\"createDictionary\", sensorId, pos)\n//   var dictionary = {}\n//   dictionary[sensorId] = pos\n//   // dictionary.push([sensorId, pos])\n//   console.log(\"createDictionary\", dictionary)\n//   return dictionary\n// }\n\nfunction createMap(coordinates, sensorValuesJson) {\n\n  // console.log(\"Add coordinates to body attr:\", coordinates)\n\n  // console.log(\"sensorValuesJson:\",sensorValuesJson)\n\n  // sensorValuesJson.forEach(sensor => {\n  //   console.log(sensor)\n  // })\n\n  var features = new Array();\n  for (var i = 0; i < coordinates.length; ++i) {\n    // features.push(new ol.Feature(new ol.geom.Point(coordinates[i])));\n    appendCoordToHTML(coordinates[i][2], [coordinates[i][0], coordinates[i][1]])\n    // console.log(coordinates[i][1], coordinates[i][0])\n    var featureObj = new ol.Feature(new ol.geom.Point(ol.proj.fromLonLat([coordinates[i][1], coordinates[i][0]])))\n    // console.log(\"geom:\",featureObj.getGeometry().flatCoordinates)\n    features.push(featureObj);\n  }\n\n  var source = new ol.source.Vector({\n    features: features,\n    test: \"string\"\n  });\n\n  var clusterSource = new ol.source.Cluster({\n    distance: 75,\n    source: source\n  });\n\n  var styleCache = {};\n\n  // function getLatestValue(pinLocation) {\n\n  //   return new Promise((resolve, reject) => {\n\n  //     sensorDictionary.forEach(async sensor => {\n  //       if (sensor[0].equals(pinLocation) === true) {\n  //         let latest = await lastValueOf(sensor[1])\n  //         // console.log(sensor[1], latest[0].value)\n  //         // val = sensor[1]\n  //         let val = await latest[0].value\n  //         resolve(val)\n  //       }\n  //     })\n\n  //   })\n\n  // }\n\n  function getLatestValue(pinLocation) {\n    var val = undefined\n    // var val = sensorValuesJson\n\n    sensorDictionary.forEach(sensor => {\n      // console.log(sensor[1], sensor[0], pinLocation, sensor[0].equals(pinLocation) === true)\n\n      // this loads too many times - it may be slow when there will be more sensors\n      // console.log(sensor[1], sensorValuesJson)\n\n      if (sensor[0].equals(pinLocation) === true) {\n\n        // console.log(sensor[1], sensor[0].equals(pinLocation) === true, sensorValuesJson)\n\n        sensorValuesJson.forEach(sensorVal => {\n          if (sensor[1] == sensorVal[0]) {\n            if (sensor[1].includes(\"source\")) {\n              val = parseFloat(sensorVal[1]) + \"V\"\n            } else {\n              val = parseFloat(sensorVal[1]) + \"C\"\n            }\n          }\n\n        })\n\n        // val = sensorValuesJson[sensor[1]]\n\n        // val = parseFloat(val)\n        // val = sensor[1]\n        // val = await latest[0].value\n      }\n    })\n\n    if (val == undefined) {\n      return \"undefined\"\n    } else {\n      return val\n    }\n\n  }\n\n  var pinLocation\n  // let latestValue\n\n  clusters = new ol.layer.Vector({\n    source: clusterSource,\n    style: function (feature) {\n\n      var size = feature.get('features').length;\n      // var style = styleCache[size];\n\n      pinLocation = feature.getGeometry().flatCoordinates\n\n      // latestValue = getLatestValue(pinLocation).then(async result => {\n      //   return await result\n      // })\n\n      var style\n      if (!style && size > 1) {\n        // style when cluster\n        style = new ol.style.Style({\n          image: new ol.style.Circle({\n            radius: 20,\n            fill: new ol.style.Fill({\n              color: '#ffc107'\n            })\n          }),\n          text: new ol.style.Text({\n            scale: 2.8,\n            text: size.toString(),\n            fill: new ol.style.Fill({\n              color: 'black'\n            })\n          })\n        });\n        styleCache[size] = style;\n        return style\n      } else if (!style && size <= 1) {\n        // style when single\n        style = new ol.style.Style({\n          image: new ol.style.Icon({\n            anchor: [0.5, 0.5],\n            anchorXUnits: 'fraction',\n            anchorYUnits: 'fraction',\n            src: '/images/ol_logo.png',\n            scale: 0.05,\n            radius: 10,\n          }),\n          text: new ol.style.Text({\n            // text: 'test',\n            padding: [1, 0, 0, 4],\n            text: getLatestValue(pinLocation).toString(),\n            placement: 'point',\n            scale: 2,\n            textAlign: 'center',\n            textBaseline: 'middle',\n            offsetX: 2,\n            offsetY: -40,\n            backgroundFill: new ol.style.Fill({\n              color: 'black'\n            }),\n            fill: new ol.style.Fill({\n              color: 'white'\n            })\n          })\n        });\n        styleCache[size] = style;\n        // console.log(\"wait 3 sec\")\n        // Promise.all([latestValue]).then(result => {\n        // console.log(\"PROMISE done\", result.toString())\n        // console.log(style[0])\n        // style.getText().text_ = \"test2\"\n        // })\n        // setTimeout(function () {\n        //   console.log(\"waited 3 seconds\")\n        //   console.log(style.getText().text_)\n        //   return style\n        // }, 3000)\n        return style\n\n      }\n\n      // console.log(style.getText().text_)\n\n      // return style;\n\n    }\n  });\n\n  var raster = new ol.layer.Tile({\n    source: new ol.source.OSM()\n  });\n\n\n  // timeout(1000, function () {\n  map = new ol.Map({\n    layers: [raster, clusters],\n    target: 'map',\n    view: new ol.View({\n      center: ol.proj.fromLonLat(getCenterOfMap()),\n      zoom: getZoomOfMap()\n    })\n  });\n\n  // Promise.all([latestValue]).then(result => {\n  // console.log(\"PROMISE done\", result.toString())\n  // console.log(style[0])\n  // style.getText().text_ = \"test2\"\n  // console.log(clusters)\n\n  // style.getText().setText(feature.get('name'));\n  // clusters.setStyle(new ol.style.Style({\n  //   text: new ol.style.Text({\n  //     text: result.toString(),\n  //     padding: [1, 0, 0, 4],\n  //     // text: getLatestValue(pinLocation).toString(),\n  //     placement: 'point',\n  //     scale: 2,\n  //     textAlign: 'center',\n  //     textBaseline: 'middle',\n  //     offsetX: 2,\n  //     offsetY: -40,\n  //     backgroundFill: new ol.style.Fill({\n  //       color: 'black'\n  //     }),\n  //     fill: new ol.style.Fill({\n  //       color: 'white'\n  //     })\n  //   })\n  // }))\n  // })\n\n  // distance.addEventListener('input', function () {\n  //   cluster.setDistance(parseInt(distance.value, 10));\n  // });\n\n  // })\n\n  // click\n\n  // map.on('click', function (e) {\n\n  // console.log(e.coordinate, map.getView().getZoom(), features.length)\n\n  //     }\n  // });\n\n  // map.addLayer(vectorLayer)\n  // var layers = map.getLayers().array_\n  // map.removeLayer(layers)\n  // map.addLayer(clusters)\n\n  // clusters.getSource().clear();\n  // clusters.setVisible(true);\n  // clusters.getSource().addFeatures(new ol.Feature(new ol.geom.Point(e.coordinate)));\n\n  // })\n\n  // map.getView().on('change:resolution', function (e) {\n\n  //     var layers = map.getLayers().array_\n  //     console.log(layersList, layers.length, map.getView().getZoom())\n\n  //     if (layers.length > 1) {\n  //         if (map.getView().getZoom() > 8) {\n\n  //             //layers[layers.length - 1].setVisible(true)\n  //         }\n  //         if (map.getView().getZoom() <= 8) {\n\n  //             //layers[layers.length - 1].setVisible(false)\n  //         }\n  //     }\n\n  // });\n\n} //create map function\n\n// function name() {\n// var marker = new ol.Overlay({\n//   position: ol.proj.fromLonLat(pos),\n//   positioning: 'center-center',\n//   element: document.querySelectorAll('.temeprature-marker[sensorid=\"'+sensorId+'\"]'),\n//   stopEvent: false\n// });\n// map.addOverlay(marker);\n\n// var feature = new ol.Feature({\n//   geometry: new ol.geom.Point(ol.proj.fromLonLat([pos[0],pos[1]])),\n// })\n\n// const fillStyle = new ol.style.Fill({\n//   color: [255, 0, 0, 1]\n// })\n\n// const strokeStyle = new ol.style.Stroke({\n//   color: [0, 255, 0, 1],\n//   width: 1.2\n// })\n\n// const circleStyle = new ol.style.Circle({\n//   fill: new ol.style.Fill({\n//     color: [0, 0, 255, 1]\n//   }),\n//   radius: 20,\n//   stroke: strokeStyle\n// })\n\n\n// var layer = new ol.layer.Vector({\n//   source: new ol.source.Vector({\n//     features: [feature]\n//   }),\n//   style: new ol.style.Style({\n//     fill: fillStyle,\n//     stroke: strokeStyle,\n//     image: circleStyle,\n//     text: new ol.style.Text({\n//       text: '25',\n//       placement: 'point',\n//       scale: 2,\n//       textAlign: 'center',\n//       textBaseline: 'middle',\n//       offsetX: 0,\n//       offsetY: 0,\n//       fill: new ol.style.Fill({\n//         color: 'white'\n//       })\n//     })\n//   })\n// });\n\n\n\n// map.addLayer(layer);\n\n// }\n\n\n\n// const getZonesAsync = async () => {\n//     const result = await getZones()\n//     return result\n// }\n\nfunction onlyUnique(value, index, self) {\n  return self.indexOf(value) === index;\n}\n\n// Warn if overriding existing method\nif (Array.prototype.equals)\n  console.warn(\"Overriding existing Array.prototype.equals. Possible causes: New API defines the method, there's a framework conflict or you've got double inclusions in your code.\");\n// attach the .equals method to Array's prototype to call it on any array\nArray.prototype.equals = function (array) {\n  // if the other array is a falsy value, return\n  if (!array)\n    return false;\n\n  // compare lengths - can save a lot of time \n  if (this.length != array.length)\n    return false;\n\n  for (var i = 0, l = this.length; i < l; i++) {\n    // Check if we have nested arrays\n    if (this[i] instanceof Array && array[i] instanceof Array) {\n      // recurse into the nested arrays\n      if (!this[i].equals(array[i]))\n        return false;\n    } else if (this[i] != array[i]) {\n      // Warning - two different object instances will never be equal: {x:20} != {x:20}\n      return false;\n    }\n  }\n  return true;\n}\n// Hide method from for-in loops\nObject.defineProperty(Array.prototype, \"equals\", {\n  enumerable: false\n});\n\n//# sourceURL=webpack:///./public/js/map.js?");

/***/ }),

/***/ "./public/js/scale.js":
/*!****************************!*\
  !*** ./public/js/scale.js ***!
  \****************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _utils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils.js */ \"./public/js/utils.js\");\n// Imports\n\n\n// Fetch\nlet sendScaleRecordings = async (barcode, weight, wms = 0) => {\n  console.log(barcode, weight)\n  let response = await fetch(\"https://anysensor.dasstec.ro/api/send-scale-recordings?barcode='\" + barcode + \"'&weight='\" + weight + \"'&wms='\" + wms + \"'\")\n  return response.json()\n}\n\nlet getScaleRecordings = async () => {\n  let response = await fetch(\"https://anysensor.dasstec.ro/api/get-scale-recordings\")\n  return response.json()\n}\n\n// if ($(\".scale-page\").length) {\n\n// console.log(\"scale.js added\")\n\n// Filter on keyup\n$(\"#scaleInput\").keyup(function () {\n  Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"filterColumn\"])('scaleInput','scaleTable',1)\n});\n\n// The client listens on Socket.IO \nsocket.on('socketChannel', (data) => {\n\n  // Live Weight - client receives scale data from backend\n  if (data.topic.includes(username + \"/scale\")) {\n    Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"liveWeightTable\"])(data.message, 1)\n  }\n\n})\n\n// Main\nlet run = (async () => {\n  return await getScaleRecordings();\n})().then((json) => {\n  if (json.length) {\n    var tbody = $(\".table-wrapper table tbody\")\n    for (var [key, value] of Object.entries(json)) {\n\n      var date = new Date(value.timestamp)\n      date.setHours(date.getHours() - 2); //mysql is 2 hours ahead of romanian timezone\n      value.timestamp = date.toLocaleString('en-US', {\n        timeZone: 'Europe/Bucharest',\n        timeStyle: \"medium\",\n        dateStyle: \"long\"\n      })\n\n      tbody.prepend(`<tr timestamp=\"` + value.timestamp + `\" barcode=\"` + value.barcode + `\">\n                        <th scope=\"row\">` + (parseInt(key) + 1) + `</th>\n                        <td>` + value.wms + `</td>\n                        <td>` + value.barcode + `</td>\n                        <td>` + value.value + `g</td>\n                        <td>` + value.timestamp.split(\", \")[0] + `, ` + value.timestamp.split(\", \")[1] + `</td>\n                    </tr>`)\n    }\n  } else {\n    $(\".table-wrapper\").append(`<p class=\"text-center\">No recordings</p>`)\n  }\n})\n\n\n// }\n\n//# sourceURL=webpack:///./public/js/scale.js?");

/***/ }),

/***/ "./public/js/scanner.js":
/*!******************************!*\
  !*** ./public/js/scanner.js ***!
  \******************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _utils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils.js */ \"./public/js/utils.js\");\n\n\nvar lastKey = 0\n\nvar beep = new Audio('/sound/scanner_sound.mp3')\n\nfunction playAudio() {\n    // Play audio \"beep\" if barcode is scanned correctly\n    // FIREFOX: menu > preferinte > securitate > redare automata > permite\n    // CHROME: menu > setari > securitate > setarile site-ului > setari continut > audio > permite \n    beep.play()\n}\n\n// Send start whenever page is loaded\n// this helps the backend app to search the scanner port\nObject(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"sendMessage\"])(\"socketChannel\", {\n    topic: username + \"/scanner\",\n    message: \"start\"\n})\n\n// The client listens on Socket.IO \nsocket.on('socketChannel', async (data) => {\n\n    // console.log(data)\n    // Live Scanner - client receives scanner data from backend\n    if (data.topic.includes(username + \"/scanner\")) {\n        // sendScannerRecordings(data.message.barcode)\n        if(data.message.barcode)\n            liveTableInsert(data.message.barcode, lastKey)\n\n        // if (data.message != 'start' && data.message != 'print' && data.message != 'push') {\n        var mqttMessage = ''\n        if (['start', 'print', 'push', 'print_error'].indexOf(data.message) == -1) {\n            try {\n                mqttMessage = JSON.parse(data.message)\n            } catch {\n                mqttMessage = {\n                    barcode: \"wrong format\"\n                }\n            }\n            getScannerConfigRequest(mqttMessage.barcode)\n            Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"showNotification\"])(\"Barcode scanned: \" + mqttMessage.barcode)\n        }\n\n        // setTimeout(()=>{\n        //     requestConfig = false\n        // },4000)\n        // Sen acknowledge message to server\n        // sendMessage(\"socketChannel\",{\n        //     topic: 'ack',\n        //     message: \"I am \"+username+\"! I updated live weight!\"\n        // })\n    }\n\n})\n\n// Check if website is accesed on mobile\nvar isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)\n\nasync function getScannerConfigRequest(barcode) {\n    // get post config fmor mysql\n    $.get({\n        url: '/api/request-scanner-config',\n        success: function (result) {\n            console.log(\"SEND:\", result[0])\n            // var alpha = \"https://alpha2.superpantofi.ro/api/wms/prepare?api_token=nvb01520!wxr1kzz\"\n            // result[0].url\n            if (isMobile) {\n                getAWB(result[0].method, result[0].contenttype, result[0].url, result[0].data, barcode)\n            } else {\n                getAWB(result[0].method, result[0].contenttype, result[0].url, result[0].data, barcode)\n            }\n\n            // 4433901393784\n            // https://alpha2.superpantofi.ro/api/wms/print?api_token=nvb01520!wxr1kzz&order_id=487200&order_position_id=711270\n\n            // 2222222\n            // https://alpha2.superpantofi.ro/api/wms/print?api_token=nvb01520!wxr1kzz&order_id=487391\n        },\n    });\n}\n\nasync function getAWB(type, contentType, url, data, value) {\n\n    // var proxyurl = \"http://89.39.209.2:8010/\";\n    // var proxyurl = \"https://cors-anywhere.herokuapp.com/\";\n    // var proxyurl = \"https://api.codetabs.com/v1/proxy?quest=\"\n    var proxyurl = \"https://anysensor.dasstec.ro/proxy?url=\"\n\n    fetch(proxyurl + url, {\n            method: type,\n            body: `{\"` + data + `\": \"` + value + `\"}`,\n            headers: {\n                'Content-Type': contentType\n            },\n        })\n        .then(response => response.text())\n        .then(contents => {\n            console.log(\"Received:\", JSON.parse(contents))\n            // console.log(\"Received:\", contents)\n            var url_awb = JSON.parse(contents).awb\n            var barcode = JSON.parse(contents).barcode\n            var status = JSON.parse(contents).status\n            if (barcode == \"ERROR\") {\n                var status = -1\n            } else {\n                // Play audio \"beep\" if barcode is scanned correctly\n                // FIREFOX: menu > preferinte > securitate > redare automata > permite\n                // CHROME: menu > setari > securitate > setarile site-ului > setari continut > audio > permite \n                playAudio()\n            }\n            if (status == 1) {\n                if (!isMobile) {\n\n                    // Send message to start the conveyor after message is received\n                    Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"sendMessage\"])(\"socketChannel\", {\n                        topic: username + \"/scanner\",\n                        message: \"print\"\n                    })\n\n                    openInNewTab(url_awb, barcode) // uncomment this to open a new tab\n\n                    // Insert into DB to track awb printing\n                    sendScannerRecordings(barcode, status)\n                }\n\n                // Show notification\n                var error\n                Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"showNotification\"])(\"AWB for barcode \" + barcode + \" is printing\", error = 2)\n\n                // Live table update correct packages\n                liveTableInsert(barcode, status)\n\n            } else {\n\n                if (!isMobile) {\n                    // Send message to push the box\n                    Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"sendMessage\"])(\"socketChannel\", {\n                        topic: username + \"/scanner\",\n                        message: \"push\"\n                    })\n\n                    // Record into DB pushed packages\n                    sendScannerRecordings(barcode, status)\n                } else {\n                    // Show notification\n                    var error\n                    Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"showNotification\"])(\"Order pushed: \" + value, error = 1)\n                }\n\n                // Show notification\n                var error\n                Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"showNotification\"])(\"Order pushed: \" + value, error = 1)\n\n                // Live table update wrong packages\n                liveTableInsert(barcode, status)\n            }\n        })\n        .catch(() => {\n            // sendMessage(\"socketChannel\", {\n            //     topic: username + \"/scanner\",\n            //     message: \"print_error\"\n            // })\n            var error\n            Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"showNotification\"])(\"AWB printing error: \" + value, error = 1)\n            console.log(\"Cant access \" + url + \" response. Blocked by browser?\")\n        })\n\n}\n\n// live insert into table\nfunction liveTableInsert(barcode, status) {\n    var tbody = $(\".table-wrapper table tbody\")\n    var date = new Date()\n    var index = $(\".table-wrapper table tbody tr:first-child th\").html()\n    if (index == undefined) {\n        index = 0\n    }\n    index = (parseInt(index) + 1)\n    var value = {\n        barcode,\n        timestamp: date.toLocaleString('en-US', {\n            timeZone: 'Europe/Bucharest',\n            timeStyle: \"medium\",\n            dateStyle: \"long\"\n        })\n    }\n\n    if (status)\n        var elClass = 'last-row-animation-good'\n    else\n        var elClass = 'last-row-animation-bad'\n\n    // console.log(value.timestamp)\n    tbody.prepend(`<tr class=\"` + elClass + `\" timestamp=\"` + value.timestamp + `\" barcode=\"` + value.barcode + `\">\n                            <th scope=\"row\">` + index + `</th>\n                            <td>` + value.barcode + `</td>\n                            <td>` + status + `</td>\n                            <td>` + value.timestamp.split(\", \")[0] + ` at ` + value.timestamp.split(\", \")[1] + `</td>\n                        </tr>`)\n\n    // Total packages update\n    $(\".scanner-info h3\").html(index)\n\n    // Correct packages update\n    if (status == 1) {\n        var currentIndex = $(\".correct-packages h3\").html()\n        $(\".correct-packages h3\").html(parseInt(currentIndex) + 1)\n    }\n\n    // Wrong packages update\n    if (status == 0) {\n        var currentIndex = $(\".wrong-packages h3\").html()\n        $(\".wrong-packages h3\").html(parseInt(currentIndex) + 1)\n    }\n\n    // Eror packages update\n    if (status == -1) {\n        var currentIndex = $(\".error-packages h3\").html()\n        $(\".error-packages h3\").html(parseInt(currentIndex) + 1)\n    }\n\n    // Remove text if exists\n    if ($(\".text-center\").length) {\n        $(\".text-center\").remove()\n    }\n}\n\nfunction openInNewTab(url, barcode) {\n\n    // uncomment this for production\n\n    // check if mobile\n    if (isMobile) {\n        var error\n        Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"showNotification\"])(\"On mobile you can't send print command\", error = 2)\n    } else {\n        // var error\n        // showNotification(\"AWB for barcode \" + barcode + \" is printing\", error = 2)\n        // console.log(\">>>> URL TO PRINT:\",url)\n        // var url = url.split(\"&\")[0] + \"&\" + url.split(\"&\")[1]\n        var win = window.open(url, '_blank');\n        console.log(\"AWB URL:\", url);\n        setTimeout(function () {\n            win.close()\n        }, 300)\n\n    }\n\n}\n\n// function sendMessage(topic, msg) {\n//     // send a status message to get the gate status\n//     socket.emit(topic, msg)\n// }\n\nlet getScannerRecordings = async () => {\n    let response = await fetch(\"https://anysensor.dasstec.ro/api/get-scanner-recordings\")\n    return response.json()\n}\n\nlet sendScannerRecordings = async (barcode, status) => {\n    let response = await fetch(\"https://anysensor.dasstec.ro/api/send-scanner-recordings?barcode='\" + barcode + \"'&status='\" + status + \"'\")\n    return response.json()\n}\n\n// Filter on keyup\n$(\"#scannerInput\").keyup(function () {\n    Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"filterColumn\"])('scannerInput', 'scannerTable', 0)\n});\n\nfunction scannerInput() {\n    // Declare variables\n    var input, filter, table, tr, td, i, txtValue;\n    input = document.getElementById(\"scannerInput\");\n    filter = input.value.toUpperCase();\n    table = document.getElementById(\"scannerTable\");\n    tr = table.getElementsByTagName(\"tr\");\n    // Loop through all table rows, and hide those who don't match the search query\n    for (i = 0; i < tr.length; i++) {\n        td = tr[i].getElementsByTagName(\"td\")[0];\n        //   console.log(i, td)\n        if (td) {\n            txtValue = td.textContent || td.innerText;\n            // console.log(i, td, txtValue)\n            if (txtValue.toUpperCase().indexOf(filter) > -1) {\n                tr[i].style.display = \"\";\n            } else {\n                tr[i].style.display = \"none\";\n            }\n        }\n    }\n}\n\n// function incrementCorrectPackages() {\n//     var value = $(\".correct-packages h3\").html()\n//     $(\".correct-packages h3\").html(parseInt(value) + 1)    \n// }\n\n// function incrementWrongPackages() {\n//     var value = $(\".wrong-packages h3\").html()\n//     $(\".wrong-packages h3\").html(parseInt(value) + 1)\n// }\n\nlet run = (async () => {\n    return await getScannerRecordings();\n})().then((json) => {\n    var tbody = $(\".table-wrapper table tbody\")\n    if (json.length) {\n        for (var [key, value] of Object.entries(json)) {\n\n            var date = new Date(value.timestamp)\n            date.setHours(date.getHours() - 2); //mysql is 2 hours ahead of romanian timezone\n            value.timestamp = date.toLocaleString('en-US', {\n                timeZone: 'Europe/Bucharest',\n                timeStyle: \"medium\",\n                dateStyle: \"long\"\n            })\n\n            // Init correct packages\n            if (value.status == 1) {\n                var currentIndex = $(\".correct-packages h3\").html()\n                $(\".correct-packages h3\").html(parseInt(currentIndex) + 1)\n            }\n\n            // Init wrong packages\n            if (value.status == 0) {\n                var currentIndex = $(\".wrong-packages h3\").html()\n                $(\".wrong-packages h3\").html(parseInt(currentIndex) + 1)\n            }\n\n            // Init rrror packages\n            if (value.status == -1) {\n                var currentIndex = $(\".error-packages h3\").html()\n                $(\".error-packages h3\").html(parseInt(currentIndex) + 1)\n            }\n\n            tbody.prepend(`<tr timestamp=\"` + value.timestamp + `\" barcode=\"` + value.barcode + `\" status=\"` + value.status + `\">\n                            <th scope=\"row\">` + (parseInt(key) + 1) + `</th>\n                            <td>` + value.barcode + `</td>\n                            <td>` + value.status + `</td>\n                            <td>` + value.timestamp.split(\", \")[0] + `, ` + value.timestamp.split(\", \")[1] + `</td>\n                        </tr>`)\n            lastKey = (parseInt(key) + 1)\n        }\n\n        // Init total packages\n        $(\".scanner-info h3\").html(lastKey)\n\n    } else {\n        $(\".table-wrapper\").append(`<p class=\"text-center\">No recordings</p>`)\n    }\n})\n\n//# sourceURL=webpack:///./public/js/scanner.js?");

/***/ }),

/***/ "./public/js/scripts.js":
/*!******************************!*\
  !*** ./public/js/scripts.js ***!
  \******************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("console.log(\"script.js added\")\n\n// var passwordField = document.querySelector('.login-container .charInput:nth-child(4)');\n// var otherPasswordFields = document.querySelectorAll('.login-container .charInput:not(:nth-child(4))');\n// var registerButton = document.querySelector('.login-container input:last-child');\n\n// var passwordRules = document.querySelector('.login-container .passwordRules');\n\n// var passwordUpperCase = document.querySelector('.login-container .passwordRules li:first-child');\n// var passwordLowerCase = document.querySelector('.login-container .passwordRules li:nth-child(2)');\n// var passwordDigit = document.querySelector('.login-container .passwordRules li:nth-child(3)');\n// var password8Char = document.querySelector('.login-container .passwordRules li:nth-child(4)');\n\nvar passwordField = document.querySelector('.login-container .charInput[name=\"password\"]');\nvar otherPasswordFields = document.querySelectorAll('.login-container .charInput[name=\"password\"]');\nvar registerButton = document.querySelector('.login-container input[name=\"register\"]');\nvar passwordRules = document.querySelector('.login-container .passwordRules');\nvar passwordUpperCase = document.querySelector('.login-container .passwordRules li:first-child');\nvar passwordLowerCase = document.querySelector('.login-container .passwordRules li:nth-child(2)');\nvar passwordDigit = document.querySelector('.login-container .passwordRules li:nth-child(3)');\nvar password8Char = document.querySelector('.login-container .passwordRules li:nth-child(4)');\n\n// Time Helper Debug\nfunction timeDebug(str) {\n    let date = new Date()\n    date = date.getMilliseconds()\n    console.log(str, date)\n}\n\n//hide the rules\nif (passwordRules)\n    passwordRules.classList.add('hideRules');\n\n//show the rules when field is clicked\nif (passwordField)\n    passwordField.addEventListener('click', function (e) {\n        e.preventDefault();\n        console.log('password input clicked');\n        console.log(passwordRules.classList)\n        passwordRules.classList.remove('hideRules');\n        console.log(passwordRules.classList)\n    });\n\nif (passwordField)\n    //show the rules when typing and check strongness\n    passwordField.addEventListener('input', function (e) {\n        e.preventDefault();\n        // console.log(\"string:\", this.value)\n        passwordCheck = {\n            lowercase: false,\n            uppercase: false,\n            digit: false,\n            _8char: false\n        }\n\n        //check uppercase lowercase digit\n        function checkPasswordString(str) {\n            if (/[a-z]/.test(str)) passwordCheck.lowercase = true\n            else passwordCheck.lowercase = false\n\n            if (/[A-Z]/.test(str)) passwordCheck.uppercase = true\n            else passwordCheck.uppercase = false\n\n            if (/[0-9]/.test(str)) passwordCheck.digit = true\n            else passwordCheck.digit = false\n\n            if (str.length >= 8) passwordCheck._8char = true\n            else passwordCheck._8char = false\n        }\n        checkPasswordString(this.value)\n\n        //make li's green if condition if met\n        if (passwordCheck.lowercase) passwordLowerCase.style.color = \"green\"\n        else passwordLowerCase.style.color = \"red\"\n\n        if (passwordCheck.uppercase) passwordUpperCase.style.color = \"green\"\n        else passwordUpperCase.style.color = \"red\"\n\n        if (passwordCheck.digit) passwordDigit.style.color = \"green\"\n        else passwordDigit.style.color = \"red\";\n\n        if (passwordCheck._8char) password8Char.style.color = \"green\"\n        else password8Char.style.color = \"red\";\n\n        //enable register button if all li's are green\n        function allTrue(obj) {\n            for (var o in obj)\n                if (!obj[o]) return false;\n            return true;\n        }\n\n        // console.log(allTrue(passwordCheck))\n\n        if (allTrue(passwordCheck)) {\n            registerButton.value = \"Register\"\n            registerButton.disabled = false\n        } else {\n            registerButton.value = \"Try a stronger password\"\n            registerButton.disabled = true\n        }\n        // console.log(\"test\",passwordCheck,allTrue(passwordCheck))\n\n\n        //show the password rules\n        passwordRules.classList.remove('hideRules');\n    });\n\nfor (let i = 0; i < otherPasswordFields.length; i++) {\n    otherPasswordFields[i].addEventListener('click', function (e) {\n        e.preventDefault();\n        // console.log('click in another input');\n        passwordRules.classList.add('hideRules');\n    });\n    otherPasswordFields[i].addEventListener('input', function (e) {\n        e.preventDefault();\n        // console.log('input in another field');\n        passwordRules.classList.add('hideRules');\n    });\n}\n\nvar editButton = document.querySelectorAll('.users-table tbody > tr .edit-btn');\nvar editUserBox = document.querySelector('.edit-user');\n\n// $(\"#role_dropdown\").prop(\"selectedIndex\", 1);\n\nfunction eventPath(evt) {\n    var path = (evt.composedPath && evt.composedPath()) || evt.path,\n        target = evt.target;\n  \n    if (path != null) {\n        // Safari doesn't include Window, but it should.\n        return (path.indexOf(window) < 0) ? path.concat(window) : path;\n    }\n  \n    if (target === window) {\n        return [window];\n    }\n  \n    function getParents(node, memo) {\n        memo = memo || [];\n        var parentNode = node.parentNode;\n  \n        if (!parentNode) {\n            return memo;\n        }\n        else {\n            return getParents(parentNode, memo.concat(parentNode));\n        }\n    }\n  \n    return [target].concat(getParents(target), window);\n  }\n  \n\n$(document).ready(function () {\n    // pop up functionality\n    // Listen for all clicks on the document\n    document.addEventListener('click', function (event) {\n\n        var path = event.path || (event.composedPath && event.composedPath());\n\n        var el\n\n        if (path) {\n            // You got some path information\n\n            //Old Way\n            // var el = event.path[0].parentNode;\n\n            // New Way\n            var el = eventPath(event)[0].parentNode\n        } else {\n            // This browser doesn't supply path information\n        }\n\n        \n\n        if (el.classList.contains(\"popup\")) {\n            $(\".show\").removeClass(\"show\")\n            el.classList.toggle(\"show\")\n        }\n\n        // If the click happened inside the the container, bail\n        if (!event.target.closest(\".popup\")) {\n            // console.log(el)\n            $(\".show\").removeClass(\"show\")\n            // console.log(\"click outside\")\n        } else {\n            // el.addClass(\"show\")\n            // console.log(\"click inside\")\n        }\n\n    }, false);\n\n\n    try {\n        // var childs = $(\".small-box-container\").children().length;\n        // $(\".small-box-container\").addClass(\"children-\" + String(childs))\n    } finally {\n\n    }\n\n});\n\n\ntry {\n\n    var toggleButtons = document.querySelectorAll(\".toggleSidenav\")\n    var openButton = document.querySelector(\".open-button\");\n    var overlay = document.querySelector(\".main-overlay\")\n    var asideLinks = document.querySelectorAll(\".sidenav-wrapper a\")\n\n    var sidenav = document.getElementById(\"mySidenav\")\n    var mainbody = document.getElementById(\"main\")\n\n    var body = document.getElementById('main');\n    var except = document.getElementById('mySidenav');\n\n    var flagOpenMenu = false\n    var flagCloseMenu = false\n\n    var widthOpen = \"250px\"\n    var widthClosed = \"50px\"\n\n    // sidebar navigation\n    function openedFinal() {\n        setTimeout(function () {\n            sidenav.classList.add(\"sidenav-opened-final\");\n            sidenav.classList.remove(\"sidenav-closed-final\");\n        }, 150)\n    }\n\n    function closedFinal() {\n        // setTimeout(function () {\n        sidenav.classList.remove(\"sidenav-opened-final\");\n        sidenav.classList.add(\"sidenav-closed-final\");\n        // }, 200)\n    }\n\n    // Check if mobile to wrap sidenav or not\n\n    // Run at first load\n    $(window).on('load', function () {\n\n        let addBodyClass = function () {\n            // var date = new Date();\n            // var date = date.getTime()\n            // console.log(date,(date-date_1)/1000)\n            $(\"body\").addClass(\"window-loaded\")\n        }\n\n        if (sidenav) {\n            if (window.innerWidth > 991) {\n                if (!sidenav.classList.contains(\"sidenav-opened\")) {\n                    // openButton.click()\n                    // var date_1;\n\n                    let openButtonClick = function (callback) {\n                        // date_1 = new Date();\n                        // date_1 = date_1.getTime()\n                        // console.log(date_1)\n                        openButton.click();\n                        setTimeout(function () {\n                            callback()\n                        }, 150)\n                    }\n                    openButtonClick(addBodyClass)\n                }\n            } else {\n                closedFinal.bind()();\n                addBodyClass()\n            }\n        }\n\n    })\n\n    // Run when resize and onload\n    $(window).resize(function () {\n\n        if (window.innerWidth > 991) {\n            // console.log(\">\",window.innerWidth)\n            // if sidenav is closes\n            if (!sidenav.classList.contains(\"sidenav-opened\")) {\n                openButton.click()\n            }\n        } else {\n            // console.log(\"<\",window.innerWidth)\n            // if sidebar is closed\n            if (!sidenav.classList.contains(\"sidenav-opened\")) {\n\n            }\n            // if sidebar is opened\n            else {\n                overlay.click();\n\n            }\n        }\n    });\n    // End Check if mobile to wrap sidenav or not\n\n    // if (window.innerWidth <= 991) {\n    openButton.addEventListener('click', function () {\n\n        let date = new Date()\n        date = date.getMilliseconds()\n        // console.log(\"opened click:\", date)\n\n        if (!sidenav.classList.contains(\"sidenav-opened\")) {\n            sidenav.classList.add(\"sidenav-opened\");\n            overlay.classList.remove(\"hidden-overlay\")\n            if (mainbody.getBoundingClientRect().width > 500) {\n                mainbody.classList.add(\"pl-250\")\n                mainbody.classList.remove(\"pl-50\")\n            }\n        }\n\n        sidenav.classList.remove(\"sidenav-closed\")\n        overlay.classList.remove(\"hidden-overlay\")\n        // mainbody.classList.remove(\"pl-250\")\n        // mainbody.classList.add(\"pl-50\")\n        sidenav.classList.toggle(\"click-open\")\n\n        // $(\"#main\").css({\"margin-left\": \"50px\"})\n\n        for (var i = 0; i < toggleButtons.length; i++)\n            toggleButtons[i].classList.toggle(\"hidden-button\")\n\n        openedFinal.bind()();\n    })\n\n    if (window.innerWidth <= 991)\n        $(\"#mySidenav\").hover(function () {\n\n            // console.log(\"trying to hover in\")\n            if (!sidenav.classList.contains(\"click-open\")) {\n                // $(\"#main\").css({ \"margin-left\": \"250px\" })\n                sidenav.classList.add(\"sidenav-opened\")\n                if (mainbody.getBoundingClientRect().width > 500) {\n                    mainbody.classList.add(\"pl-250\")\n                    mainbody.classList.remove(\"pl-50\")\n                }\n                overlay.classList.remove(\"hidden-overlay\")\n                sidenav.classList.remove(\"sidenav-closed\")\n                for (var i = 0; i < toggleButtons.length; i++)\n                    toggleButtons[i].classList.toggle(\"hidden-button\")\n            }\n            openedFinal.bind()();\n        }, function () {\n            // console.log(\"trying to hover out\")\n            if (!sidenav.classList.contains(\"click-open\")) {\n                closedFinal();\n                // $(\"#main\").css({ \"margin-left\": \"50px\" })\n                sidenav.classList.remove(\"sidenav-opened\")\n                if (mainbody.getBoundingClientRect().width > 500) {\n                    mainbody.classList.remove(\"pl-250\")\n                    mainbody.classList.add(\"pl-50\")\n                }\n                overlay.classList.add(\"hidden-overlay\")\n                sidenav.classList.add(\"sidenav-closed\")\n                for (var i = 0; i < toggleButtons.length; i++)\n                    toggleButtons[i].classList.toggle(\"hidden-button\")\n            }\n        })\n\n    body.addEventListener(\"click\", function () {\n        if (window.innerWidth <= 991)\n            if (sidenav.classList.contains(\"click-open\")) {\n                closedFinal();\n                sidenav.classList.remove(\"click-open\")\n                sidenav.classList.remove(\"sidenav-opened\")\n                if (mainbody.getBoundingClientRect().width > 500) {\n                    mainbody.classList.remove(\"pl-250\")\n                    mainbody.classList.add(\"pl-50\")\n                }\n                overlay.classList.add(\"hidden-overlay\")\n                sidenav.classList.add(\"sidenav-closed\")\n                for (var i = 0; i < toggleButtons.length; i++)\n                    toggleButtons[i].classList.toggle(\"hidden-button\")\n            }\n    });\n\n    except.addEventListener(\"click\", function (ev) {\n        // console.log(\"click on sidebar\");\n        ev.stopPropagation(); //this is important! If removed, you'll get both alerts\n    }, false);\n\n    document.querySelector(\".open-button\").addEventListener(\"click\", function (ev) {\n        // console.log(\"click on button\");\n        ev.stopPropagation(); //this is important! If removed, you'll get both alerts\n    }, false);\n    // }\n\n} catch (e) {\n    console.warn(\"It looks like there is no sidebar navigation\")\n}\n\n// Chart.JS\n{\n    /* <script> */\n}\n// chartIt('temperature_1')\n\nfunction chartIt(selector) {\n    var ctx = document.getElementById(selector).getContext('2d');\n\n    xLabels = [20, 30, 25, 40]\n    yLabel = [2020, 2019, 2018, 2017]\n\n    var myChart = new Chart(ctx, {\n        type: 'bar',\n        data: {\n            labels: yLabel,\n            datasets: [{\n                label: 'Average Temperature',\n                data: xLabels,\n                backgroundColor: [\n                    'rgba(255, 99, 132, 0.2)',\n                    'rgba(54, 162, 235, 0.2)',\n                    'rgba(255, 206, 86, 0.2)',\n                    'rgba(75, 192, 192, 0.2)',\n                    'rgba(153, 102, 255, 0.2)',\n                    'rgba(255, 159, 64, 0.2)'\n                ],\n                borderColor: [\n                    'rgba(255, 99, 132, 1)',\n                    'rgba(54, 162, 235, 1)',\n                    'rgba(255, 206, 86, 1)',\n                    'rgba(75, 192, 192, 1)',\n                    'rgba(153, 102, 255, 1)',\n                    'rgba(255, 159, 64, 1)'\n                ],\n                borderWidth: 1\n            }]\n        },\n        options: {\n            scales: {\n                yAxes: [{\n                    ticks: {\n                        beginAtZero: true\n                    }\n                }]\n            }\n        }\n    });\n}\n\n// CARD DATA FETCH\n// ========================================\n// $(\"#chart-customizer\").ready(function () {\n//     let loader = `<div class=\"boxLoading\">Loading...</div>`;\n//     document.getElementById('chart-customizer').innerHTML = loader;\n//     fetch('https://jsonplaceholder.typicode.com/todos/1')\n//         .then(response => response.json())\n//         .then(json => {\n//             console.log(json)\n//             const str = JSON.stringify(json, null, 2)\n//             console.log(str)\n//             let result = `<h2> Result: </h2><br>`;\n//             result += `<p>User id:${json.userId} </p><br>`\n//             result += `<p>Title:${json.title} </p>`\n//             $(\".boxLoading\").remove()\n//             $('#chart-customizer').append(result)\n//         }).catch((e)=>{\n//             console.warn(e.message)\n//         })\n// })\n// ========================================\n// End CARD DATA FETCH\n\n// chart_TimeSeries('timeseries_1', generateData())\n\n// not used\nfunction chart_TimeSeries(selector, data) {\n    var ctx = document.getElementById(selector).getContext('2d');\n    var color = Chart.helpers.color;\n    var cfg = {\n        data: {\n            datasets: [{\n                label: 'Timeseries chart',\n                backgroundColor: \"red\",\n                borderColor: \"black\",\n                data: data,\n                type: 'line',\n                pointRadius: 0,\n                fill: false,\n                lineTension: 0,\n                borderWidth: 2\n            }]\n        },\n        options: {\n            animation: {\n                duration: 0\n            },\n            scales: {\n                xAxes: [{\n                    type: 'time',\n                    distribution: 'series',\n                    offset: true,\n                    ticks: {\n                        major: {\n                            enabled: true,\n                            fontStyle: 'bold'\n                        },\n                        source: 'data',\n                        autoSkip: true,\n                        autoSkipPadding: 75,\n                        maxRotation: 0,\n                        sampleSize: 100\n                    },\n                    afterBuildTicks: function (scale, ticks) {\n                        var majorUnit = scale._majorUnit;\n                        var firstTick = ticks[0];\n                        var i, ilen, val, tick, currMajor, lastMajor;\n\n                        val = moment(ticks[0].value);\n                        if ((majorUnit === 'minute' && val.second() === 0) ||\n                            (majorUnit === 'hour' && val.minute() === 0) ||\n                            (majorUnit === 'day' && val.hour() === 9) ||\n                            (majorUnit === 'month' && val.date() <= 3 && val.isoWeekday() === 1) ||\n                            (majorUnit === 'year' && val.month() === 0)) {\n                            firstTick.major = true;\n                        } else {\n                            firstTick.major = false;\n                        }\n                        lastMajor = val.get(majorUnit);\n\n                        for (i = 1, ilen = ticks.length; i < ilen; i++) {\n                            tick = ticks[i];\n                            val = moment(tick.value);\n                            currMajor = val.get(majorUnit);\n                            tick.major = currMajor !== lastMajor;\n                            lastMajor = currMajor;\n                        }\n                        return ticks;\n                    }\n                }],\n                yAxes: [{\n                    gridLines: {\n                        drawBorder: false\n                    },\n                    scaleLabel: {\n                        display: true,\n                        labelString: 'Closing price ($)'\n                    }\n                }]\n            },\n            tooltips: {\n                intersect: false,\n                mode: 'index',\n                callbacks: {\n                    label: function (tooltipItem, myData) {\n                        var label = myData.datasets[tooltipItem.datasetIndex].label || '';\n                        if (label) {\n                            label += ': ';\n                        }\n                        label += parseFloat(tooltipItem.value).toFixed(2);\n                        return label;\n                    }\n                }\n            }\n        }\n    };\n\n    var chart = new Chart(ctx, cfg);\n}\n\nfunction generateData() {\n    // var unit = document.getElementById('unit').value;\n    const unit = 'Day'\n\n    function unitLessThanDay() {\n        return unit === 'second' || unit === 'minute' || unit === 'hour';\n    }\n\n    function beforeNineThirty(date) {\n        return date.hour() < 9 || (date.hour() === 9 && date.minute() < 30);\n    }\n\n    // Returns true if outside 9:30am-4pm on a weekday\n    function outsideMarketHours(date) {\n        if (date.isoWeekday() > 5) {\n            return true;\n        }\n        if (unitLessThanDay() && (beforeNineThirty(date) || date.hour() > 16)) {\n            return true;\n        }\n        return false;\n    }\n\n    function randomNumber(min, max) {\n        return Math.random() * (max - min) + min;\n    }\n\n    function randomBar(date, lastClose) {\n        var open = randomNumber(lastClose * 0.95, lastClose * 1.05).toFixed(2);\n        var close = randomNumber(open * 0.95, open * 1.05).toFixed(2);\n        return {\n            t: date.valueOf(),\n            y: close\n        };\n    }\n\n    var date = moment('Jan 01 1990', 'MMM DD YYYY');\n    var now = moment();\n    var data = [];\n    var lessThanDay = unitLessThanDay();\n    for (; data.length < 600 && date.isBefore(now); date = date.clone().add(1, unit).startOf(unit)) {\n        if (outsideMarketHours(date)) {\n            if (!lessThanDay || !beforeNineThirty(date)) {\n                date = date.clone().add(date.isoWeekday() >= 5 ? 8 - date.isoWeekday() : 1, 'day');\n            }\n            if (lessThanDay) {\n                date = date.hour(9).minute(30).second(0);\n            }\n        }\n        data.push(randomBar(date, data.length > 0 ? data[data.length - 1].y : 30));\n    }\n\n    return data;\n}\n\n// chart_lineboundaries('timeseries_1')\n\nfunction chart_lineboundaries(selector) {\n\n    var presets = window.chartColors;\n    var utils = Samples.utils;\n    var inputs = {\n        min: -100,\n        max: 100,\n        count: 8,\n        decimals: 2,\n        continuity: 1\n    };\n\n    function generateData(config) {\n        return utils.numbers(Chart.helpers.merge(inputs, config || {}));\n    }\n\n    function generateLabels(config) {\n        return utils.months(Chart.helpers.merge({\n            count: inputs.count,\n            section: 3\n        }, config || {}));\n    }\n\n    var options = {\n        maintainAspectRatio: false,\n        spanGaps: false,\n        elements: {\n            line: {\n                tension: 0.000001\n            }\n        },\n        plugins: {\n            filler: {\n                propagate: false\n            }\n        },\n        scales: {\n            xAxes: [{\n                ticks: {\n                    autoSkip: false,\n                    maxRotation: 0\n                }\n            }]\n        }\n    };\n\n    [false, 'origin', 'start', 'end'].forEach(function (boundary, index) {\n\n        // reset the random seed to generate the same data for all charts\n        utils.srand(8);\n\n        new Chart(selector, {\n            type: 'line',\n            data: {\n                labels: generateLabels(),\n                datasets: [{\n                    backgroundColor: utils.transparentize(presets.red),\n                    borderColor: presets.red,\n                    data: generateData(),\n                    label: 'Dataset',\n                    fill: boundary\n                }]\n            },\n            options: Chart.helpers.merge(options, {\n                title: {\n                    text: 'fill: ' + boundary,\n                    display: true\n                }\n            })\n        });\n    });\n\n}\n\n// Comment the following line if you don't want notification to be on all pages\nanimationInNotification()\n\nfunction animationInNotification() {\n    setTimeout(50, $(\".messages\").animate({\n        right: \"0px\",\n        opacity: \"1\",\n        visibility: \"visible\"\n    }))\n}\n\n// navigator.usb.getDevices()\n// .then(device => {\n//   console.log(device.productName);      // \"Arduino Micro\"\n//   console.log(device.manufacturerName); // \"Arduino LLC\"\n// })\n// .catch(error => { console.log(error); });\n\n\n// if (!('usb' in navigator)) throw new Error(\"Browser does not support WebUSB\");\n\n// navigator.usb.getDevices()\n//   .then(devices => {\n//     const report = \"<p>Total devices: \" + devices.length + \"</p><ul>\" + devices.map(d => {\n//       return \"<li>Product name: \" + device.productName + \", serial number \" + device.serialNumber + \"</li>\";\n//     }).join('\\n') + \"</ul>\";\n//     console.log(\"report\",report)\n//     DemoUtils.reportDemoResult(true);\n//   })\n//   .catch(e => DemoUtils.reportDemoResult(false, {resultDetail: e.toString()}));\n\n// customTimelineCalendar()\n\n// function customTimelineCalendar() {\n//     $(\"#graph-calendar button\").click(function(){\n//         console.log(\"test\")\n//     })\n// }\n\n// Async timeout\n// let timeout = (ms,f) => {\n//     let sleep =  new Promise(resolve => setTimeout(function(){\n//         f()\n//         // return resolve\n//     }, ms))\n// }\n\nfunction timeout(ms, f) {\n    let sleep = new Promise(resolve => setTimeout(function () {\n        f()\n        // return resolve\n    }, ms))\n}\n\n// Test async timeout\ntimeout(3000, function () {\n    console.log(\"3 seconds async timeout\")\n})\n\n// Set the minimum height of the sidebar\nvar infos = () => {\n    var brandH = $(\"#mySidenav .brand\").height();\n    var basicItemsCounter = $(\"#mySidenav .basicItems\").length;\n    var basicItemsH = $(\"#mySidenav .basicItems\").height();\n    var zoneLisH = $(\"#mySidenav .zone-list\").height();\n    var settingItemsH = $(\"#mySidenav .settings-items\").height();\n    console.log(brandH, basicItemsCounter, basicItemsH, zoneLisH, settingItemsH)\n}\n\n//# sourceURL=webpack:///./public/js/scripts.js?");

/***/ }),

/***/ "./public/js/svgGauge/gauge.min.js":
/*!*****************************************!*\
  !*** ./public/js/svgGauge/gauge.min.js ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_RESULT__;!function(e){var t,o,F,S,n=(o=(t=e).document,F=Array.prototype.slice,S=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame||function(e){return setTimeout(e,1e3/60)},function(){var r=\"http://www.w3.org/2000/svg\",M={centerX:50,centerY:50},k={dialRadius:40,dialStartAngle:135,dialEndAngle:45,value:0,max:100,min:0,valueDialClass:\"value\",valueClass:\"value-text\",dialClass:\"dial\",gaugeClass:\"gauge\",showValue:!0,gaugeColor:null,label:function(e){return Math.round(e)}};function V(e,t,n){var a=o.createElementNS(r,e);for(var i in t)a.setAttribute(i,t[i]);return n&&n.forEach(function(e){a.appendChild(e)}),a}function R(e,t){return e*t/100}function E(e,t,n){var a=Number(e);return n<a?n:a<t?t:a}function q(e,t,n,a){var i=a*Math.PI/180;return{x:Math.round(1e3*(e+n*Math.cos(i)))/1e3,y:Math.round(1e3*(t+n*Math.sin(i)))/1e3}}return function(e,r){r=function(){var n=arguments[0];return F.call(arguments,1).forEach(function(e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])}),n}({},k,r);var o,l,t,n=e,s=r.max,u=r.min,a=E(r.value,u,s),c=r.dialRadius,d=r.showValue,f=r.dialStartAngle,v=r.dialEndAngle,i=r.valueDialClass,m=r.valueClass,g=(r.valueLabelClass,r.dialClass),h=r.gaugeClass,p=r.color,w=r.label,x=r.viewBox;if(f<v){console.log(\"WARN! startAngle < endAngle, Swapping\");var A=f;f=v,v=A}function y(e,t,n,a){var i=function(e,t,n){var a=M.centerX,i=M.centerY;return{end:q(a,i,e,n),start:q(a,i,e,t)}}(e,t,n),r=i.start,o=i.end,l=void 0===a?1:a;return[\"M\",r.x,r.y,\"A\",e,e,0,l,1,o.x,o.y].join(\" \")}function b(e,t){var n=function(e,t,n){return 100*(e-t)/(n-t)}(e,u,s),a=R(n,360-Math.abs(f-v)),i=a<=180?0:1;d&&(o.textContent=w.call(r,e)),l.setAttribute(\"d\",y(c,f,a+f,i))}function C(e,t){var n=p.call(r,e),a=1e3*t,i=\"stroke \"+a+\"ms ease\";l.style.stroke=n,l.style[\"-webkit-transition\"]=i,l.style[\"-moz-transition\"]=i,l.style.transition=i}return t={setMaxValue:function(e){s=e},setValue:function(e){a=E(e,u,s),p&&C(a,0),b(a)},setValueAnimated:function(e,t){var n=a;a=E(e,u,s),n!==a&&(p&&C(a,t),function(e){var t=e.duration,a=1,i=60*t,r=e.start||0,o=e.end-r,l=e.step,s=e.easing||function(e){return(e/=.5)<1?.5*Math.pow(e,3):.5*(Math.pow(e-2,3)+2)};S(function e(){var t=a/i,n=o*s(t)+r;l(n,a),a+=1,t<1&&S(e)})}({start:n||0,end:a,duration:t||1,step:function(e,t){b(e,t)}}))},getValue:function(){return a}},function(e){o=V(\"text\",{x:50,y:50,fill:\"#999\",class:m,\"font-size\":\"100%\",\"font-family\":\"sans-serif\",\"font-weight\":\"normal\",\"text-anchor\":\"middle\",\"alignment-baseline\":\"middle\",\"dominant-baseline\":\"central\"}),l=V(\"path\",{class:i,fill:\"none\",stroke:\"#666\",\"stroke-width\":2.5,d:y(c,f,f)});var t=R(100,360-Math.abs(f-v)),n=V(\"svg\",{viewBox:x||\"0 0 100 100\",class:h},[V(\"path\",{class:g,fill:\"none\",stroke:\"#eee\",\"stroke-width\":2,d:y(c,f,v,t<=180?0:1)}),V(\"g\",{class:\"text-container\"},[o]),l]);e.appendChild(n)}(n),t.setValue(a),t}}()); true?!(__WEBPACK_AMD_DEFINE_RESULT__ = (function(){return n}).call(exports, __webpack_require__, exports, module),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)):undefined}(\"undefined\"==typeof window?this:window);\n\n//# sourceURL=webpack:///./public/js/svgGauge/gauge.min.js?");

/***/ }),

/***/ "./public/js/team.js":
/*!***************************!*\
  !*** ./public/js/team.js ***!
  \***************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _utils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils.js */ \"./public/js/utils.js\");\n// Imports\n\n\n// get users from mysql\nlet getUsers = async () => {\n    let response = await fetch(\"https://anysensor.dasstec.ro/api/get-users\")\n    console.log(response)\n    return response.json()\n}\n\n// get zones assigned to each user\nlet getZones = async (username) => {\n    let response = await fetch(\"https://anysensor.dasstec.ro/api/v2/sensors-access?username=\" + username)\n    return response.json()\n}\n\nlet main = (async () => {\n    return await getUsers()\n    // console.log(usersTable)\n})().then(async (usersJson) => {\n\n    console.log(usersJson)\n    const rows = usersJson[0].length\n    var modalBtnFlag = 0\n    var currentCompany = ''\n\n    // console.log(usersJson[0])\n\n    usersJson[0].forEach(row => {\n        if (row.Username == loggedInUser) {\n            currentCompany = row.company\n            $(\".small-box-container .company\").html(currentCompany)\n        }\n    })\n\n    for (var i = 0; i < rows; i++) {\n        // && loggedInUser != usersJson[0][i].Username\n        if (currentCompany == usersJson[0][i].company && usersJson[0][i].User_role != 'superadmin') {\n            (async () => {\n\n                $(\"body\").append(`\n                <div class=\"modal modal-` + usersJson[0][i].Username + `\" id=\"edit-user-` + usersJson[0][i].Username + `\" aria-labelledby=\"edit-user-label-` + usersJson[0][i].Username + `\" aria-hidden=\"true\" tabindex=\"-1\" role=\"dialog\">\n                    <div class=\"modal-dialog fadeInModal modal-dialog-centered\" role=\"document\">\n                        <div class=\"modal-content\">\n    \n                            <div class=\"modal-header\">\n                                <h5 class=\"modal-title\" id='edit-user-label-` + usersJson[0][i].Username + `'>Edit user: ` + usersJson[0][i].Username + `</h5>\n                                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                                <span aria-hidden=\"true\">&times;</span>\n                                </button>\n                            </div>\n    \n                            <div class=\"modal-body\">\n                                <form action='/api/edit-user' method='GET' id=\"form-edit-user-` + usersJson[0][i].Username + `\">\n\n                                    <div class=\"form-group hidden\">\n                                        <input type=\"text\" class=\"form-control\" name=\"id\" value=\"` + usersJson[0][i].Id + `\">\n                                    </div>\n    \n                                    <div class=\"form-group\">\n                                        <input type=\"text\" class=\"form-control\" id=\"name\" name=\"name\" value=\"` + usersJson[0][i].Name + `\">\n                                    </div>\n    \n                                    <div class=\"form-group\">\n                                        <input type=\"text\" class=\"form-control\" id=\"username\" name=\"username\" value=\"` + usersJson[0][i].Username + `\">\n                                    </div>\n    \n                                    <div class=\"form-group\">\n                                        <input type=\"email\" class=\"form-control\" id=\"email\" name=\"email\" value=\"` + usersJson[0][i].Email + `\">\n                                    </div>\n    \n                                    <div class=\"form-group\">\n                                        <input type=\"text\" class=\"form-control\" id=\"password\" name=\"password\" placeholder='Type a new password or leave it as it is'>\n                                    </div>\n    \n                                    <div class=\"form-group\">\n    \n                                        <label>Zones</label>\n                                    \n                                        <div class=\"form-zones-container\">\n                                              \n                                        </div>         \n    \n                                    </div>\n                                </form>\n                            </div>\n    \n                            <div class=\"modal-footer\">\n                                <button type=\"button\" class=\"btn btn-secondary\" data-toggle=\"modal\" data-target=\".modal-` + usersJson[0][i].Username + `\">Close</button>\n                                <button type=\"submit\" value=\"Submit\" form=\"form-edit-user-` + usersJson[0][i].Username + `\" class=\"btn btn-primary\">Save Changes</button>\n                            </div>\n    \n                        </div>\n                    </div>\n                </div>\n                `)\n\n                // set current user first in list\n                if (usersJson[0][i].Username == loggedInUser) {\n                    $(\".team-container tbody\").prepend(`\n                    <tr class='current-user'>\n                        <td class=\"user-col\">` +\n                        usersJson[0][i].Name + `<br>` +\n                        usersJson[0][i].Username + `<br>` +\n                        usersJson[0][i].Email + `<br>` +\n                        `</td>\n                        <td class=\"zones-col zones-` + usersJson[0][i].Username + `\">\n                            <a href=\"#\" class='spinner ` + usersJson[0][i].Username + `-zone-spinner'>\n                                <span>Loading...</span>\n                            </a>\n                        </td>\n                        <td class=\"actions-col\">\n                            <button disabled type=\"button\" class=\"btn btn-outline-primary edit-user-` + usersJson[0][i].Username + `\">\n                                <i class=\"fal fa-edit\"></i>\n                                <span>Edit User</span>\n                            </button>\n                            <button disabled type=\"button\" class=\"btn btn-danger remove-user\">\n                                <i class=\"fal fa-user-minus\"></i>\n                                <span>Remove User</span>\n                            </button>\n                        </td>\n                    </tr>\n                `)\n                } else {\n                    $(\".team-container tbody\").append(`\n                        <tr>\n                            <td class=\"user-col\">` +\n                        usersJson[0][i].Name + `<br>` +\n                        usersJson[0][i].Username + `<br>` +\n                        usersJson[0][i].Email + `<br>` +\n                        `</td>\n                            <td class=\"zones-col zones-` + usersJson[0][i].Username + `\">\n                                <a href=\"#\" class='spinner ` + usersJson[0][i].Username + `-zone-spinner'>\n                                    <span>Loading...</span>\n                                </a>\n                            </td>\n                            <td class=\"actions-col\">\n                                <button type=\"button\" class=\"btn btn-outline-primary edit-user-` + usersJson[0][i].Username + `\">\n                                    <i class=\"fal fa-edit\"></i>\n                                    <span>Edit User</span>\n                                </button>\n                                <button type=\"button\" class=\"btn btn-danger remove-user\">\n                                    <i class=\"fal fa-user-minus\"></i>\n                                    <span>Remove User</span>\n                                </button>\n                            </td>\n                        </tr>\n                    `)\n                }\n\n                return await getZones(usersJson[0][i].Username)\n                // return zonesTable\n\n            })().then(zonesTable => {\n\n                var currentUserZones = []\n\n                zonesTable.data.forEach(element => {\n\n                    // console.log(element)\n                    currentUserZones.push(element.zone)\n\n                    // append zones to modal\n                    if (element.query == loggedInUser && element.zone != undefined) {\n                        $(\".modal form .form-zones-container\").append(`\n                            <div class=\"form-check\">\n                                <input class=\"form-check-input\" type=\"checkbox\" value=\"` + element.zone + `\" id=\"` + element.zone + `\" name=\"zones\">\n                                <label class=\"form-check-label\" for=\"` + element.zone + `\">\n                                    ` + element.zone + `\n                                    <span></span>\n                                </label>\n                            </div>\n                        `)\n                    }\n\n                    turnOnClick(element.query)\n\n                    $(\".team-container .\" + element.query + \"-zone-spinner\").remove()\n\n                    if (element.error)\n                        $(\".team-container .zones-\" + element.query).append(`<span class=\"no-zone\">` + element.error + `</span>`)\n                    else {\n                        $(\".team-container .zones-\" + element.query).append(`<span class=\"zone\" belongsTo=\"` + element.belongsTo + `\">` + element.zone + `</span>`)\n                    }\n\n                    // console.log($(\".modal-\"+element.query+\" .form-zones-container input[id='\"+element.zone+\"']\"))\n                    // $(\"input[id='\"+element.zone+\"']\").addClass(\"test\")\n                    // $(\"input[id='\"+element.zone+\"']\").prop( \"checked\", true );\n\n                })\n\n                // check zones in modal\n                // zonesTable.data.forEach(element => {\n                //     if(currentUserZones.includes(element.zone) && element.zone != undefined) {\n                //         // console.log($(\".modal-\"+element.query+\" .form-zones-container input[id='\"+element.zone+\"']\"), currentUserZones, element.zone)\n                //         console.log($(\".modal-\"+element.query+\" .form-zones-container input[id='\"+element.zone+\"']\"))\n                //         $(\".modal-\"+element.query+\" .form-zones-container input[id='\"+element.zone+\"']\").prop( \"checked\", true );\n                //     }\n                //         // $(\".modal-\"+element.query+\" .form-zones-container .form-check-input[id='\"+element.zone+\"']\").attr(\"checked\")\n                // })\n\n\n\n            }).then(() => {\n\n            })\n        }\n\n    }\n\n\n\n}).then(() => {\n\n    Object(_utils_js__WEBPACK_IMPORTED_MODULE_0__[\"timeoutAsync\"])(1000, function () {\n        // console.log($(\".team-container tr .zones-col .zone\").length)\n        for (var i = 0; i < $(\".team-container tr .zones-col\").length; i++) {\n            for (var j = 0; j < $(\".team-container tr .zones-col\")[i].children.length; j++) {\n                var username = $(\".team-container tr .zones-col\")[i].className.split(\" \")[1].split('zones-')[1]\n                var zone = $(\".team-container tr .zones-col\")[i].children[j].innerHTML\n                if (zone != 'No zone assigned')\n                    $(`.modal-` + username + ` input[id=\"` + zone + `\"]`).prop(\"checked\", true);\n                else\n                    $(`.modal-` + username + ` input[id=\"` + zone + `\"]`).prop(\"checked\", false);\n            }\n        }\n    })\n})\n\n\n\nfunction turnOnClick(user) {\n\n    $(`.edit-user-` + user + ``).click(function () {\n        $(`#edit-user-` + user + ``).modal({\n            backdrop: 'static'\n        });\n    });\n\n\n    // callback when modal shows\n    // $('.modal-' + user + '').on('shown.bs.modal', function (e) {\n    //     console.log(\"shown\")\n\n    //     // $(\".main-overlay\").addClass(\"force-show-overlay\")\n    //     // $('#main').addClass(\"blur4\")\n    //     // $('#mySidenav').addClass(\"blur4\")\n    // })\n\n    // // callback when modal hides\n    // $('.modal-' + user + '').on('hide.bs.modal', function (e) {\n    //     console.log(\"hide\")\n    //     // $(\".main-overlay\").removeClass(\"force-show-overlay\")\n    //     // $('#main').removeClass(\"blur4\")\n    //     // $('#mySidenav').removeClass(\"blur4\")\n    // })\n\n}\n\n//# sourceURL=webpack:///./public/js/team.js?");

/***/ }),

/***/ "./public/js/utils.js":
/*!****************************!*\
  !*** ./public/js/utils.js ***!
  \****************************/
/*! exports provided: timeoutAsync, sendMessage, delay, displayTimeoutAndVanish, liveWeight, liveWeightTable, liveGate, scaleInput, filterColumn, insertStatus, getConveyorStatus, showNotification */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"timeoutAsync\", function() { return timeoutAsync; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"sendMessage\", function() { return sendMessage; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"delay\", function() { return delay; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"displayTimeoutAndVanish\", function() { return displayTimeoutAndVanish; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"liveWeight\", function() { return liveWeight; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"liveWeightTable\", function() { return liveWeightTable; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"liveGate\", function() { return liveGate; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"scaleInput\", function() { return scaleInput; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"filterColumn\", function() { return filterColumn; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"insertStatus\", function() { return insertStatus; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getConveyorStatus\", function() { return getConveyorStatus; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"showNotification\", function() { return showNotification; });\nconst timeoutAsync = (ms, f) => {\n    let sleep = new Promise(resolve => setTimeout(function () {\n        f();\n    }, ms))\n}\n\nfunction sendMessage(topic, msg) {\n    // send a status message to get the gate status\n    socket.emit(topic, msg)\n}\n\nasync function delay(ms) {\n    // return await for better async stack trace support in case of errors.\n    return await new Promise(resolve => setTimeout(resolve, ms));\n}\n\nfunction displayTimeoutAndVanish(element, timeout) {\n    var el = $(element)\n    var timeout_ = timeout / 1000\n    var x = setInterval(function () {\n        timeout_ -= 1\n        el.html(timeout_ + \" sec\")\n    }, 1000)\n\n    timeoutAsync(timeout, function () {\n        el.fadeOut(500)\n        clearInterval(x);\n    })\n}\n\nfunction liveWeight(payloadJson) {\n    var scaleTitle = $(\".scale-info h3\")\n    var barcodeTitle = $(\".scale-info p\")\n    payloadJson = JSON.parse(payloadJson)\n    scaleTitle.html(payloadJson.weight + \"g\")\n    barcodeTitle.html(payloadJson.barcode)\n}\n\nfunction liveWeightTable(payloadJson, tableColumn) {\n\n    // Live card insert\n    var scaleTitle = $(\".scale-info h3\")\n    var barcodeTitle = $(\".scale-info p\")\n    if (typeof payloadJson == 'string') {\n        payloadJson = JSON.parse(payloadJson)\n    }\n    scaleTitle.html(payloadJson.weight + \"g\")\n    barcodeTitle.html(payloadJson.barcode)\n\n    // MySQL insert\n    // if (payloadJson.wms)\n    //   sendScaleRecordings(payloadJson.barcode, payloadJson.weight, payloadJson.wms)\n    // else\n    //   sendScaleRecordings(payloadJson.barcode, payloadJson.weight)\n\n    if (payloadJson.wms == undefined)\n        payloadJson.wms = 0\n\n    // Remove no data text\n    if ($(\".table-wrapper .text-center\").length) {\n        $(\".table-wrapper .text-center\").remove()\n    }\n\n    var tbody = $(\".table-wrapper table tbody\")\n\n    // Sync the timestamp (mysql - local timezone)\n    var timestamp = new Date()\n    timestamp = timestamp.toLocaleString('en-US', {\n        timeZone: 'Europe/Bucharest',\n        timeStyle: \"medium\",\n        dateStyle: \"long\"\n    })\n\n    // Insert new data into table\n    var index = $(\".table-wrapper table tbody tr:first-child th\").html()\n    if (index == undefined) {\n        index = 0\n    }\n    index = (parseInt(index) + 1)\n\n    if (payloadJson.wms)\n        var elClass = 'last-row-animation-good'\n    else\n        var elClass = 'last-row-animation-good'\n\n    tbody.prepend(`<tr class=\"` + elClass + `\" timestamp=\"` + timestamp + `\" barcode=\"` + payloadJson.barcode + `\">\n                          <th scope=\"row\">` + index + `</th>\n                          <td>` + payloadJson.wms + `</td>\n                          <td>` + payloadJson.barcode + `</td>\n                          <td>` + payloadJson.weight + `g</td>\n                          <td>` + timestamp.split(\", \")[0] + `, ` + timestamp.split(\", \")[1] + `</td>\n                      </tr>`)\n\n    // Filter again\n    filterColumn(tableColumn)\n\n}\n\nvar oneTime = true\n// var statusConor = 0\n\nfunction liveGate(status) {\n    var gate = $(\".gate-info\")\n    var gateTitle = $(\".gate-info h3\")\n\n    if (status == 0) {\n        // gate is closed\n        gate.attr(\"status\", \"closed\")\n        // document.querySelector(\".gate-info\").style.background = \"#28a745\"\n        gateTitle.html(\"Closed\")\n\n        if (!isConveyorEnabled()) {\n            insertStatus(\"on\"); // insert status into DB\n            switchConveyorToggle()\n        }\n        showNotification(\"Gate is closed\", 4)\n    } else if (status == 1) {\n        // gate is open\n        gate.attr(\"status\", \"open\")\n        // document.querySelector(\".gate-info\").style.background = \"#dc3545\"\n        gateTitle.html(\"Open\")\n        // isConveyorEnabled()\n\n        if (!isConveyorEnabled()) {\n            insertStatus(\"on\"); // insert status into DB\n            switchConveyorToggle()\n        }\n        showNotification(\"Gate is open\", 4)\n    } else {\n        timeoutAsync(2000, function() {\n\n        })\n    }\n\n    // When page is loading first time\n    // And toggle is on\n    // And gate is unknown\n    // => toggle should be off\n    timeoutAsync(1000, function () {\n        // wait 5000 sec to receive gate status\n\n        if (gateTitle.text() == \"Unknown\") {\n            if (isConveyorEnabled()) {\n                insertStatus(\"off\"); // insert status into DB\n                switchConveyorToggle()\n            }\n\n            // showNotification(\"Conveyor is stopped\", 0)\n            // showNotification(\"Conveyor is stopped\", 1)\n            // showNotification(\"Conveyor is stopped\", 2)\n            if (oneTime) {\n                // showNotification(\"Conveyor is stopped\", 1)\n                oneTime = false\n            }\n\n        }\n\n    })\n}\n\nfunction isConveyorEnabled() {\n    var switchConveyor = $(\"#switch-conveyor\")\n    var switchConveyorState = switchConveyor[0].checked\n    return switchConveyorState\n}\n\nfunction switchConveyorToggle() {\n    var switchConveyor = $(\"#switch-conveyor\")\n    switchConveyor[0].checked = !switchConveyor[0].checked\n}\n\nfunction scaleInput(tableColumn) {\n    // Declare variables\n    var input, filter, table, tr, td, i, txtValue;\n    input = document.getElementById(\"scaleInput\");\n    filter = input.value.toUpperCase();\n    table = document.getElementById(\"scaleTable\");\n    tr = table.getElementsByTagName(\"tr\");\n    // Loop through all table rows, and hide those who don't match the search query\n    for (i = 0; i < tr.length; i++) {\n        td = tr[i].getElementsByTagName(\"td\")[tableColumn];\n        //   console.log(i, td)\n        if (td) {\n            txtValue = td.textContent || td.innerText;\n            // console.log(i, td, txtValue)\n            if (txtValue.toUpperCase().indexOf(filter) > -1) {\n                tr[i].style.display = \"\";\n            } else {\n                tr[i].style.display = \"none\";\n            }\n        }\n    }\n}\n\nfunction filterColumn(id_input, id_table, tableColumn) {\n    // Declare variables\n    var input, filter, table, tr, td, i, txtValue;\n    input = document.getElementById(id_input);\n    filter = input.value.toUpperCase();\n    table = document.getElementById(id_table);\n    tr = table.getElementsByTagName(\"tr\");\n    // Loop through all table rows, and hide those who don't match the search query\n    for (i = 0; i < tr.length; i++) {\n        td = tr[i].getElementsByTagName(\"td\")[tableColumn];\n        //   console.log(i, td)\n        if (td) {\n            txtValue = td.textContent || td.innerText;\n            // console.log(i, td, txtValue)\n            if (txtValue.toUpperCase().indexOf(filter) > -1) {\n                tr[i].style.display = \"\";\n            } else {\n                tr[i].style.display = \"none\";\n            }\n        }\n    }\n}\n\n// insert status of conveyor into mysql\nlet insertStatus = async (status) => {\n    // status = on / off\n    $.ajax({\n        url: \"https://anysensor.dasstec.ro/api/conveyor?setStatus=\" + status + \"\",\n        type: 'GET'\n    });\n}\n\n// get all values of a sensor\nlet getConveyorStatus = async (sensor) => {\n    let response = await fetch(\"https://anysensor.dasstec.ro/api/conveyor\")\n    return response.json()\n}\n\nfunction showNotification(message, error = 0) {\n\n    if (error == 0)\n        $(\"notification\").append(`<div class=\"messages hideMe\">\n                                    <div class=\"alert alert-info mt-3 mb-0\" role=\"alert\">\n                                    <i class=\"fas fa-barcode\"></i>\n                                        <background></background>\n                                        ` + message + `\n                                    </div>\n                                </div>`).show('slow');\n    else if (error == 1)\n        $(\"notification\").append(`<div class=\"messages hideMe\">\n                                    <div class=\"alert alert-danger mt-3 mb-0\" role=\"alert\">\n                                        <i class=\"fas fa-exclamation-triangle\"></i>\n                                        <background></background>\n                                        ` + message + `\n                                    </div>\n                                </div>`).show('slow');\n\n    else if (error == 2)\n        $(\"notification\").append(`<div class=\"messages hideMe\">\n                                        <div class=\"alert alert-success mt-3 mb-0\" role=\"alert\">\n                                            <i class=\"fas fa-print\"></i>\n                                            <background></background>\n                                            ` + message + `\n                                        </div>\n                                </div>`).show('slow');\n\n    else if (error == 3)\n        $(\"notification\").append(`<div class=\"messages hideMe\">\n                                        <div class=\"alert alert-info mt-3 mb-0\" role=\"alert\">\n                                            <i class=\"fas fa-times-circle\"></i>\n                                            <background></background>\n                                            ` + message + `\n                                        </div>\n                                </div>`).show('slow');\n\n    else if (error == 4)\n        $(\"notification\").append(`<div class=\"messages hideMe\">\n                                        <div class=\"alert alert-success mt-3 mb-0\" role=\"alert\">\n                                            <i class=\"fas fa-info-circle\"></i>\n                                            <background></background>\n                                            ` + message + `\n                                        </div>\n                                </div>`).show('slow');\n\n}\n\n//# sourceURL=webpack:///./public/js/utils.js?");

/***/ }),

/***/ "./public/js/webpack-scripts.js":
/*!**************************************!*\
  !*** ./public/js/webpack-scripts.js ***!
  \**************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("// require('./jquery-3.3.1.js')\nconst path = __webpack_require__(/*! path */ \"./node_modules/path-browserify/index.js\");\n\n__webpack_require__(/*! ./svgGauge/gauge.min.js */ \"./public/js/svgGauge/gauge.min.js\")\n__webpack_require__(/*! ./scripts.js */ \"./public/js/scripts.js\")\n__webpack_require__(/*! ./fetch3.1.0.js */ \"./public/js/fetch3.1.0.js\")\n\nif ($(\".scale-page\").length) {\n    console.log(\"scale.js added\")\n    __webpack_require__(/*! ./scale */ \"./public/js/scale.js\")\n}\n\nif ($(\".conveyor-page\").length) {\n    console.log(\"conveyor.js added\")\n    __webpack_require__(/*! ./conveyor */ \"./public/js/conveyor.js\")\n}\n\nif ($(\".scanner-page\").length) {\n    console.log(\"scanner.js added\")\n    __webpack_require__(/*! ./scanner */ \"./public/js/scanner.js\")\n}\n\nif ($(\".team-page\").length) {\n    console.log(\"team.js added\")\n    __webpack_require__(/*! ./team */ \"./public/js/team.js\")\n}\n\nif ($(\".dashboard-page\").length) {\n    console.log(\"dashboard.js added\")\n    __webpack_require__(/*! ./dashboard */ \"./public/js/dashboard.js\")\n}\n\nif ($(\"#zones-list\").length) {\n    console.log(\"map.js added\")\n    __webpack_require__(/*! ./map */ \"./public/js/map.js\")\n}\n\n//# sourceURL=webpack:///./public/js/webpack-scripts.js?");

/***/ })

/******/ });